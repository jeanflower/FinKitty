/*! For license information please see main.f977a306.chunk.js.LICENSE.txt */
(this.webpackJsonpfinkitty=this.webpackJsonpfinkitty||[]).push([[0],{118:function(e,t,a){"use strict";a.r(t);var n,r=a(0),s=a.n(r),o=a(27),i=a.n(o),c=(a(80),a(1)),u=a(2),l=a.n(u),h=a(6),E=a(7),d=a(3),p=a(11),A=a(10),f=a(17),m=a(9),T=a(5),v=a(67),g=a(125),O=a(18),b="cpi",N="Annual rate of inflation",M="End of view range",R="Date at the end of range to be plotted",C="Beginning of view range",y="Date at the start of range to be plotted",S="Date of birth",I="Date used for representing dates as ages",U="Today's value focus date",w="Date to use for 'today's value' tables (defaults to '' meaning today)",D="View frequency",_="Annually",L="Monthly",x="View detail",P="Totalled view",V="Categorised view",k="Detailed view",F="Focus of assets chart",B="Focus of debts chart",j="Focus of expenses chart",Y="Focus of incomes chart",G="Focus of tax chart, person",W="Focus of tax chart, type",H="Tax chart, whether to include net income/gains",J="Type of view for chart",K="(incomeTax)",Q="(net)",q="".concat("-CP","Taxable "),z="(CGT)",Z="".concat("-P","EN "),X="".concat("-P","SS "),$="".concat("-P","DB "),ee="".concat("-P","T "),te="".concat("-CP","TaxFreeM "),ae="".concat("-CP","TaxFree "),ne="".concat("-CP","T "),re="Conditional",se="revalueInc",oe="revalueExp",ie={lc:"Home"},ce={lc:"Expenses"},ue={lc:"Incomes"},le={lc:"Transactions"},he={lc:"Assets"},Ee={lc:"Debts"},de={lc:"Dates"},pe={lc:"Settings"},Ae={lc:"Tax"},fe={lc:"Asset actions"},me={lc:"Overview"},Te=a(60),ve=a.n(Te),ge=!0;function Oe(e){ge&&console.log(e)}function be(e){return JSON.stringify(e,null,4)}function Ne(e){var t=e/100+1,a=Math.log(t);return Math.exp(a/12)-1}function Me(e,t){return e.startsWith("-")&&!t.startsWith("-")?1:!e.startsWith("-")&&t.startsWith("-")||e.toLowerCase()<t.toLowerCase()?-1:e.toLowerCase()>t.toLowerCase()?1:e<t?-1:e>t?1:0}function Re(e){var t=ve()(e,"DD/MM/YYYY"),a=t.toDate();return Number.isNaN(a.getTime())?(a=(t=ve()(e,"DD/MM/YY")).toDate(),Number.isNaN(a.getTime())?new Date(e):a):a}function Ce(e){var t=new RegExp("^[+-]?([0-9]+([.][0-9]*)?|[.][0-9]+)"),a=e.match(t),n=void 0,r=e;return null===a||0===a.length||(n=parseFloat(a[0]),r=e.substring(a[0].length)),{numberPart:n,wordPart:r}}function ye(e){var t=Ce(e);return void 0===t.numberPart?void 0:t.wordPart}function Se(e,t){return""===e?"":e.includes("/")?(Oe("Error: name ".concat(e," can't contain ").concat("/")),""):t?e+K+"/"+e+"(NI)":e+K}function Ie(e){return e+" income "+K}function Ue(e){return e+" income (NI)"}function we(e){return e+" income "+Q}function De(e){return e+" gain "+z}function _e(e){return e+" gain "+Q}function Le(e){return"T"===e||"t"===e||"True"===e||"true"===e}function xe(e){return e?"T":"F"}function Pe(e){var t={value:!0,checksOK:!0},a=e.toLowerCase();return"y"===a||"yes"===a?t.value=!0:"n"===a||"no"===a?t.value=!1:t.checksOK=!1,t}function Ve(e){return e?"Yes":"No"}function ke(e){var t={value:0,checksOK:!0};if(""!==Ce(e).wordPart)return t.checksOK=!1,t;var a=parseFloat(e);return void 0===a||Number.isNaN(a)?(t.checksOK=!1,t):(t.value=a,t)}function Fe(e,t){var a={value:"",checksOK:!0};if(""===e)return a.checksOK=!1,a;if(1===cr(e,t).numFound)return a.value=e,a;var n=ke(e.replace("%",""));return n.checksOK?(a.value="".concat(n.value),a):(a.checksOK=!1,a)}function Be(e,t){return 1===cr(e,t).numFound?e:ke(e).checksOK?"".concat(parseFloat(e),"%"):e}function je(e){var t={value:0,checksOK:!0},a=e.replace("\xa3",""),n=ke(a=a.replace(",",""));return n.checksOK?t.value=n.value:t.checksOK=!1,t}function Ye(e){var t={value:"",checksOK:!0};if(0===e.length)return t;var a=ke(e);return a.checksOK&&a.value===Math.floor(a.value)?t.value="".concat(a.value):t.checksOK=!1,t}function Ge(e){var t={absolute:!0,value:e,checksOK:!0};if(""===e)return t.value="0.0",t;var a=e.substring(e.length-6,e.length),n=Ce(e);if(" units"===a){var r=e.substring(0,e.length-6),s=parseFloat(r);void 0===s||Number.isNaN(s)?t.checksOK=!1:t.value=r}else if(void 0!==n.numberPart&&"%"!==n.wordPart&&""!==n.wordPart)t.value=e,t.checksOK=!0;else if("%"===e[e.length-1]){var o=e.substring(0,e.length-1),i=parseFloat(o);void 0===i||Number.isNaN(i)?t.checksOK=!1:(t.absolute=!1,t.value="".concat(i/100))}else{var c=e.replace(",",""),u=ke(c);if(u.checksOK)t.value="".concat(u.value);else{var l=je(c);l.checksOK?t.value="".concat(l.value):t.checksOK=!1}}return t}function We(e,t){var a=t.assets.filter((function(t){return t.NAME===e}))[0];if(void 0!==a&&""!==a.QUANTITY)return parseFloat(a.QUANTITY)}function He(e){return e.toFixed(2)}function Je(e,t,a,n,r){var s="";if(0===e.length)return"0.0";if(r.startsWith("Revalue")||void 0===We(a,n))if(t)s=e;else{var o=100*parseFloat(e),i="".concat(o);i.substring(0,i.length-1).endsWith("0000000")||i.substring(0,i.length-1).endsWith("9999999")?(i=He(o)).endsWith(".00")?i=i.substring(0,i.length-3):i.endsWith("0")&&(i=i.substring(0,i.length-1)):i="".concat(o),s="".concat(i,"%")}else s=e+" units";return s}function Ke(e,t){if(""===e)return"";var a=parseFloat(e),n=a<0;n&&(a*=-1);var r=a.toFixed(2);return r.length>6&&(r=r.substring(0,r.length-6)+","+r.substring(r.length-6,r.length)),r.length>10&&(r=r.substring(0,r.length-10)+","+r.substring(r.length-10,r.length)),n?"-".concat(t).concat(r):"".concat(t).concat(r)}function Qe(e,t,a,n){var r=0;if("-"===t)r=-1;else{if("+"!==t)return;r=1}var s=e.split(t);if(2===s.length){var o=Ce(s[1]);if(void 0!==o.numberPart&&("d"===o.wordPart||"m"===o.wordPart||"y"===o.wordPart)){var i=qe(s[0],a,n+1);if(void 0!==i)return"d"===o.wordPart?i.setDate(i.getDate()+r*o.numberPart):"m"===o.wordPart?i.setMonth(i.getMonth()+r*o.numberPart):"y"===o.wordPart&&i.setFullYear(i.getFullYear()+r*o.numberPart),i}}}function qe(e,t,a){if(!(a>100)){var n=Qe(e,"-",t,a);if(void 0!==n)return n;var r=Qe(e,"+",t,a);if(void 0!==r)return r;var s=t.filter((function(t){return t.NAME===e})),o=void 0;return 0!==s.length&&(o=ze(s[0].DATE,t,a+1)),o}}function ze(e,t,a){var n,r=qe(e,t,a);if(void 0!==r)n=r;else{var s=Re(e);n=s.getTime()?s:void 0}return n}function Ze(e,t){return ze(e,t,0)}function Xe(e,t){var a=Ze(e,t);return void 0!==a?a:new Date}!function(e){e[e.Asset=0]="Asset",e[e.Debt=1]="Debt",e[e.Income=2]="Income",e[e.Expense=3]="Expense"}(n||(n={}));var $e={weekday:void 0,year:"numeric",month:"long",day:"numeric"};function et(e,t){var a="";if(""!==e){var n=Ze(e,t);void 0!==n&&(a=n.toLocaleDateString(void 0,$e))}return a}function tt(e,t){return e===t}function at(e,t){var a=Ce(e);return!(!a.wordPart||a.wordPart!==t)}function nt(e,t){var a=e.split("/"),n=0;return a.forEach((function(e){e===t&&(n+=1)})),n>0}function rt(e,t){if(!e.startsWith(t))return!1;var a=e.substring(t.length);if(!a.startsWith("+")&&!a.startsWith("-"))return!1;var n=Ce(a.substring(1));if(void 0===n.numberPart)return!1;var r="m"===n.wordPart||"d"===n.wordPart||"y"===n.wordPart;return r}function st(e,t){if(e.startsWith("Revalue"))return"Revalue";if(e.startsWith(re))return re;if(e.startsWith(X))return X;if(e.startsWith(ee))return ee;if(e.startsWith($))return $;if(e.startsWith(Z))return Z;if(e.startsWith(te))return te;if(e.startsWith(q))return q;if(e.startsWith(ne))return ne;if(e.startsWith("BMV"))return"BMV";if(void 0!==t.transactions.find((function(t){return t.FROM_VALUE==="BMV"+e})))return"BMV";var a="";if(e.endsWith("5y")?a="5y":e.endsWith("4y")?a="4y":e.endsWith("3y")?a="3y":e.endsWith("2y")?a="2y":e.endsWith("1y")?a="1y":e.endsWith("1m")&&(a="1m"),""!==a)return void 0===t.transactions.find((function(e){return"bondInvest"===e.TYPE&&!!e.NAME.endsWith(a)}))?"":a;var n=t.triggers.find((function(t){return t.NAME===e}));return void 0!==n&&function(e,t){var a=e.NAME;return void 0!==t.triggers.find((function(e){return rt(e.DATE,a)}))||(void 0!==t.transactions.find((function(e){return rt(e.DATE,a)}))||(void 0!==t.incomes.find((function(e){return rt(e.START,a)}))||void 0!==t.expenses.find((function(e){return rt(e.START,a)}))))}(n,t)?"dateAlgebra":""}function ot(e,t,a){var n=e.settings.map((function(e){return tt(e.NAME,t)||at(e.VALUE,t)?"Setting '".concat(e.NAME,"' has name ").concat(a," called ").concat(t):""})).filter((function(e){return e.length>0})),r=e.triggers.map((function(e){return tt(e.NAME,t)?"Trigger '".concat(e.NAME,"' has name ").concat(a," called ").concat(t):""})).filter((function(e){return e.length>0})),s=e.assets.map((function(e){return tt(e.NAME,t)?"Asset '".concat(e.NAME,"' has name ").concat(a," called ").concat(t):tt(e.START,t)?"Asset '".concat(e.NAME,"' has start ").concat(a," called ").concat(t):at(e.VALUE,t)?"Asset '".concat(e.NAME,"' has value ").concat(a," called ").concat(t):tt(e.QUANTITY,t)?"Asset '".concat(e.NAME,"' has quantity ").concat(a," called ").concat(t):tt(e.GROWTH,t)?"Asset '".concat(e.NAME,"' has growth ").concat(a," called ").concat(t):nt(e.LIABILITY,t)?"Asset '".concat(e.NAME,"' has liability ").concat(a," called ").concat(t):at(e.PURCHASE_PRICE,t)?"Asset '".concat(e.NAME,"' has purchase price ").concat(a," called ").concat(t):""})).filter((function(e){return e.length>0})),o=e.incomes.map((function(e){return tt(e.NAME,t)?"Income '".concat(e.NAME,"' has name ").concat(a," called ").concat(t):tt(e.START,t)?"Income '".concat(e.NAME,"' has start ").concat(a," called ").concat(t):tt(e.END,t)?"Income '".concat(e.NAME,"' has end ").concat(a," called ").concat(t):at(e.VALUE,t)?"Income '".concat(e.NAME,"' has value ").concat(a," called ").concat(t):tt(e.VALUE_SET,t)?"Income '".concat(e.NAME,"' has value set ").concat(a," called ").concat(t):tt(e.GROWTH,t)?"Income '".concat(e.NAME,"' has growth ").concat(a," called ").concat(t):nt(e.LIABILITY,t)?"Income '".concat(e.NAME,"' has liability ").concat(a," called ").concat(t):""})).filter((function(e){return e.length>0})),i=e.expenses.map((function(e){return tt(e.NAME,t)?"Expense '".concat(e.NAME,"' has name ").concat(a," called ").concat(t):tt(e.START,t)?"Expense '".concat(e.NAME,"' has start ").concat(a," called ").concat(t):tt(e.END,t)?"Expense '".concat(e.NAME,"' has end ").concat(a," called ").concat(t):at(e.VALUE,t)?"Expense '".concat(e.NAME,"' has value ").concat(a," called ").concat(t):tt(e.VALUE_SET,t)?"Expense '".concat(e.NAME,"' has value set ").concat(a," called ").concat(t):tt(e.GROWTH,t)?"Expense '".concat(e.NAME,"' has growth ").concat(a," called ").concat(t):""})).filter((function(e){return e.length>0})),c=e.transactions.map((function(e){return tt(e.NAME,t)?"Transaction '".concat(e.NAME,"' has name ").concat(a," called ").concat(t):nt(e.FROM,t)?"Transaction '".concat(e.NAME,"' has from ").concat(a," called ").concat(t):at(e.FROM_VALUE,t)?"Transaction '".concat(e.NAME,"' has from value ").concat(a," called ").concat(t):nt(e.TO,t)?"Transaction '".concat(e.NAME,"' has to ").concat(a," called ").concat(t):at(e.TO_VALUE,t)?"Transaction '".concat(e.NAME,"' has to value set ").concat(a," called ").concat(t):tt(e.DATE,t)?"Transaction '".concat(e.NAME,"' has date ").concat(a," called ").concat(t):tt(e.STOP_DATE,t)?"Transaction '".concat(e.NAME,"' has stop date ").concat(a," called ").concat(t):""})).filter((function(e){return e.length>0})),u="".concat(n," ").concat(r," ").concat(s," ").concat(o," ").concat(i," ").concat(c);return u.length<=7&&(u=""),u}function it(e,t,a){var n=Ce(e);return""===n.wordPart?e:n.wordPart===t?e.substring(0,e.length-t.length)+a:e}function ct(e,t,a){var n=e.split("/"),r="";return n.forEach((function(e){r+=e===t?a:e,r+="/"})),r=r.substr(0,r.length-"/".length)}function ut(e,t,a){return e!==t?e:a}var lt=a(26),ht=a(25),Et=function(e){Object(p.a)(a,e);var t=Object(A.a)(a);function a(){return Object(h.a)(this,a),t.apply(this,arguments)}return Object(E.a)(a,[{key:"render",value:function(){var e,t=this;return e=Bn(this.props.value)?Ke(this.props.value,"\xa3"):this.props.value,s.a.createElement(lt.a,{placement:"top",overlay:function(a){return s.a.createElement(ht.a,a,"".concat(t.props.name,":").concat(e))}},s.a.createElement("span",{className:"float: right"},e))}}]),a}(s.a.Component),dt=a(66),pt=a.n(dt),At=function(e){Object(p.a)(a,e);var t=Object(A.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).sortedIndices=void 0,n.sortedIndices=e.rows.map((function(e){return e.index})),n.state={colSortIndex:"index",sortDirection:"NONE"},n.handleSort(n.state.colSortIndex,"NONE"),n}return Object(E.a)(a,[{key:"rowGetter",value:function(e){var t=this;return this.props.rows.filter((function(a){return a.index===t.sortedIndices[e]}))[0]}},{key:"getSize",value:function(){return this.props.rows.length}},{key:"handleSort",value:function(e,t){var a=this;this.sortedIndices="NONE"!==t?this.props.rows.slice().sort((function(t,n){var r=t[e],s=n[e];if(void 0!==r&&void 0!==s||(r=t[a.props.columns[0]],s=n[a.props.columns[0]]),"DATE"===e||"START"===e||"END"===e||"VALUE_SET"===e){var o=Xe(r,a.props.triggers).getTime(),i=Xe(s,a.props.triggers).getTime(),c=!Number.isNaN(o),u=!Number.isNaN(i);if(c&&!u)return 1;if(!c&&u)return-1;c&&u&&(r=o,s=i)}else if("VALUE"===e||"FROM_VALUE"===e||"TO_VALUE"===e){if(r.endsWith("%")&&!s.endsWith("%"))return"ASC"===a.state.sortDirection?1:-1;if(!r.endsWith("%")&&s.endsWith("%"))return"ASC"===a.state.sortDirection?-1:1;var l=parseFloat(r),h=parseFloat(s);if(Number.isNaN(l)&&!Number.isNaN(h))return"ASC"===a.state.sortDirection?1:-1;if(!Number.isNaN(l)&&Number.isNaN(h))return"ASC"===a.state.sortDirection?-1:1;if(!Number.isNaN(l)&&!Number.isNaN(h))return l<h?"ASC"===a.state.sortDirection?1:-1:l>h?"ASC"===a.state.sortDirection?-1:1:0}else"index"===e||void 0!==r&&void 0!==s&&(r=r.toUpperCase(),s=s.toUpperCase());return r<s?"ASC"===a.state.sortDirection?1:-1:r>s?"ASC"===a.state.sortDirection?-1:1:0})).map((function(e){return e.index})):this.props.rows.slice().sort((function(e,t){var a=e.index,n=t.index;return a<n?1:a>n?-1:0})).map((function(e){return e.index}))}},{key:"sortHandler",value:function(e,t){this.setState({colSortIndex:e,sortDirection:t})}},{key:"getCellActions",value:function(e,t){var a=this;return"NAME"===e.key&&void 0!==this.props.deleteFunction?[{icon:"fa fa-trash",callback:function(){var e=Object(T.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===a.props.deleteFunction){e.next=4;break}return e.next=3,a.props.deleteFunction(t.NAME);case 3:a.sortHandler(a.state.colSortIndex,a.state.sortDirection);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]:[]}},{key:"render",value:function(){return this.handleSort(this.state.colSortIndex,this.state.sortDirection),s.a.createElement(pt.a,{columns:this.props.columns,rowGetter:this.rowGetter.bind(this),rowsCount:this.props.rows.length,onGridRowsUpdated:this.props.handleGridRowsUpdated,minHeight:35*this.props.rows.length+50,enableCellSelect:!0,enableRowSelect:void 0,onGridSort:this.sortHandler.bind(this),getCellActions:this.getCellActions.bind(this)})}}]),a}(s.a.Component),ft=function(e){Object(p.a)(a,e);var t=Object(A.a)(a);function a(){return Object(h.a)(this,a),t.apply(this,arguments)}return Object(E.a)(a,[{key:"render",value:function(){var e=this,t=Be(this.props.value,this.props.settings);return s.a.createElement(lt.a,{placement:"top",overlay:function(a){return s.a.createElement(ht.a,a,"".concat(e.props.name,":").concat(t))}},s.a.createElement("span",null,t))}}]),a}(s.a.Component),mt=function(e){Object(p.a)(a,e);var t=Object(A.a)(a);function a(){return Object(h.a)(this,a),t.apply(this,arguments)}return Object(E.a)(a,[{key:"render",value:function(){var e=this;return s.a.createElement(lt.a,{placement:"top",overlay:function(t){return s.a.createElement(ht.a,t,"".concat(e.props.name,":").concat(e.props.value))}},s.a.createElement("span",null,this.props.value))}}]),a}(s.a.Component),Tt=function(e){Object(p.a)(a,e);var t=Object(A.a)(a);function a(){return Object(h.a)(this,a),t.apply(this,arguments)}return Object(E.a)(a,[{key:"render",value:function(){var e=this,t=this.props.value,a=t,n=Ce(t);return"USD"===n.wordPart&&void 0!==n.numberPart&&(a="".concat(Ke(n.numberPart.toFixed(2),""),"USD")),s.a.createElement(lt.a,{placement:"top",overlay:function(t){return s.a.createElement(ht.a,t,"".concat(e.props.name,":").concat(a))}},s.a.createElement("span",null,a))}}]),a}(s.a.Component),vt=function(e){Object(p.a)(a,e);var t=Object(A.a)(a);function a(){return Object(h.a)(this,a),t.apply(this,arguments)}return Object(E.a)(a,[{key:"render",value:function(){var e,t,a=this;return Bn(this.props.value)?(t=this.props.value,e=""===t?"":" units"===t.substring(t.length-6,t.length)||"%"===t[t.length-1]?t:Ke(t,"\xa3")):e=this.props.value,s.a.createElement(lt.a,{placement:"top",overlay:function(t){return s.a.createElement(ht.a,t,"".concat(a.props.name,":").concat(e))}},s.a.createElement("span",{className:"float: right"},e))}}]),a}(s.a.Component);var gt=function(e){Object(p.a)(a,e);var t=Object(A.a)(a);function a(){return Object(h.a)(this,a),t.apply(this,arguments)}return Object(E.a)(a,[{key:"render",value:function(){var e=this,t=this.props.value,a=new Date(this.props.value);return Number.isNaN(a.getTime())||(t=this.props.showTime?a.toLocaleString():a.toLocaleDateString(void 0,$e)),s.a.createElement(lt.a,{placement:"top",overlay:function(t){return s.a.createElement(ht.a,t,"".concat(e.props.name,":").concat(function(e){return 0===e.model.settings.length?"":et(e.value,e.model.triggers)}(e.props)))}},s.a.createElement("span",null,t))}}]),a}(s.a.Component),Ot=a(128),bt=a(130),Nt=a(124),Mt=function(e){Object(p.a)(a,e);var t=Object(A.a)(a);function a(e){return Object(h.a)(this,a),t.call(this,e)}return Object(E.a)(a,[{key:"render",value:function(){var e="btn btn-".concat(this.props.type).concat(" mr-1 mb-1");return s.a.createElement("button",{onClick:this.props.action,id:this.props.id,type:"primary"===this.props.type?"submit":"button",className:e,disabled:this.props.disabled},this.props.title)}}]),a}(r.Component);function Rt(e,t,a,n,r,o){return s.a.createElement(Mt,{key:a,action:t,title:e,id:n,type:r,disabled:void 0!==o&&o})}var Ct=function(e){Object(p.a)(a,e);var t=Object(A.a)(a);function a(){return Object(h.a)(this,a),t.apply(this,arguments)}return Object(E.a)(a,[{key:"render",value:function(){return s.a.createElement("div",{style:{display:"none"}},s.a.createElement("textarea",{readOnly:!0,id:this.props.identifier,value:this.props.message}))}}]),a}(s.a.Component),yt=function(e){return s.a.createElement("div",{className:"form-group"},s.a.createElement("label",{htmlFor:e.name,className:"form-label"},e.title),s.a.createElement("input",{className:"form-control",id:e.name,name:e.name,type:e.type,value:e.value,onChange:e.onChange,onBlur:e.onBlur,placeholder:e.placeholder}))},St=function(e){return s.a.createElement("div",{className:"form-group row"},s.a.createElement("label",{htmlFor:e.name,className:"col-sm col-form-label"},e.title),s.a.createElement("div",{className:"col-sm"},s.a.createElement("input",{className:"form-control",id:e.name,name:e.name,type:e.type,value:e.value,onChange:e.onChange,onSubmit:e.onSubmit,onBlur:e.onBlur,placeholder:e.placeholder})))},It=function(e){Object(p.a)(a,e);var t=Object(A.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={VALUE:n.props.getValue()},n.handleValue=n.handleValue.bind(Object(d.a)(n)),n.add=n.add.bind(Object(d.a)(n)),n}return Object(E.a)(a,[{key:"render",value:function(){return s.a.createElement("form",{className:"container-fluid",onSubmit:this.add},s.a.createElement(St,{title:"".concat(this.props.name),type:"text",name:"EditWidget".concat(this.props.name),value:this.state.VALUE,placeholder:this.props.getValue(),onChange:this.handleValue}))}},{key:"handleValue",value:function(e){var t=e.target.value;this.setState({VALUE:t})}},{key:"add",value:function(){var e=Object(T.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,this.props.submitFunction(this.state.VALUE);case 3:this.props.showAlert("updating");case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),a}(r.Component),Ut=a(74),wt=a(123),Dt=a(44),_t=a.n(Dt),Lt=a(20);function xt(e){return e.getViewSetting(W,"All")}function Pt(e){var t=e.getViewSetting(H,"All");return"Y"===t||"y"===t||"yes"===t}function Vt(e,t,a){return kt.apply(this,arguments)}function kt(){return(kt=Object(T.a)(l.a.mark((function e(t,a,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.setViewSetting(a,n),e.next=3,mi(!1,!0,23);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ft(e,t,a,r,s){var o="";a===n.Income||a===n.Expense?o="select-".concat(e):a===n.Asset?o="chooseAssetOrDebtChartSetting--asset-".concat(e):a===n.Debt&&(o="chooseAssetOrDebtChartSetting--debt-".concat(e));var i="primary";return i=s?t.highlightButton(a,e)?"success":"outline-success":t.highlightButton(a,e)?"primary":"outline-primary",Rt(e,function(){var n=Object(T.a)(l.a.mark((function n(s){return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s.persist(),t.toggleViewFilter(a,e),n.next=4,mi(r,!0,24);case 4:return n.abrupt("return",n.sent);case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e,o,i)}function Bt(e,t,a,n){var r=e.map((function(e){return e.NAME})).sort((function(e,t){var a=e.startsWith("-CP"),n=t.startsWith("-CP");if(a&&!n)return 1;if(!a&&n)return-1;var r=e.startsWith("-P"),s=t.startsWith("-P");return r&&!s?1:!r&&s?-1:e===t?0:e<t?-1:1})).map((function(e){return Ft(e,t,a,n,!1)})),o=[];e.forEach((function(e){var t=e.CATEGORY;""!==t&&o.indexOf(t)<0&&o.push(t)})),o.sort(),o.unshift("All");var i=o.map((function(e){return Ft(e,t,a,n,!0)}));return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{role:"group"},i),s.a.createElement("div",{role:"group"},r))}function jt(e){var t=[P,V,k],a=function(e){return e.getViewSetting(x,k)}(e),n=t.map((function(t){return Rt(t,(function(a){a.persist(),Vt(e,x,t)}),t,"chooseViewDetailType".concat(t),t===a?"secondary":"outline-secondary")}));return s.a.createElement("div",{role:"group"},n)}function Yt(e,t){ur(t,S,"");return{isSmall:!1,height:300,toolTip:{content:"{name}: {ttip}"},legend:{fontFamily:"Helvetica",fontWeight:"normal",horizontalAlign:"right",verticalAlign:"center",display:!0},axisX:{labelFormatter:function(e){return e.label}}}}function Gt(e,t,a){return Object(c.a)(Object(c.a)({},Yt(0,t)),{},{isSmall:!0,height:200,width:400,title:{display:!0,text:a},legend:{fontFamily:"Helvetica",fontWeight:"normal",horizontalAlign:"right",verticalAlign:"center",display:!1}})}function Wt(e,t,a){return s.a.createElement(Ut.a,{options:{plugins:{title:{display:void 0!==t.title&&t.title.display,text:void 0!==t.title?t.title.text:""},legend:{display:e.displayLegend,position:"right"}},animation:{duration:0},responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!0,ticks:{callback:function(t,n,r){var s=e.labels[n],o=new Date(s);return a.getViewSetting(D,_)===L?_t()(o,"mmmm yyyy"):_t()(o,"yyyy")}}},y:{stacked:!0}}},data:e})}function Ht(e,t,a){return s.a.createElement(wt.a,{style:{height:"".concat(t.height,"px")}},Wt(e,t,a))}function Jt(e,t,a){return t.isSmall?Wt(e,t,a):Ht(e,t,a)}function Kt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0;if(void 0===t||void 0===a||void 0===n||void 0===r||void 0===o||void 0===i)return s.a.createElement(s.a.Fragment,null,s.a.createElement("br",null),"No ",e," data in range",s.a.createElement("br",null),s.a.createElement("br",null));var c=!1;return"income"===e?c=t.incomes.length>0:"expense"===e?c=t.expenses.length>0:"asset"===e?c=t.assets.filter((function(e){return!1===e.IS_A_DEBT})).length>0:"debt"===e&&(c=t.assets.filter((function(e){return!0===e.IS_A_DEBT})).length>0),c?s.a.createElement(s.a.Fragment,null,"No ",e,"s data - add ",e,", change view filters, or adjust display range",s.a.createElement("br",null),s.a.createElement("div",{className:"d-inline-flex p-2"},s.a.createElement(It,{name:"view start date",getValue:n,submitFunction:r,showAlert:a}),s.a.createElement(It,{name:"view end date",getValue:o,submitFunction:i,showAlert:a})),s.a.createElement("br",null),s.a.createElement("br",null)):s.a.createElement(s.a.Fragment,null)}function Qt(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:void 0,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:void 0;return 0===e.labels.length?(Oe("incomesChartData.length === 0, no data"),Kt("income",n,r,s,o,i,c)):Jt(e,t,a)}function qt(e,t,a,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:void 0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:void 0;return 0===e.incomes.length?s.a.createElement(s.a.Fragment,null,s.a.createElement(Ct,{identifier:"incomeDataDump",message:be(a)}),Kt("income",e,o,i,c,u,l)):s.a.createElement("div",{style:{display:"block"}},s.a.createElement(Ct,{identifier:"incomeDataDump",message:be(a)}),Bt(e.incomes,t,n.Income,!1),jt(t),Qt(a,r,t,e,o,i,c,u,l))}function zt(e,t,a){return Ht(e,t,a)}function Zt(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:void 0,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:void 0;return 0===e.labels.length?Kt("expense",n,r,s,o,i,c):zt(e,t,a)}function Xt(e,t,a,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:void 0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:void 0;return 0===e.expenses.length?s.a.createElement(s.a.Fragment,null,s.a.createElement(Ct,{identifier:"expenseDataDump",message:be(a)}),Kt("expense",e,o,i,c,u,l)):s.a.createElement("div",{style:{display:"block"}},s.a.createElement(Ct,{identifier:"expenseDataDump",message:be(a)}),Bt(e.expenses,t,n.Expense,!1),jt(t),s.a.createElement("fieldset",null,Zt(a,r,t,e,o,i,c,u,l)))}function $t(e){var t=["val","+","-","+-"],a=function(e){return e.getViewSetting(J,"val")}(e),n=t.map((function(t){return Rt(t,(function(a){a.persist(),Vt(e,J,t)}),t,"chooseAssetChartType",t===a?"primary":"outline-primary")}));return s.a.createElement("div",{role:"group"},n)}function ea(e,t,a,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:void 0,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:void 0,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:void 0;return 0===e.labels.length?Kt(t?"debt":"asset",r,s,o,i,c,u):Ht(e,a,n)}function ta(e,t,a,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:void 0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:void 0;if(0===e.assets.filter((function(e){return e.IS_A_DEBT===r})).length){var h=r?"debt":"asset",E="".concat(h,"DataDump");return s.a.createElement(s.a.Fragment,null,s.a.createElement(Ct,{identifier:E,message:be(a)}),Kt(h,e,o,i,c,u,l))}var d=r?n.Debt:n.Asset,p=e.assets.filter((function(e){return e.IS_A_DEBT===(d===n.Debt)}));return s.a.createElement("div",{style:{display:"block"}},Bt(p,t,d,!1),$t(t),jt(t),s.a.createElement(Ct,{identifier:r?"debtDataDump":"assetDataDump",message:be(a)}),ea(a,r,Yt(0,e.settings),t,e,o,i,c,u,l))}function aa(e,t){var a=function(e){var t=[];if(void 0===e.assets)return[];return e.assets.forEach((function(e){var a,n=e.LIABILITY.split("/"),r=Object(m.a)(n);try{var s=function(){var e=a.value,n=void 0;e.endsWith(z)?n=e.substring(0,e.length-z.length):e.endsWith(K)&&(n=e.substring(0,e.length-K.length)),void 0!==n&&-1===t.findIndex((function(e){return n===e}))&&t.push(n)};for(r.s();!(a=r.n()).done;)s()}catch(o){r.e(o)}finally{r.f()}})),e.incomes.forEach((function(e){var a,n=e.LIABILITY.split("/"),r=Object(m.a)(n);try{var s=function(){var e=a.value,n=void 0;e.endsWith("(NI)")?n=e.substring(0,e.length-"(NI)".length):e.endsWith(K)&&(n=e.substring(0,e.length-K.length)),void 0!==n&&-1===t.findIndex((function(e){return n===e}))&&t.push(n)};for(r.s();!(a=r.n()).done;)s()}catch(o){r.e(o)}finally{r.f()}})),t}(e);a.unshift("All");var n=a.map((function(e){return Rt("All"===e?"All people":e,(function(a){a.persist(),Vt(t,G,e)}),"All"===e?"All people":e,"chooseTaxSetting-".concat(e),e===t.getViewSetting(G,"All")?"primary":"outline-primary")}));return n.push(Rt("All types",(function(e){e.persist(),Vt(t,W,"All")}),"All types","chooseTaxType-all","All"===xt(t)?"secondary":"outline-secondary")),n.push(Rt("Income",(function(e){e.persist(),Vt(t,W,"income")}),"income","chooseTaxType-income","income"===xt(t)?"secondary":"outline-secondary")),n.push(Rt("Gain",(function(e){e.persist(),Vt(t,W,"gain")}),"gain","chooseTaxType-gain","gain"===xt(t)?"secondary":"outline-secondary")),n.push(Rt("Show net",(function(e){e.persist(),Vt(t,H,"Y")}),"Show net","chooseTaxType-showNet",Pt(t)?"success":"outline-success")),n.push(Rt("Hide net",(function(e){e.persist(),Vt(t,H,"N")}),"Hide net","chooseTaxType-hideNet",Pt(t)?"outline-success":"success")),s.a.createElement("div",{role:"group"},n)}function na(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:void 0;return 0===e.labels.length?void 0===n||void 0===r||void 0===o||void 0===i||void 0===c?s.a.createElement(s.a.Fragment,null,s.a.createElement("br",null),"No tax data to display",s.a.createElement("br",null),s.a.createElement("br",null)):s.a.createElement(s.a.Fragment,null,"No tax data - none payable or adjust display range",s.a.createElement(v.a,null,s.a.createElement(It,{name:"view start date",getValue:r,submitFunction:o,showAlert:n}),s.a.createElement(It,{name:"view end date",getValue:i,submitFunction:c,showAlert:n}))):Ht(e,t,a)}function ra(e,t,a){if(ni(Ae))return s.a.createElement("div",{className:"ml-3"},function(e,t,a,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:void 0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:void 0;return s.a.createElement(s.a.Fragment,null,aa(e,t),jt(t),na(a,n,t,r,o,i,c,u))}(e,t,a,Yt(0,e.settings)))}Lt.e.register(Lt.d,Lt.i,Lt.b,Lt.n,Lt.o,Lt.g);var sa=function(e){Object(p.a)(a,e);var t=Object(A.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).defaultState=void 0,n.defaultState={sourceMatcher:n.props.reportMatcher.sourceMatcher,sourceExcluder:n.props.reportMatcher.sourceExcluder},n.state=n.defaultState,n.submit=n.submit.bind(Object(d.a)(n)),n.handleMatcherChange=n.handleMatcherChange.bind(Object(d.a)(n)),n.handleExcluderChange=n.handleExcluderChange.bind(Object(d.a)(n)),n}return Object(E.a)(a,[{key:"handleMatcherChange",value:function(e){var t=e.target.value;this.setState({sourceMatcher:t})}},{key:"handleExcluderChange",value:function(e){var t=e.target.value;this.setState({sourceExcluder:t})}},{key:"render",value:function(){var e=this;return s.a.createElement("form",{className:"container-fluid",onSubmit:this.submit},s.a.createElement("div",{style:{display:"none"}},Rt("Filter table",this.submit,"MatchFilterer","MatchFilterer","primary")),s.a.createElement(yt,{type:"text",title:"Match sources",name:"reportSourceMatcher",value:this.state.sourceMatcher,placeholder:"Enter matcher here",onChange:this.handleMatcherChange}),s.a.createElement(yt,{type:"text",title:"Exclude sources",name:"reportSourceExcluder",value:this.state.sourceExcluder,placeholder:"Enter excluder here",onChange:this.handleExcluderChange}),Rt("reset to default",(function(t){t.persist(),e.setState({sourceMatcher:"Buy|Sell",sourceExcluder:""},(function(){e.submit(t)}))}),"test","test","primary"))}},{key:"submit",value:function(){var e=Object(T.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),this.props.setReportKey(JSON.stringify({sourceMatcher:this.state.sourceMatcher,sourceExcluder:this.state.sourceExcluder})),e.abrupt("return");case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),a}(r.Component);function oa(e,t){if(void 0!==e)return s.a.createElement(Ot.a,{defaultActiveKey:"0"},s.a.createElement(bt.a,null,s.a.createElement(bt.a.Header,null,s.a.createElement(Ot.a.Toggle,{as:Nt.a,variant:"link",eventKey:"0"},t)),s.a.createElement(Ot.a.Collapse,{eventKey:"0"},s.a.createElement(bt.a.Body,null,e))))}function ia(e,t,a){var n=a[0].fromRowData;if("NAME"!==a[0].cellKey){var r=n[a[0].cellKey];n[a[0].cellKey]=a[0].updated[a[0].cellKey];var s=Pe(n.GROWS_WITH_CPI),o=je(n.VALUE),i=Fe(n.GROWTH,e.settings);if(s.checksOK)if(o.checksOK)if(i.checksOK){var c={NAME:n.NAME,CATEGORY:n.CATEGORY,START:n.START,END:n.END,VALUE:"".concat(o.value),VALUE_SET:n.VALUE_SET,GROWTH:i.value,CPI_IMMUNE:!s.value,RECURRENCE:n.RECURRENCE},u=qn(c,e);""===u?bi(c,e):(t(u),n[a[0].cellKey]=r)}else t("Value ".concat(n.GROWTH," can't be understood as a growth}")),n[a[0].cellKey]=r;else t("Value ".concat(n.VALUE," can't be understood as a cash value")),n[a[0].cellKey]=r;else t("Whether expense grows with CPI should be 'y' or 'n'"),n[a[0].cellKey]=r}else if(n.NAME!==a[0].updated.NAME){if(void 0!==Ce(a[0].updated.NAME).numberPart)return void t("Don't name an expense beginning with a number");var l=ot(e,a[0].updated.NAME,"already");if(""!==l)return void t(l);nc(e,n.NAME,a[0].updated.NAME)}}function ca(e,t,a){var n=a[0].fromRowData;if("NAME"!==a[0].cellKey){var r=n[a[0].cellKey];n[a[0].cellKey]=a[0].updated[a[0].cellKey];var s=Pe(n.GROWS_WITH_CPI),o=je(n.VALUE),i=Fe(n.GROWTH,e.settings);if(s.checksOK)if(i.checksOK){var c="";c=o.checksOK?"".concat(o.value):n.VALUE;var u={NAME:n.NAME,CATEGORY:n.CATEGORY,START:n.START,END:n.END,VALUE:c,VALUE_SET:n.VALUE_SET,GROWTH:i.value,CPI_IMMUNE:!s.value,LIABILITY:n.LIABILITY},l=Kn(u,e);""===l?Mi(u,e):(t(l),n[a[0].cellKey]=r)}else t("Value ".concat(n.GROWTH," can't be understood as a growth}")),n[a[0].cellKey]=r;else t("Whether income grows with CPI should be 'y' or 'n'"),n[a[0].cellKey]=r}else if(n.NAME!==a[0].updated.NAME){if(a[0].updated.NAME.startsWith($))return void t("Don't rename incomes beginning ".concat($));if(a[0].updated.NAME.startsWith(ee))return void t("Don't rename incomes beginning ".concat(ee));if(void 0!==Ce(a[0].updated.NAME).numberPart)return void t("Don't name an income beginning with a number");var h=ot(e,a[0].updated.NAME,"already");if(""!==h)return void t(h);nc(e,n.NAME,a[0].updated.NAME)}}function ua(e,t,a){var n=a[0].fromRowData;if("NAME"!==a[0].cellKey){var r=n[a[0].cellKey];n[a[0].cellKey]=a[0].updated[a[0].cellKey];var s={NAME:n.NAME,DATE:n.DATE},o=$n(s,e);""===o?Si(s,e):(t(o),n[a[0].cellKey]=r)}else if(n.NAME!==a[0].updated.NAME){if(void 0!==Ce(a[0].updated.NAME).numberPart)return void t("Don't name a date beginning with a number");var i=ot(e,a[0].updated.NAME,"already");if(""!==i)return void t(i);nc(e,n.NAME,a[0].updated.NAME)}}function la(e,t,a){var n=a[0].fromRowData;if("NAME"!==a[0].cellKey){var r=e.assets.filter((function(e){return e.NAME===n.NAME}));if(1===r.length){var s=n[a[0].cellKey];n[a[0].cellKey]=a[0].updated[a[0].cellKey];var o,i=je(n.VALUE),c=Ye(n.QUANTITY),u=Fe(n.GROWTH,e.settings),l=""===(o=n.PURCHASE_PRICE)?"0":o,h=Pe(n.GROWS_WITH_CPI),E=Pe(n.IS_A_DEBT),d=Pe(n.CAN_BE_NEGATIVE);if(r[0].IS_A_DEBT&&i.checksOK&&(i.value=-i.value),u.checksOK)if(c.checksOK)if(h.checksOK)if(E.checksOK)if(d.checksOK){var p=i.checksOK?"".concat(i.value):n.VALUE;gi({NAME:n.NAME,VALUE:p,QUANTITY:n.QUANTITY,START:n.START,LIABILITY:n.LIABILITY,GROWTH:u.value,CPI_IMMUNE:!h.value,CAN_BE_NEGATIVE:d.value,IS_A_DEBT:E.value,PURCHASE_PRICE:l,CATEGORY:n.CATEGORY},e)}else t("asset value ".concat(n.CAN_BE_NEGATIVE," not understood")),n[a[0].cellKey]=s;else t("asset value ".concat(n.IS_A_DEBT," not understood")),n[a[0].cellKey]=s;else t("asset value ".concat(n.GROWS_WITH_CPI," not understood")),n[a[0].cellKey]=s;else t("quantity value ".concat(n.QUANTITY," not understood")),n[a[0].cellKey]=s;else t("asset growth ".concat(n.GROWTH," not understood")),n[a[0].cellKey]=s}else Oe("Error: asset ".concat(n.NAME," not found in model?"))}else if(n.NAME!==a[0].updated.NAME){if("Cash"===n.NAME)return void t("Don't rename cash asset");if(a[0].updated.NAME.startsWith($))return void t("Don't rename assets beginning ".concat($));if(a[0].updated.NAME.startsWith(Z))return void t("Don't rename assets beginning ".concat(Z));if(a[0].updated.NAME.startsWith(ae))return void t("Don't rename assets beginning ".concat(ae));if(a[0].updated.NAME.startsWith(q))return void t("Don't rename assets beginning ".concat(q));if(void 0!==Ce(a[0].updated.NAME).numberPart)return void t("Don't name an asset beginning with a number");var A=ot(e,a[0].updated.NAME,"already");if(""!==A)return void t(A);nc(e,n.NAME,a[0].updated.NAME)}}function ha(e,t){var a="";return"liquidateAsset"===t||"payOffDebt"===t?a=re:"revalueAsset"!==t&&"revalueDebt"!==t&&t!==oe&&t!==se||(a="Revalue"),a+e}function Ea(e,t,a,n){var r=n[0].fromRowData,s=r[n[0].cellKey];r[n[0].cellKey]=n[0].updated[n[0].cellKey],void 0===r.FROM_VALUE&&(r.FROM_VALUE=0);var o=Ge(r.FROM_VALUE),i=r.TYPE,c=Ge(r.TO_VALUE);if("revalueSetting"===i||o.checksOK||e.settings.find((function(e){return e.NAME===r.FROM_VALUE})))if("revalueSetting"===i||c.checksOK){var u=r.TYPE;"revalueAsset"!==u&&"revalueDebt"!==u&&u!==oe&&u!==se||(pr(r.TO,e)?u="revalueDebt":mr(r.TO,e)?u="revalueAsset":pr(r.TO,e)?(u="revalueDebt",c.value="".concat(-parseFloat(c.value))):Ar(r.TO,e)?u=se:fr(r.TO,e)&&(u=oe));var l=ha(r.NAME,u),h=ha(s,u);if("NAME"===n[0].cellKey){if(l!==h){if(void 0!==Ce(h).numberPart)return void t("Don't name a transaction beginning with a number");var E=ot(e,l,"already");if(""!==E)return void t(E);nc(e,h,l)}return}var d={DATE:r.DATE,FROM:r.FROM,FROM_VALUE:o.value,FROM_ABSOLUTE:o.absolute,NAME:l,TO:r.TO,TO_ABSOLUTE:c.absolute,TO_VALUE:c.value,STOP_DATE:r.STOP_DATE,RECURRENCE:r.RECURRENCE,TYPE:u,CATEGORY:r.CATEGORY},p=Xn(d,e);""===p?Ci(d,e):(t(p),r[n[0].cellKey]=s)}else t("To value ".concat(r.TO_VALUE," should be a number or a number with % symbol")),r[n[0].cellKey]=s;else t("From value ".concat(r.FROM_VALUE," should be a number or a number with % symbol")),r[n[0].cellKey]=s}function da(e,t,a){var n=a[0].fromRowData;if("NAME"!==a[0].cellKey)n[a[0].cellKey]=a[0].updated[a[0].cellKey],function(e,t){Ui.apply(this,arguments)}({NAME:n.NAME,VALUE:n.VALUE,HINT:n.HINT},e);else if(n.NAME!==a[0].updated.NAME){if(kr.settings.filter((function(e){return e.NAME===n.NAME})).length>0)return void t("Don't rename inbuilt settings");if(void 0!==Ce(a[0].updated.NAME).numberPart)return void t("Don't name a setting beginning with a number");var r=ot(e,a[0].updated.NAME,"already");if(""!==r)return void t(r);nc(e,n.NAME,a[0].updated.NAME)}}var pa={editable:!0,resizable:!0,sortable:!0};function Aa(e,t){var a=[Object(c.a)(Object(c.a)({},pa),{},{key:"NAME",name:"name",formatter:s.a.createElement(mt,{name:"name",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"VALUE",name:"start value",formatter:s.a.createElement(Et,{name:"start value",value:"unset"})})];t||(a=a.concat([Object(c.a)(Object(c.a)({},pa),{},{key:"QUANTITY",name:"quantity",formatter:s.a.createElement(mt,{name:"quantity",value:"unset"})})]));var n=t?"interest rate":"growth";return a=a.concat([Object(c.a)(Object(c.a)({},pa),{},{key:"START",name:"start",formatter:s.a.createElement(gt,{name:"start",model:e,value:"unset",showTime:!1})}),Object(c.a)(Object(c.a)({},pa),{},{key:"GROWTH",name:n,formatter:s.a.createElement(ft,{name:n,settings:e.settings,value:"unset"})})]),t||(a=a.concat([Object(c.a)(Object(c.a)({},pa),{},{key:"GROWS_WITH_CPI",name:"grows with CPI",formatter:s.a.createElement(mt,{name:"name",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"LIABILITY",name:"tax Liability",formatter:s.a.createElement(mt,{name:"tax liability",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"PURCHASE_PRICE",name:"purchase price",formatter:s.a.createElement(Et,{name:"purchase price",value:"unset"})})])),a=a.concat([Object(c.a)(Object(c.a)({},pa),{},{key:"CATEGORY",name:"category",formatter:s.a.createElement(mt,{name:"category",value:"unset"})})])}function fa(e){for(var t=[],a=0;a<e.length;a++){var n=Object(c.a)(Object(c.a)({},e[a]),{},{index:a});t.push(n)}return t}function ma(e,t){return fa(e.assets.filter((function(e){return e.IS_A_DEBT===t})).map((function(e){var a,n=e.VALUE;Bn(n)?(a=parseFloat(n),t&&(a=-a)):a=e.VALUE;var r,s,o="".concat(a);return{GROWTH:e.GROWTH,NAME:e.NAME,CATEGORY:e.CATEGORY,START:e.START,VALUE:o,QUANTITY:e.QUANTITY,LIABILITY:e.LIABILITY,PURCHASE_PRICE:(r=e.PURCHASE_PRICE,s=e.LIABILITY,s.includes(z)?r:""),GROWS_WITH_CPI:Ve(!e.CPI_IMMUNE),IS_A_DEBT:Ve(e.IS_A_DEBT),CAN_BE_NEGATIVE:Ve(e.CAN_BE_NEGATIVE)}})).sort((function(e,t){return Me(t.NAME,e.NAME)})))}function Ta(e,t,a,n){return s.a.createElement("div",{style:{display:"block"}},s.a.createElement("fieldset",null,s.a.createElement("div",{className:"dataGridAssets"},s.a.createElement(At,{handleGridRowsUpdated:function(){return la(e,a,arguments)},rows:t,columns:Aa(e,n),deleteFunction:Fi,triggers:e.triggers})),s.a.createElement("p",null)))}function va(e,t){return"liquidateAsset"!==t&&"payOffDebt"!==t||!e.startsWith(re)?"revalueAsset"!==t&&"revalueDebt"!==t&&t!==oe&&t!==se||!e.startsWith("Revalue")?e:e.substring("Revalue".length):e.substring(re.length)}function ga(e,t){var a=e.transactions.filter((function(e){return e.TYPE===t})).map((function(a){var n=Je(a.FROM_VALUE,a.FROM_ABSOLUTE,a.FROM,e,a.NAME);""!==a.FROM||"0"!==n&&"0.0"!==n||(n="");var r=a.TO_VALUE;"revalueDebt"===t&&(r="".concat(-parseFloat(r)));var s=Je(r,a.TO_ABSOLUTE,a.TO,e,a.NAME);return""===a.TO&&"0"===s&&(s=""),{DATE:a.DATE,FROM:a.FROM,FROM_VALUE:n,NAME:va(a.NAME,t),TO:a.TO,TO_VALUE:s,STOP_DATE:a.STOP_DATE,RECURRENCE:a.RECURRENCE,TYPE:a.TYPE,CATEGORY:a.CATEGORY}}));return a.sort((function(e,t){return Me(t.NAME,e.NAME)})),fa(a)}function Oa(e,t){var a=[Object(c.a)(Object(c.a)({},pa),{},{key:"NAME",name:"name",formatter:s.a.createElement(mt,{name:"name",value:"unset"})})];return t===se||t===oe||"revalueAsset"===t||"revalueDebt"===t||(a="payOffDebt"===t?a.concat([Object(c.a)(Object(c.a)({},pa),{},{key:"FROM_VALUE",name:"amount",formatter:s.a.createElement(vt,{name:"amount",value:"unset"})})]):a.concat([Object(c.a)(Object(c.a)({},pa),{},{key:"FROM",name:"coming from",formatter:s.a.createElement(mt,{name:"coming from",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"FROM_VALUE",name:"from amount",formatter:s.a.createElement(vt,{name:"from amount",value:"unset"})})])),a=t===se?a.concat([Object(c.a)(Object(c.a)({},pa),{},{key:"TO",name:"income",formatter:s.a.createElement(mt,{name:"income",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"TO_VALUE",name:"new value",formatter:s.a.createElement(vt,{name:"new value",value:"unset"})})]):t===oe?a.concat([Object(c.a)(Object(c.a)({},pa),{},{key:"TO",name:"expense",formatter:s.a.createElement(mt,{name:"expense",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"TO_VALUE",name:"new value",formatter:s.a.createElement(vt,{name:"new value",value:"unset"})})]):"revalueAsset"===t?a.concat([Object(c.a)(Object(c.a)({},pa),{},{key:"TO",name:"asset",formatter:s.a.createElement(mt,{name:"asset",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"TO_VALUE",name:"new value",formatter:s.a.createElement(vt,{name:"new value",value:"unset"})})]):"revalueDebt"===t?a.concat([Object(c.a)(Object(c.a)({},pa),{},{key:"TO",name:"debt",formatter:s.a.createElement(mt,{name:"debt",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"TO_VALUE",name:"new value",formatter:s.a.createElement(vt,{name:"new value",value:"unset"})})]):a.concat([Object(c.a)(Object(c.a)({},pa),{},{key:"TO",name:"going to",formatter:s.a.createElement(mt,{name:"going to",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"TO_VALUE",name:"to amount",formatter:s.a.createElement(vt,{name:"to amount",value:"unset"})})]),a="payOffDebt"===t?a.concat([Object(c.a)(Object(c.a)({},pa),{},{key:"DATE",name:"payments start date",formatter:s.a.createElement(gt,{name:"payments start date",model:e,value:"unset",showTime:!1})})]):"liquidateAsset"===t?a.concat([Object(c.a)(Object(c.a)({},pa),{},{key:"DATE",name:"date",formatter:s.a.createElement(gt,{name:"date",model:e,value:"unset",showTime:!0})})]):a.concat([Object(c.a)(Object(c.a)({},pa),{},{key:"DATE",name:"date",formatter:s.a.createElement(gt,{name:"date",model:e,value:"unset",showTime:!1})})]),"auto"!==t&&(a=a.concat([Object(c.a)(Object(c.a)({},pa),{},{key:"RECURRENCE",name:"recurrence",formatter:s.a.createElement(mt,{name:"recurrence",value:"unset"})})])),"payOffDebt"!==t&&(a=a.concat([Object(c.a)(Object(c.a)({},pa),{},{key:"STOP_DATE",name:"recurrence end date",formatter:s.a.createElement(gt,{name:"recurrence end date",model:e,value:"unset",showTime:!1})})])),t!==se&&t!==oe&&"revalueAsset"!==t&&"revalueDebt"!==t&&(a=a.concat([Object(c.a)(Object(c.a)({},pa),{},{key:"CATEGORY",name:"category",formatter:s.a.createElement(mt,{name:"category",value:"unset"})})])),a=a.concat([])}function ba(e,t,a,n,r){return oa(s.a.createElement("div",{className:"dataGridTransactions".concat(n),style:{display:"block"}},s.a.createElement(At,{handleGridRowsUpdated:function(){return Ea(t,a,0,arguments)},rows:e,columns:Oa(t,n),deleteFunction:function(e){return ji(ha(e,n))},triggers:t.triggers})),r)}function Na(e,t,a,n){var r=ga(e,a);if(0!==r.length)return ba(r,e,t,a,n)}function Ma(e,t){var a=ma(e,!0);if(0!==a.length)return s.a.createElement(s.a.Fragment,null,oa(Ta(e,a,t,!0),"Debt definitions"),Na(e,t,"revalueDebt","Revalue debts"),Na(e,t,"payOffDebt","Pay off debts"))}function Ra(e,t){var a=ma(e,!1);if(0!==a.length)return s.a.createElement(s.a.Fragment,null,oa(Ta(e,a,t,!1),"Asset definition table"),Na(e,t,"liquidateAsset","Liquidate assets to keep cash afloat"),Na(e,t,"revalueAsset","Revalue assets"))}function Ca(e,t){var a=function(e){return fa(e.triggers.map((function(e){return{DATE:e.DATE,NAME:e.NAME}})).sort((function(e,t){return Me(e.NAME,t.NAME)})))}(e);if(0!==a.length)return oa(function(e,t,a){return s.a.createElement("div",{style:{display:"block"}},s.a.createElement("fieldset",null,s.a.createElement("div",{className:"dataGridTriggers"},s.a.createElement(At,{deleteFunction:Vi,handleGridRowsUpdated:function(){return ua(e,a,arguments)},rows:t,columns:[Object(c.a)(Object(c.a)({},pa),{},{key:"NAME",name:"name",formatter:s.a.createElement(mt,{name:"name",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"DATE",name:"date",formatter:s.a.createElement(gt,{name:"date",model:e,value:"unset",showTime:!1})})],triggers:e.triggers}))))}(e,a,t),"Important dates")}function ya(e,t){var a=function(e){return fa(e.incomes.map((function(t){return{END:t.END,GROWS_WITH_CPI:Ve(!t.CPI_IMMUNE),GROWTH:Be(t.GROWTH,e.settings),NAME:t.NAME,START:t.START,VALUE:t.VALUE,VALUE_SET:t.VALUE_SET,LIABILITY:t.LIABILITY,CATEGORY:t.CATEGORY}})))}(e);if(0!==a.length)return oa(function(e,t,a){if(0!==t.length)return s.a.createElement("div",{style:{display:"block"}},s.a.createElement("fieldset",null,s.a.createElement("div",{className:"dataGridIncomes"},s.a.createElement(At,{deleteFunction:Hi,handleGridRowsUpdated:function(){return ca(e,a,arguments)},rows:t,columns:[Object(c.a)(Object(c.a)({},pa),{},{key:"NAME",name:"name",formatter:s.a.createElement(mt,{name:"name",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"VALUE",name:"value definition",formatter:s.a.createElement(Et,{name:"value definition",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"VALUE_SET",name:"definition date",formatter:s.a.createElement(gt,{name:"definition date",model:e,value:"unset",showTime:!1})}),Object(c.a)(Object(c.a)({},pa),{},{key:"START",name:"start",formatter:s.a.createElement(gt,{name:"start",model:e,value:"unset",showTime:!1})}),Object(c.a)(Object(c.a)({},pa),{},{key:"END",name:"end",formatter:s.a.createElement(gt,{name:"end",model:e,value:"unset",showTime:!1})}),Object(c.a)(Object(c.a)({},pa),{},{key:"GROWTH",name:"annual growth",formatter:s.a.createElement(ft,{name:"annual growth",settings:e.settings,value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"GROWS_WITH_CPI",name:"grows with CPI",formatter:s.a.createElement(mt,{name:"grows with CPI",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"LIABILITY",name:"tax Liability",formatter:s.a.createElement(mt,{name:"tax Liability",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"CATEGORY",name:"category",formatter:s.a.createElement(mt,{name:"category",value:"unset"})})],triggers:e.triggers})),s.a.createElement("p",null)))}(e,a,t),"Income definitions")}function Sa(e,t){var a=function(e){return fa(e.expenses.map((function(t){return{END:t.END,GROWS_WITH_CPI:Ve(!t.CPI_IMMUNE),GROWTH:Be(t.GROWTH,e.settings),CATEGORY:t.CATEGORY,NAME:t.NAME,START:t.START,VALUE:t.VALUE,VALUE_SET:t.VALUE_SET,RECURRENCE:t.RECURRENCE}})))}(e);if(0!==a.length)return oa(function(e,t,a){return s.a.createElement("div",{style:{display:"block"}},s.a.createElement("fieldset",null,s.a.createElement("div",{className:"dataGridExpenses"},s.a.createElement(At,{deleteFunction:Gi,handleGridRowsUpdated:function(){return ia(e,a,arguments)},rows:t,columns:[Object(c.a)(Object(c.a)({},pa),{},{key:"NAME",name:"name",formatter:s.a.createElement(mt,{name:"name",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"VALUE",name:"value definition",formatter:s.a.createElement(Et,{name:"value definition",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"VALUE_SET",name:"definition date",formatter:s.a.createElement(gt,{name:"definition date",model:e,value:"unset",showTime:!1})}),Object(c.a)(Object(c.a)({},pa),{},{key:"START",name:"start",formatter:s.a.createElement(gt,{name:"start",model:e,value:"unset",showTime:!1})}),Object(c.a)(Object(c.a)({},pa),{},{key:"END",name:"end",formatter:s.a.createElement(gt,{name:"end",model:e,value:"unset",showTime:!1})}),Object(c.a)(Object(c.a)({},pa),{},{key:"GROWTH",name:"annual growth",formatter:s.a.createElement(ft,{name:"annual growth",settings:e.settings,value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"GROWS_WITH_CPI",name:"grows with CPI",formatter:s.a.createElement(mt,{name:"grows with CPI",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"RECURRENCE",name:"recurrence",formatter:s.a.createElement(mt,{name:"recurrence",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"CATEGORY",name:"category",formatter:s.a.createElement(mt,{name:"category",value:"unset"})})],triggers:e.triggers})),s.a.createElement("p",null)))}(e,a,t),"Expense definitions")}var Ia=[J,x,F,B,j,Y,G,W,H];function Ua(e,t,a){return fa(e.settings.filter((function(e){return e.TYPE===a})).filter((function(e){return void 0===Ia.find((function(t){return e.NAME===t}))})).map((function(e){return be("obj = ".concat(e)),{NAME:e.NAME,VALUE:e.VALUE,HINT:e.HINT}})))}function wa(e,t,a){var n=Ua(e,0,"const"),r=Ua(e,0,"adjustable");if(0!==n.length||0!==r.length)return oa(s.a.createElement(s.a.Fragment,null,function(e,t,a){if(0!==t.length)return s.a.createElement(At,{deleteFunction:Ki,handleGridRowsUpdated:function(){return da(e,a,arguments)},rows:t,columns:[Object(c.a)(Object(c.a)({},pa),{},{key:"NAME",name:"name",formatter:s.a.createElement(mt,{name:"name",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"VALUE",name:"defining value",formatter:s.a.createElement(mt,{name:"defining value",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"HINT",name:"hint",formatter:s.a.createElement(mt,{name:"hint",value:"unset"})})],triggers:e.triggers})}(e,n,a),function(e,t,a){if(0!==t.length)return s.a.createElement(At,{deleteFunction:Ki,handleGridRowsUpdated:function(){return da(e,a,arguments)},rows:t,columns:[Object(c.a)(Object(c.a)({},pa),{},{key:"NAME",name:"name",formatter:s.a.createElement(mt,{name:"name",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"VALUE",name:"defining value",formatter:s.a.createElement(mt,{name:"defining value",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"HINT",name:"hint",formatter:s.a.createElement(mt,{name:"hint",value:"unset"})})],triggers:e.triggers})}(e,r,a)),"Other settings affecting the model")}function Da(e,t,a){return s.a.createElement("div",{className:"dataGridSettings",style:{display:"block"}},oa(s.a.createElement(At,{deleteFunction:Ki,handleGridRowsUpdated:function(){return da(e,a,arguments)},rows:Ua(e,0,"view"),columns:[Object(c.a)(Object(c.a)({},pa),{},{key:"NAME",name:"name",formatter:s.a.createElement(mt,{name:"name",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"VALUE",name:"defining value",formatter:s.a.createElement(mt,{name:"defining value",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"HINT",name:"hint",formatter:s.a.createElement(mt,{name:"hint",value:"unset"})})],triggers:e.triggers}),"Settings about the view of the model"),wa(e,0,a),Na(e,a,"revalueSetting","Revalue settings"))}function _a(e){var t={frequency:"",count:0},a=e.length,n=e.substring(a-1,a);"m"===n?t.frequency=L:"y"===n?t.frequency=_:Oe("BUG!! frequency should be of form 4m or 6y not ".concat(e));var r=e.substring(0,a-1),s=parseFloat(r);return(void 0===s||Number.isNaN(s))&&Oe("BUG!! frequency should be of form 4m or 6y not ".concat(e)),t.count=s,t}function La(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=[],r=_a(t),s=r.frequency===L,o=r.frequency===_;if(a){var i=new Date(e.start);if("1m"===t)i.setMonth(i.getMonth()-1);else{if("1y"!==t)throw new Error("BUG : frequency ".concat(t," not implemented!"));i.setFullYear(i.getFullYear()-1)}n.push(i)}var c,u=0,l=new Date(e.start);for(c=s?l.getMonth():l.getFullYear();l<e.end;){n.push(l);var h=new Date(e.start);if(u+=r.count,s)h.setMonth(c+u);else{if(!o)throw new Error("BUG : frequency ".concat(t," not understood!"));h.setFullYear(c+u)}l=h}return n}var xa="Expense",Pa="ExpensePrep",Va="ExpenseStart",ka="ExpenseStartPrep",Fa="Income",Ba="IncomePrep",ja="IncomeStart",Ya="IncomeStartPrep",Ga="Asset",Wa="AssetStart",Ha="Transaction",Ja="Inflation";function Ka(e){e.sort((function(e,t){var a=e.date,n=t.date,r=0;if(void 0!==a&&void 0===n?r=-1:void 0===a&&void 0!==n?r=1:void 0!==a&&void 0!==n&&(a<n?r=1:a>n&&(r=-1)),0===r){var s="Cash"===e.name,o="Cash"===t.name;o&&!s?r=-1:s&&!o&&(r=1)}if(0===r){var i=e.type===Wa,c=t.type===Wa;i&&!c?r=1:c&&!i&&(r=-1)}if(0===r){var u=e.type===Ga,l=t.type===Ga;u&&!l?r=1:l&&!u&&(r=-1)}if(0===r){var h=e.name.startsWith(q),E=t.name.startsWith(q);if(h&&!E)return-1;if(!h&&E)return 1}return 0===r&&(r=e.name<t.name?1:e.name>t.name?-1:e.type<t.type?1:e.type>t.type?-1:0),0===r&&Oe("can't order two moments named ".concat(e.name)),r}))}var Qa="Expense",qa="Income",za="Asset",Za="Setting",Xa="TaxLiability";function $a(e,t){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=e.get(t);if(n&&Oe("seek number value for key = '".concat(t,"', values has entry ").concat(r)),"string"===typeof r)if(Bn(r))r=parseFloat(r);else{var s=$a(e,r,a);r=s}return void 0===r&&a?(Oe("seeking number value for key = '".concat(t,"', values has entry ").concat(r)),Oe("getNumberValue returning undefined for ".concat(t,"; ")+"values has entry ".concat(r," ")+"consider switch to traceEvaluation for values involving words and settings"),r):(n&&Oe("number value for key = '".concat(t,"' is ").concat(r)),r)}function en(e,t,a){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=t.get(e);if(!r)return{adjustForCPI:!1,scale:0};var s=0,o=tn(r.itemGrowth,a,t,"40");if(o){var i=tn(b,a,t,"41"),c=o;r.applyCPI&&void 0!==i&&(c=0!==i?100*((1+(o+i)/100)/(1+i/100)-1):o);var u=Ne(c),l=u;1!==r.powerByNumMonths&&(l=Math.pow(1+u,r.powerByNumMonths)-1),s=l,1===r.powerByNumMonths&&n&&r.scale}else;return 1===r.powerByNumMonths&&n&&r.scale,{adjustForCPI:r.applyCPI,scale:s}}function tn(e,t,a,n){var r=0;if("string"!==typeof e)r=e;else{if(Bn(e))r=parseFloat(e);else{var s=Ce(e),o=1;void 0!==s.numberPart&&(o=s.numberPart);var i=s.wordPart,c=t.get(i);if(void 0===c)if(i.startsWith("BMV")){var u=i.substring("BMV".length,i.length),l=tn(u,t,a,n);r=void 0===l?void 0:o*l}else r=void 0;else if("string"===typeof c){var h=tn(c,t,a,n);r=void 0===h?void 0:o*h}else{if(en(i,a,t).adjustForCPI){var E=t.get("base");E&&"number"===typeof E&&(c*=E)}r=o*c}}}return r}function an(e,t,a){if(void 0!==We(e,a))return $a(t,"quantity"+e,!1)}function nn(e,t,a,n,r,s,o,i,c){r===s&&Oe("BUG??? don't expect value of ".concat(r," = ").concat(s,"!")),e.set(r,s,t,n,i,c);var u=tn(s,e,t,r);if(void 0===u);else{var l,h=u;if(en(r,t,e).adjustForCPI)if(l=$a(e,"base"))h=h*l;else Oe("BUG : missing or zero base value!");var E={name:r,date:n,value:function(e,t,a,n){if(void 0===e)return e;var r=an(a,t,n);return void 0===r?e:e*r}(h,e,r,o),source:i};a.push(E)}}function rn(e){return e.getMonth()>3?e.getFullYear():e.getMonth()<3?e.getFullYear()-1:e.getDate()>5?e.getFullYear():e.getFullYear()-1}function sn(e){return e.getDate()<=5?e.getMonth():e.getMonth()+1}var on={2016:{noTaxBand:12500,lowTaxBand:5e4,adjustNoTaxBand:1e5,highTaxBand:15e4,lowTaxRate:.2,highTaxRate:.4,topTaxRate:.45,noNIBand:8628,lowNIBand:50004,lowNIRate:.12,highNIRate:.02},2017:{noTaxBand:12500,lowTaxBand:5e4,adjustNoTaxBand:1e5,highTaxBand:15e4,lowTaxRate:.2,highTaxRate:.4,topTaxRate:.45,noNIBand:8628,lowNIBand:50004,lowNIRate:.12,highNIRate:.02},2018:{noTaxBand:12500,lowTaxBand:5e4,adjustNoTaxBand:1e5,highTaxBand:15e4,lowTaxRate:.2,highTaxRate:.4,topTaxRate:.45,noNIBand:8628,lowNIBand:50004,lowNIRate:.12,highNIRate:.02},2019:{noTaxBand:12500,lowTaxBand:5e4,adjustNoTaxBand:1e5,highTaxBand:15e4,lowTaxRate:.2,highTaxRate:.4,topTaxRate:.45,noNIBand:8628,lowNIBand:50004,lowNIRate:.12,highNIRate:.02},2020:{noTaxBand:12500,lowTaxBand:5e4,adjustNoTaxBand:1e5,highTaxBand:15e4,lowTaxRate:.2,highTaxRate:.4,topTaxRate:.45,noNIBand:8628,lowNIBand:50004,lowNIRate:.12,highNIRate:.02},2021:{noTaxBand:12500,lowTaxBand:5e4,adjustNoTaxBand:1e5,highTaxBand:15e4,lowTaxRate:.2,highTaxRate:.4,topTaxRate:.45,noNIBand:8628,lowNIBand:50004,lowNIRate:.12,highNIRate:.02},2022:{noTaxBand:12500,lowTaxBand:5e4,adjustNoTaxBand:1e5,highTaxBand:15e4,lowTaxRate:.2,highTaxRate:.4,topTaxRate:.45,noNIBand:8628,lowNIBand:50004,lowNIRate:.1325,highNIRate:.0325}};function cn(e,t,a){var n;if(t>2022){var r=on["".concat(2022)];if(!r)throw new Error("tax bands not defined for ".concat(2022,"!"));n=r;var s=$a(a,"base");if(s){var o=$a(a,"noTaxBand"),i=$a(a,"lowTaxBand"),c=$a(a,"highTaxBand"),u=$a(a,"adjustNoTaxBand"),l=$a(a,"noNIBand"),h=$a(a,"lowNIBand");if(!(o&&i&&c&&u&&l&&h))throw Oe("BUG : missing tax bands in values"),new Error;n={noTaxBand:o*s,lowTaxBand:i*s,highTaxBand:c*s,adjustNoTaxBand:u*s,lowTaxRate:n.lowTaxRate,highTaxRate:n.highTaxRate,topTaxRate:n.topTaxRate,noNIBand:l*s,lowNIRate:n.lowNIRate,lowNIBand:h*s,highNIRate:n.highNIRate}}else{Oe("BUG : missing baseVal");var E=on["".concat(2022)];if(!E)throw new Error("tax bands not defined for ".concat(2022,"!"));n=E}}else{var d=on["".concat(t)];if(!d)throw new Error("tax bands not defined for ".concat(t,"!"));n=d}var p=e-(n={noTaxBand:n.noTaxBand,lowTaxBand:n.lowTaxBand,lowTaxRate:n.lowTaxRate,adjustNoTaxBand:n.adjustNoTaxBand,highTaxBand:n.highTaxBand,highTaxRate:n.highTaxRate,topTaxRate:n.topTaxRate,noNIBand:n.noNIBand,lowNIBand:n.lowNIBand,lowNIRate:n.lowNIRate,highNIRate:n.highNIRate}).adjustNoTaxBand;return p>0&&(n.noTaxBand=Math.max(0,n.noTaxBand-p/2)),n}function un(e,t,a){var n=cn(e,t,a),r=n.lowTaxBand-n.noTaxBand,s=n.highTaxBand-n.lowTaxBand,o=n.lowTaxRate,i=n.highTaxRate,c=n.topTaxRate,u=0,l=0,h=0;return(u=e-n.noTaxBand)>0?(n.noTaxBand,(l=u-r)>0?(u=r,(h=l-s)>0?l=s:h=0):l=0):u=0,[{amountLiable:h,rate:c},{amountLiable:l,rate:i},{amountLiable:u,rate:o}]}function ln(e,t,a){var n=cn(e,t,a),r=n.noNIBand,s=n.lowNIBand,o=n.lowNIRate,i=s-r,c=0,u=0;return(c=e-r)>0?(r,(u=c-i)>0?c=i:u=0):c=0,[{amountLiable:u,rate:n.highNIRate},{amountLiable:c,rate:o}]}function hn(e,t,a,n,r,s,o){var i=$a(a,"Cash",!1);if(void 0===i);else{var c;if(void 0!==i&&en("Cash",n,a).adjustForCPI){var u=a.get("base");u&&"number"===typeof u&&(i*=c=u)}var l=i+e;c&&(l/=c),nn(a,n,r,t,"Cash",l,s,o,"1")}}function En(e){var t=0;return e.forEach((function(e){t+=e.amountLiable*e.rate})),t}function dn(e,t,a,n,r,s,o,i){var c=En(un(t,e.getFullYear(),n));if(0!==c&&hn(-(c-a),e,n,r,s,o,i),c>0){var u=i.substring(0,i.length-K.length);nn(n,r,s,e,K,c,o,Ie(u),"23")}return c}function pn(e){var t=0;return e.forEach((function(e){t+=e.amountLiable*e.rate})),t}function An(e,t,a,n,r,s,o){t>0&&nn(a,n,r,e,"(NI)",t,s,Ue(o.substring(0,o.length-"(NI)".length)),"33")}function fn(e,t,a,n,r,s,o){var i=function(e,t,a){return e<12e3?0:.2*(e-12e3)}(t,e.getFullYear());if(i>0){hn(-i,e,a,n,r,s,o);var c=o.substring(0,o.length-z.length);nn(a,n,r,e,z,i,s,De(c),"26")}return i}function mn(e,t,a,n,r,s,o,i){var c=cn(t,e.getFullYear(),a);if(!(t>c.noTaxBand)){var u,l=c.noTaxBand-t,h=Object(m.a)(a.keys());try{for(h.s();!(u=h.n()).done;){var E=u.value;if(E.startsWith(q)){var d="".concat(E.substr(q.length)).split(".");if(2!==d.length)throw Oe("unexpected formatting of ".concat(E)),new Error("unexpected formatting of cp name");var p="".concat(d[0]).concat(K);if(p===r){var A=l,f=$a(a,E);if(void 0===f)return void Oe("BUG!!! pension has no value");A>f&&(A=f);var T=s.get(K);if(void 0===T)return void Oe("BUG!!! person has no liability");var v=$a(a,"Cash");void 0===v?Oe("BUG!!! cash has no value"):(T.set(r,t+A),t+=A,l-=A,nn(a,n,o,e,"Cash",v+A,i,E,"5"),nn(a,n,o,e,E,f-A,i,p,"6"))}}}}catch(g){h.e(g)}finally{h.f()}}}function Tn(e,t,a,n,r,s,o,i){var c,u=new Date(n+1,3,5),l=Object(m.a)(e);try{for(l.s();!(c=l.n()).done;){var h=Object(f.a)(c.value,2),E=h[0],d=h[1];if(E===K&&void 0!==d){var p,A=Object(m.a)(d);try{for(A.s();!(p=A.n()).done;){var T=Object(f.a)(p.value,2),v=T[0];mn(u,T[1],r,s,v,e,o,i)}}catch(Te){A.e(Te)}finally{A.f()}}}}catch(Te){l.e(Te)}finally{l.f()}var g,O=new Map,b=new Map,N=Object(m.a)(e);try{for(N.s();!(g=N.n()).done;){var M=Object(f.a)(g.value,2),R=M[0],C=M[1],y=!1,S=!1;if(R===K&&void 0!==C){var I=t.get(K);void 0===I&&(I=new Map,t.set(K,I));var U=a.get(K);void 0===U&&(U=new Map,a.set(K,U));var w,D=Object(m.a)(C);try{for(D.s();!(w=D.n()).done;){var _=Object(f.a)(w.value,2),L=_[0],x=_[1],P=U.get(L);void 0===P&&(P=0);var V=dn(u,x,P,r,s,o,i,L),k=L.substring(0,L.length-K.length),F=O.get(k);void 0===F?O.set(k,x-V):O.set(k,F-V),C.set(L,0),I.set(L,0),U.set(L,0),y=!0}}catch(Te){D.e(Te)}finally{D.f()}}else if("(NI)"===R&&void 0!==C){var B=t.get("(NI)");void 0===B&&(B=new Map,t.set("(NI)",B));var j=a.get("(NI)");void 0===j&&(j=new Map,a.set("(NI)",j));var Y,G=Object(m.a)(C);try{for(G.s();!(Y=G.n()).done;){var W=Object(f.a)(Y.value,2),H=W[0],J=W[1],Q=B.get(H);void 0===Q&&(Q=0);var q=j.get(H);void 0===q&&(q=0);An(u,q,r,s,o,i,H);0;var Z=H.substring(0,H.length-"(NI)".length),X=O.get(Z);void 0===X?O.set(Z,J-q):O.set(Z,X-q),C.set(H,0),j.set(H,0)}}catch(Te){G.e(Te)}finally{G.f()}y=!0}else if("cgt"===R&&void 0!==C){var $,ee=Object(m.a)(C);try{for(ee.s();!($=ee.n()).done;){var te=Object(f.a)($.value,2),ae=te[0],ne=te[1],re=fn(u,ne,r,s,o,i,ae),se=ae.substring(0,ae.length-z.length),oe=b.get(se);void 0===oe?b.set(se,ne-re):b.set(se,oe-re),C.set(ae,0),S=!0}}catch(Te){ee.e(Te)}finally{ee.f()}}else Oe("unhandled key from liableIncomeInTaxYear = ".concat(R," "));if(y){var ie,ce=Object(m.a)(O);try{for(ce.s();!(ie=ce.n()).done;){var ue=Object(f.a)(ie.value,2),le=ue[0],he=ue[1];if(he>0){var Ee=we(le);nn(r,s,o,u,Ee,he,i,Ee,"27")}}}catch(Te){ce.e(Te)}finally{ce.f()}}if(S){var de,pe=Object(m.a)(b);try{for(pe.s();!(de=pe.n()).done;){var Ae=Object(f.a)(de.value,2),fe=Ae[0],me=Ae[1];me>0&&nn(r,s,o,u,_e(fe),me,i,_e(fe),"28")}}catch(Te){pe.e(Te)}finally{pe.f()}}}}catch(Te){N.e(Te)}finally{N.f()}}function vn(e,t){return t<=3?new Date(e+1,t,5):new Date(e,t,5)}function gn(e,t,a,n,r){var s=n.get(t);if(void 0===s&&(n.set(t,new Map),s=n.get(t)),void 0!==s){var o=s.get(e);void 0===o&&(o=0);var i=o+a;s.set(e,i)}if(t===K){var c=r.get(K);void 0===c&&(c=new Map,r.set(K,c));var u=c.get(e);void 0===u&&(u=0);var l=u+a;c.set(e,l)}if("(NI)"===t){var h=r.get("(NI)");void 0===h&&(h=new Map,r.set("(NI)",h));var E=h.get(e);void 0===E&&(E=0);var d=E+a;h.set(e,d)}}function On(e,t,a,n,r,s,o,i,c,u,l){var h=s.triggers;if(t.name.startsWith($)){var E=s.incomes.find((function(e){return e.NAME===t.name}));if(void 0===E)throw new Error("income ".concat(t.name," not found in model"));if(Xe(E.START,h)>t.date)return}var d=e,p=e,A=e;t.type===Ga&&(d=0),o.forEach((function(o){if(!(Xe(o.DATE,h)>t.date)){var i=parseFloat(o.FROM_VALUE),c=parseFloat(o.TO_VALUE);if(t.name===o.FROM){var u=0;u=o.FROM_ABSOLUTE?i:i*e,o.NAME.startsWith($)||(d-=u,p-=u,o.NAME.startsWith(X)&&(A-=u));var l=0;l=o.TO_ABSOLUTE?c:c*u;var E=$a(a,o.TO,!1),f=$a(a,"base");void 0!==f&&void 0!==E?E*=f:void 0===f&&Oe("BUG : undefined scaleBy ".concat(f)),""===o.TO||(void 0===E?Oe("BUG : contributing to undefined pension scheme"):(E+=l,f&&E&&(E/=f),nn(a,n,r,t.date,o.TO,E,s,o.NAME,"7")))}}})),d>0&&hn(d,t.date,a,n,r,s,l);var f="",m=t.name+l,T=i.get(m);(void 0===T&&(m=t.name,T=i.get(m)),void 0!==T)&&T.split("/").forEach((function(e){if(e.endsWith(K)){gn(e,K,p,c,u);var t=e.substring(0,e.length-K.length);if(""===f)f=t;else if(f!==t)throw new Error("can't handle multiple people liable from one income")}if(e.endsWith("(NI)")){gn(e,"(NI)",A,c,u);var a=e.substring(0,e.length-"(NI)".length);if(""===f)f=a;else if(f!==a)throw new Error("can't handle multiple people liable from one income")}}))}function bn(e,t,a,n,r,s,o,i){var c=Xe(e.END,n);o<c&&(c=o);var u={start:r,end:c},l=La(u,i).map((function(n){var r=n<s?t:a;return{date:n,name:e.NAME,type:r,setValue:0,transaction:void 0}}));if(l.length>0){a===xa?l[0].type===Pa?l[0].type=ka:l[0].type=Va:a===Fa&&(l[0].type===Ba?l[0].type=Ya:l[0].type=ja);var h=e.VALUE,E=Xe(e.VALUE_SET,n),d=u.start,p=function(e,t){var a;return a=12*(t.getFullYear()-e.getFullYear()-1),a+=12-e.getMonth(),a+=t.getMonth()-1,e.getDate()<=t.getDate()&&(a+=1),a}(E,d);!e.NAME.startsWith($)&&p<0&&Oe("BUG : income/expense start value set ".concat(E," after ")+"start date ".concat(d," ").concat(e.NAME)),l[0].setValue=h}return l}function Nn(e,t){return t?t.CAN_BE_NEGATIVE:(Oe("Error : asset name ".concat(e," not found in assets list")),"Cash"===e||e.includes("mortgage")||e.includes("Mortgage"))}function Mn(e){return va(e.NAME,e.TYPE)}function Rn(e,t){var a=new Date(e);return t.endsWith("5y")?a.setFullYear(a.getFullYear()+5):t.endsWith("4y")?a.setFullYear(a.getFullYear()+4):t.endsWith("3y")?a.setFullYear(a.getFullYear()+3):t.endsWith("2y")?a.setFullYear(a.getFullYear()+2):t.endsWith("1y")?a.setFullYear(a.getFullYear()+1):t.endsWith("1m")?a.setMonth(a.getMonth()+1):Oe("BUG - could not infer duration of bond from ".concat(t," (does not end 1y etc)")),a}function Cn(e,t,a,n,r,s,o,i,c,u,l,h){var E,d=tn(t,r,s,t),p=void 0;if(""!==a&&void 0===(p=tn(a,r,s,a))&&(p=0),void 0===d||void 0!==(E=function(e,t,a,n,r,s,o,i,c){if(e.NAME.startsWith(re)&&void 0===t)Oe("Bug : conditional transaction to undefined value ".concat(be(e)));else if(!(e.NAME.startsWith(re)&&void 0!==t&&t>=0)){var u=tn(e.FROM_VALUE,s,o,e.FROM);if(void 0!==u){var l=parseFloat(e.TO_VALUE),h=an(n,s,c),E=void 0!==h,d=0,p=c.assets.find((function(e){return e.NAME===n})),A=p&&!Nn(n,p);if(e.FROM_ABSOLUTE){if(e.FROM_VALUE.startsWith("BMV"))if("Cash"===e.FROM){var f=new Date(r.date),m=$a(s,"bondInterest",!1),T=1;void 0!==m&&(T=1+m/100),e.NAME.endsWith("5y")?(f.setFullYear(f.getFullYear()+5),T=Math.pow(T,5)):e.NAME.endsWith("4y")?(f.setFullYear(f.getFullYear()+4),T=Math.pow(T,4)):e.NAME.endsWith("3y")?(f.setFullYear(f.getFullYear()+3),T=Math.pow(T,3)):e.NAME.endsWith("2y")?(f.setFullYear(f.getFullYear()+2),T=Math.pow(T,2)):e.NAME.endsWith("1y")?f.setFullYear(f.getFullYear()+1):e.NAME.endsWith("1m")?(T=Math.pow(T,1/12),f.setMonth(f.getMonth()+1)):Oe("BUG - could not infer duration of bond from bond name (does not end 1y etc)"),u/=T;var v=c.settings.filter((function(t){var a=t.NAME.split("/");return 3===a.length&&(a[0]===e.FROM_VALUE&&(a[2]===b&&f.getTime()===new Date(a[1]).getTime()))}));if(1===v.length){var g=$a(s,v[0].NAME);void 0!==g?u*=g:Oe("BUG : np cpiScaling value found for bond investment")}else c.settings.find((function(e){return e.NAME==="".concat("BMV","Prerun")}))||Oe("BUG : expected to find a setting ".concat(e.FROM_VALUE).concat("/").concat(f).concat("/").concat(b))}else{var O=$a(s,"".concat(e.FROM_VALUE).concat("/").concat(new Date(r.date).toDateString()).concat("/").concat(b,"invested"),!1);u=void 0!==O?O:0}d=u}else e.NAME.startsWith(re)&&!e.TO_ABSOLUTE?void 0!==t&&(d=-t*u/l):d=E&&h?Math.floor(h*u):a*u;var N=0,M=0;if(E&&(e.NAME.startsWith(re)?(M=a,N=Math.ceil(d/M)):(N=d,h&&h<N&&(N=h),d=N*(M=a))),e.NAME.startsWith(re)&&void 0!==t&&!e.TO_ABSOLUTE&&d>=-t/l){var R=-t/l,C=$a(s,"Grain",!1);if(void 0===C||"Cash"!==e.TO||E)d=R;else{var y=Math.ceil(R/C)*C;d=y<a?y:R}E&&(d=(N=Math.ceil(d/M))*M)}if(E&&void 0!==h){if(h-N<0&&A){if(!(e.NAME.startsWith(re)&&h>0))return;d=(N=h)*M}var S=e.NAME;S.startsWith(re)&&(S=S.substring(re.length)),nn(s,o,i,r.date,"quantity"+n,h-N,c,S,"12")}if(A&&!E&&d>a)if(e.NAME.startsWith(re))d=a;else{if(!(d-a<1e-5))return;d=a}if(!(c.incomes.find((function(e){return e.NAME===n}))&&d>a)&&!(p&&void 0!==n&&!Nn(n,p)&&a<=0)){var I=d,U=d,w=a;return E&&void 0!==h&&(d=0,w*=h),{fromImpact:d,toImpact:I,cgtPreWhole:w,cgtPreChange:U}}}else Oe("ERROR : can't interpret from value ".concat(e.FROM_VALUE))}}(e,p,d,t,n,r,s,o,i))){var A;if(void 0!==p&&void 0!==E&&(A=function(e,t,a,n,r,s,o,i){var c=0;if(""===e.TO)return c;var u=parseFloat(e.TO_VALUE);if(void 0===t)throw new Error("Bug : transacting to unvalued asset ".concat(be(n)));if(e.TO_ABSOLUTE){c=u;var l=an(e.TO,r,i);if(void 0!==l){var h=c;if(void 0!==tn(e.TO,r,s,e.TO)){var E=l+h;nn(r,s,o,n.date,"quantity"+e.TO,E,i,e.TO,"13"),c=0}}}else{if(void 0===a)throw new Error("Bug : transacting to proportion of undefined fromChange"+"".concat(be(n)));c=u*a}if(e.FROM_VALUE.startsWith("BMV")&&"Cash"===e.FROM){var d=$a(r,"bondInterest",!1),p=1;void 0!==d&&(p=1+d/100),c*=p}return c}(e,p,E.toImpact,n,r,s,o,i)),void 0!==E&&void 0!==d){var f;!function(e,t,a,n,r,s,o,i,c,u,l){var h=c.get(t);if(void 0!==h){var E=h.split("/").find((function(e){return e.endsWith(z)}));if(void 0!==E){var d=n/a,p=$a(s,"".concat("Purchase").concat(t));if(void 0!==p){var A=(a-p)*d,f=u.get("cgt");if(void 0===f&&(u.set("cgt",new Map),f=u.get("cgt")),void 0!==f){var m=f.get(E);void 0===m&&(m=0),m+=A,f.set(E,m)}var T=p*(1-d);nn(s,o,i,r.date,"".concat("Purchase").concat(t),T,l,e.NAME,"13")}else Oe("BUG!! - CGT liability on an asset with no record of purchase price")}}}(e,t,E.cgtPreWhole,E.cgtPreChange,n,r,s,o,u,l,i);var m=r.get(t);if(0===E.fromImpact&&void 0!==m)f=m;else if(f=d-E.fromImpact,en(t,s,r).adjustForCPI){var T=r.get("base");T&&"number"===typeof T&&(f/=T)}nn(r,s,o,n.date,t,f,i,Mn(e),"14")}if(void 0!==A)if(t.startsWith(q)&&"Cash"===a)On(A,n,r,s,o,i,c,u,l,h,t);else{if(void 0===p)throw new Error("Bug : transacting to adjust undefined toValue"+"".concat(be(n)));if(e.FROM_VALUE.startsWith("BMV")&&"Cash"===e.FROM){var v=Rn(n.date,e.NAME),g=A,O="".concat(e.FROM_VALUE).concat("/").concat(v.toDateString()).concat("/").concat(b,"invested");r.set(O,g,s,n.date,"bondInvestment","42")}var N=p+A;if(en(a,s,r).adjustForCPI){var M=r.get("base");M&&"number"===typeof M&&(N/=M)}nn(r,s,o,n.date,a,N,i,function(e){var t=e.NAME;return t.startsWith(re)&&(t=t.substring(re.length)),t}(e),"15")}else e.FROM.endsWith(K)&&""===e.TO&&Oe("ERROR : one-off income tax adjustment might affect pensionAllowance...no code for this")}}function yn(e,t,a,n,r,s){if(!e.FROM_ABSOLUTE)throw new Error("BUG : transacting from a proportional amount of undefined ".concat(be(e)));var o=parseFloat(e.TO_VALUE),i=parseFloat(e.FROM_VALUE),c=tn(e.TO,a,n,e.TO),u=an(e.TO,a,s);if(void 0===c)throw new Error("Bug : transacting to unvalued/string-valued asset ".concat(be(t)));var l=0;if(e.TO_ABSOLUTE?l=o:(o>1&&Oe("WARNING : not-absolute value ".concat(o," > 1.0")),l=o*i),u){u+=l,nn(a,n,r,t.date,"quantity"+e.TO,u,s,e.NAME,"37");var h=s.assets.find((function(t){return t.NAME===e.TO}));h&&function(e,t,a,n,r,s,o,i){var c=t.get("".concat("Purchase").concat(e.NAME));if(void 0!==c){var u=0,l=void 0;if("string"===typeof c){var h=Ce(c);if(void 0===h.numberPart)throw new Error("don't understand purchase price for RSUs?");u=h.numberPart,l=h.wordPart}else u=c;var E=u;0!==E&&(E*=n,void 0===l?nn(t,a,r,s,"".concat("Purchase").concat(e.NAME),E,o,i,"31"):nn(t,a,r,s,"".concat("Purchase").concat(e.NAME),"".concat(E).concat(l),o,i,"32"))}}(h,a,n,u/(u-l),r,t.date,s,e.NAME)}else{if(c+=l,en(e.TO,n,a).adjustForCPI){var E=a.get("base");E&&"number"===typeof E&&(c/=E)}nn(a,n,r,t.date,e.TO,c,s,e.NAME,"16")}}function Sn(e,t,a,n,r,s,o,i,c){var u=e.transaction;if(void 0===u)throw Error("BUG!!! moment of type transaction should have a transaction");if(!function(e,t,a,n,r,s,o,i){if(!e.NAME.startsWith("Revalue"))return!1;""!==e.FROM&&Oe("WARNING : FROM supplied but no used "+"for a revaluation transaction ".concat(be(e)));var c=tn(e.TO_VALUE,a,n,e.TO_VALUE),u=c,l=e.TO.split("/");return(l=vr(l,i)).forEach((function(l){var h=a.get(l),E=void 0,d=!1;if(void 0===h)throw new Error("proportional change to an undefined value not implemented, ".concat(e.NAME));if("string"!==typeof h)E=h;else if(Bn(h))E=parseFloat(h);else if(!e.TO_ABSOLUTE){var p=Ce(h);if(void 0===p.numberPart||void 0===p.wordPart)throw new Error("proportional change to a not-number value ".concat(h," not implemented"));if(void 0===c||"string"===typeof c)throw new Error("proportional change to a not-number value ".concat(h," not implemented"));var A=p.numberPart*c;c=""+A+p.wordPart,d=!0}if(!e.TO_ABSOLUTE)if(void 0===E)d||Oe("WARNING : proportional value supplied for a revaluation transaction"+" with no prev value ".concat(be(e)));else{if(void 0===u)throw new Error("can't interpret scale value ".concat(e.TO_VALUE));c=E*u}var f=i.assets.find((function(e){return e.NAME===l}));void 0!==f&&f.LIABILITY.split("/").forEach((function(e){if(e.endsWith(K))if(void 0===E)Oe("WARNING : no prev value found for revalue");else if(void 0===c||"string"===typeof c)Oe("WARNING : tToValue undefined/string for revalue");else{var t=c-E;if(t>0){var n=an(f.NAME,a,i);void 0!==n&&(Oe("Untested code for income tax on quantities"),t*=n),gn(e,K,t,s,o)}}}));e.TO_ABSOLUTE||void 0===c?nn(a,n,r,t.date,l,e.TO_VALUE,i,"Revalue","11"):nn(a,n,r,t.date,l,c,i,"Revalue","10")})),!0}(u,e,t,a,n,i,c,r))if(""!==u.FROM){var l=u.FROM.split("/");l=vr(l,r);var h,E=Object(m.a)(l);try{for(E.s();!(h=E.n()).done;){var d=h.value,p=[];""!==u.TO?p=vr(p=u.TO.split("/"),r):p.push("");var A,f=Object(m.a)(p);try{for(f.s();!(A=f.n()).done;){Cn(u,d,A.value,e,t,a,n,r,s,o,i,c)}}catch(T){f.e(T)}finally{f.f()}}}catch(T){E.e(T)}finally{E.f()}}else""===u.FROM&&""!==u.TO&&yn(u,e,t,a,n,r)}var In=function(){function e(){Object(h.a)(this,e),this.reportValues=new Map([]),this.includeInReport=function(e,t,a,n){return!1},this.report=[]}return Object(E.a)(e,[{key:"setIncludeInReport",value:function(e){this.includeInReport=e,this.report=[]}},{key:"set",value:function(e,t,a,n,r,s){var o=this.report.length<400&&this.includeInReport(e,t,n,r),i=0;if(o&&(i=tn(e,this,a,"debugReportOld")),this.reportValues.set(e,t),o){var c=tn(e,this,a,"debugReportNew");if(i!==c){var u=void 0;void 0!==c&&void 0!==i&&(u=c-i);var l=void 0,h=void 0,E=void 0;e.startsWith("quantity")&&(e=e.substring("quantity".length),l=u,h=i,E=c,u=void 0,i=void 0,c=void 0),this.report.push({name:e,change:u,oldVal:i,newVal:c,qchange:l,qoldVal:h,qnewVal:E,date:n.toString(),source:r})}}}},{key:"get",value:function(e){return this.reportValues.get(e)}},{key:"getReport",value:function(){var e=this.get("Estate");return void 0!==e&&"number"===typeof e&&this.report.push({name:"Estate final value",change:0,oldVal:0,newVal:e,qchange:0,qoldVal:0,qnewVal:0,date:"2999",source:"estate"}),this.report.reverse(),this.report}},{key:"keys",value:function(){return this.reportValues.keys()}}]),e}();function Un(e,t,a,n,r,s,o,i,c,u){var l=[];e.expenses.forEach((function(t){var r=n;t.CPI_IMMUNE&&(r=0),function(e,t,a){var n=parseFloat(e.GROWTH),r=0!==t?100*((1+(n+t)/100)/(1+t/100)-1):n,s=1,o=_a(e.RECURRENCE);o.frequency===L&&1===o.count||(s=o.count,o.frequency===_&&(s*=12)),a.set(e.NAME,{itemGrowth:e.GROWTH,powerByNumMonths:s,scale:Ne(r),applyCPI:!e.CPI_IMMUNE})}(t,r,a);var o=Xe(t.START,e.triggers),i=new Date(o),c=Xe(t.VALUE_SET,e.triggers);c<o&&c<i&&(i=c),i.setMonth(i.getMonth()+1);for(var u=new Date(o),h=0;i<=u;)if(u.setMonth(u.getMonth()-1),(h+=1)>1e3)throw new Error("".concat(t.NAME," start ").concat(t.START," too far ")+"from ".concat(i));var E=bn(t,Pa,xa,e.triggers,u,o,s,t.RECURRENCE);l=l.concat(E)})),e.incomes.forEach((function(t){var r=n;t.CPI_IMMUNE&&(r=0),function(e,t,a){var n=parseFloat(e.GROWTH),r=0!==t?100*((1+(n+t)/100)/(1+t/100)-1):n;a.set(e.NAME,{itemGrowth:e.GROWTH,powerByNumMonths:1,scale:Ne(r),applyCPI:!e.CPI_IMMUNE})}(t,r,a);var o=Xe(t.START,e.triggers),i=new Date(o),u=e.transactions.find((function(e){return e.NAME.startsWith($)&&e.TO===t.NAME}));if(void 0!==u){var h=e.incomes.find((function(e){return u.FROM===e.NAME}));if(void 0===h)throw Oe("Error: DB transaction ".concat(u.NAME," ")+"with no source income"),new Error("Error: DB transaction ".concat(u.NAME," ")+"with no source income");i=Xe(h.START,e.triggers)}var E=Xe(t.VALUE_SET,e.triggers);E<o&&E<i&&(i=E),i.setMonth(i.getMonth()+1);for(var d=new Date(o),p=0;i<=d;)if(d.setMonth(d.getMonth()-1),(p+=1)>1e3)throw new Error("".concat(t.NAME," start ").concat(t.START," too far ")+"from ".concat(i));var A=bn(t,Ba,Fa,e.triggers,d,o,s,"1m");l=l.concat(A),c.set(t.NAME,t.LIABILITY)})),e.assets.forEach((function(r){!function(e,t,a,n){var r=parseFloat(e.GROWTH);if(Number.isNaN(r)){var s=ur(n,e.GROWTH,"None");"None"===s&&(Oe("BUG : no setting value for asset growth ".concat(e.GROWTH)),s="0.0"),r=parseFloat(s),Number.isNaN(r)&&"None"===s&&(Oe("BUG : cant parse setting value for asset growth "+"".concat(e.GROWTH," = ").concat(s)),r=0)}var o=0!==t?100*((1+(r+t)/100)/(1+t/100)-1):r;a.set(e.NAME,{itemGrowth:e.GROWTH,powerByNumMonths:1,scale:Ne(o),applyCPI:!e.CPI_IMMUNE})}(r,r.CPI_IMMUNE?0:n,a,e.settings),function e(t,a,n,r,s,o,i){var c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,u=!1;if(u&&Oe("level".concat(c,": logAssetValueString processing ").concat(t," as value of ").concat(n)),Bn(t))return!0;var l=ur(i.settings,t,"missing",!1),h=!1;if("missing"===l){u&&Oe("there's no setting for ".concat(t));var E=ye(t);void 0!==E?(u&&Oe("level".concat(c,": go do work on ").concat(E," instead")),h=e(E,a,E,r,s,o,i,c+1)):(u&&Oe("level".concat(c,": we can't remove any number part of ").concat(t,", give up")),h=!1)}else{if(u&&Oe("level".concat(c,": we found ").concat(t," as a setting with value ").concat(l)),Bn(l))return u&&Oe("isNumber: level".concat(c,": go set the value of ").concat(t," as number ").concat(parseFloat(l))),nn(r,s,o,Xe(a,i.triggers),t,parseFloat(l),i,n,"8"),u&&Oe("level".concat(c,": return true")),!0;u&&Oe("level".concat(c,": go parse the value of ").concat(l)+" as a setting as a value definition"),h=e(l,a,t,r,s,o,i,c+1)}return h&&c>1?(n!==t&&(u&&Oe("parsedOK: level".concat(c,": go set the value of ").concat(n," as ").concat(t)),nn(r,s,o,Xe(a,i.triggers),n,t,i,n,"9")),u&&Oe("level".concat(c,": return true")),!0):(u&&Oe("level".concat(c,": return false")),!1)}(r.VALUE,r.START,r.NAME,t,a,i,e);var o=function(e,t,a){var n=La({start:Xe(e.START,t),end:a},"1m").map((function(t){return{date:t,name:e.NAME,type:Ga,setValue:0,transaction:void 0}}));return n.length>0&&(n[0].type=Wa,Bn(e.VALUE)?n[0].setValue=parseFloat(e.VALUE):n[0].setValue=e.VALUE),n}(r,e.triggers,s);l=l.concat(o),function(e,t){if(""!==e.LIABILITY)t.set(e.NAME,e.LIABILITY);else if(e.NAME.startsWith(q)){var a="".concat(e.NAME.substr(q.length)).split("."),n="".concat(a[0]).concat(K);t.set(e.NAME,n)}}(r,c)})),e.transactions.forEach((function(t){var a=function(e,t,a){var n=[];if(!e.NAME.startsWith(ee)&&(e.NAME.startsWith(Z)||e.NAME.startsWith(X)||e.NAME.startsWith($)))return n;if(e.RECURRENCE.length>0){var r=a;if(""!==e.STOP_DATE){var s=Xe(e.STOP_DATE,t);r>s&&(r=s)}La({start:Xe(e.DATE,t),end:r},e.RECURRENCE).forEach((function(t){n.push({name:e.NAME,date:t,type:Ha,setValue:void 0,transaction:e})}))}else{var o=Xe(e.DATE,t);o<a&&n.push({name:e.NAME,date:o,type:Ha,transaction:e,setValue:void 0})}return n}(t,e.triggers,s);l=l.concat(a),(t.NAME.startsWith(Z)||t.NAME.startsWith(X)||t.NAME.startsWith($))&&u.push(t),function(e,t,a){var n=e.FROM.split("/");(n=vr(n,a)).forEach((function(a){if(a.startsWith(q)){var n="".concat(a.substr(q.length)).split("."),r="".concat(n[0]).concat(K);t.set(e.NAME+a,r)}}))}(t,c,e)}));var h=[];return e.settings.forEach((function(n){("Grain"===n.NAME||n.NAME.startsWith("BMV")||"bondInterest"===n.NAME)&&nn(t,a,i,r,n.NAME,n.VALUE,e,n.NAME,"35");var s=e.assets.filter((function(e){return e.PURCHASE_PRICE===n.NAME}));(s=s.sort()).length>0&&void 0===t.get(n.NAME)&&nn(t,a,i,r,n.NAME,n.VALUE,e,n.NAME,"36");var o=e.transactions.filter((function(e){return!!(e.TO_VALUE.includes(n.NAME)||e.TO.includes(n.NAME)||e.FROM_VALUE.includes(n.NAME)||e.FROM.includes(n.NAME))})).map((function(e){return e.DATE})).map((function(e){return new Date(e)}));(o=(o=o.concat(e.assets.filter((function(e){return e.GROWTH===n.NAME})).map((function(e){return e.START})).map((function(t){return Xe(t,e.triggers)})))).sort()).length>0&&void 0===t.get(n.NAME)&&h.push({settingName:n.NAME,settingVal:n.VALUE,setDate:o[0]})})),e.settings.forEach((function(e){if(!h.find((function(t){return t.settingName===e.NAME}))){var t=h.find((function(t){return t.settingVal.includes(e.NAME)}));t&&h.push({settingName:e.NAME,settingVal:e.VALUE,setDate:t.setDate})}})),h.forEach((function(n){nn(t,a,i,n.setDate,n.settingName,n.settingVal,e,n.settingName,"18")})),s>o&&l.push({date:o,name:"EvaluateAllAssets",type:Ga,setValue:0,transaction:void 0}),l}function wn(e,t,a,n,r,s,o,i,c){e.assets.forEach((function(n){var o=t.get(n.NAME);"string"===typeof o&&(o=tn(o,t,a,o));var i=an(n.NAME,t,e);void 0!==i&&void 0!==o&&(o*=i),void 0!==o&&(n.IS_A_DEBT?s.set(n.NAME,{debtVal:o,category:n.CATEGORY}):r.set(n.NAME,{assetVal:o,assetQ:i,category:n.CATEGORY}))})),e.incomes.forEach((function(r){var s=Ze(r.START,e.triggers);if(void 0!==s&&s>n)o.set(r.NAME,{incomeVal:0,category:r.CATEGORY});else{var i=Ze(r.END,e.triggers);if(void 0!==i&&i<n)o.set(r.NAME,{incomeVal:0,category:r.CATEGORY});else{var c=t.get(r.NAME);"string"===typeof c&&(c=tn(c,t,a,c)),void 0!==c&&o.set(r.NAME,{incomeVal:c,category:r.CATEGORY})}}})),e.expenses.forEach((function(r){var s=Ze(r.START,e.triggers);if(void 0!==s&&s>n)i.set(r.NAME,{expenseVal:0,category:r.CATEGORY,expenseFreq:r.RECURRENCE});else{var o=Ze(r.END,e.triggers);if(void 0!==o&&o<n)i.set(r.NAME,{expenseVal:0,category:r.CATEGORY,expenseFreq:r.RECURRENCE});else{var c=t.get(r.NAME);"string"===typeof c&&(c=tn(c,t,a,c)),void 0!==c&&i.set(r.NAME,{expenseVal:c,expenseFreq:r.RECURRENCE,category:r.CATEGORY})}}})),e.settings.forEach((function(e){var a=t.get(e.NAME);void 0!==a&&c.set(e.NAME,{settingVal:"".concat(a)})}))}function Dn(e,t,a,n,r,s,o,i,c){var u=rn(n.date),l=sn(n.date),h=void 0!==r.startYearOfTaxYear&&u>r.startYearOfTaxYear,E=void 0!==r.startYearOfTaxYear&&void 0!==r.monthOfTaxYear&&l!==r.monthOfTaxYear;void 0!==r.startYearOfTaxYear&&void 0!==r.monthOfTaxYear&&E&&function(e,t,a,n,r,s,o,i){var c=e.get("(NI)");void 0===c&&(c=new Map,e.set("(NI)",c));var u=t.get("(NI)");void 0===u&&(u=new Map,t.set("(NI)",u));var l,h=Object(m.a)(c);try{for(h.s();!(l=h.n()).done;){var E=Object(f.a)(l.value,2),d=E[0],p=E[1];if(p>0){var A=pn(ln(12*p,a,r)),T=Math.floor(A/12*100+1e-5)/100;if(T>0){hn(-T,vn(a,n),r,s,o,i,d);var v=u.get(d);void 0===v&&(v=0),v+=T,u.set(d,v)}}c.set(d,0)}}catch(g){h.e(g)}finally{h.f()}}(o,i,r.startYearOfTaxYear,r.monthOfTaxYear,t,a,c,e),void 0!==r.startYearOfTaxYear&&h&&(Tn(s,o,i,r.startYearOfTaxYear,t,a,c,e),r.startYearOfTaxYear=u,r.monthOfTaxYear=3),void 0!==r.startYearOfTaxYear&&void 0!==r.monthOfTaxYear&&E&&function(e,t,a,n,r,s,o,i){var c=e.get(K);void 0===c&&(c=new Map,e.set(K,c));var u=t.get(K);void 0===u&&(u=new Map,t.set(K,u));var l,h=Object(m.a)(c);try{for(h.s();!(l=h.n()).done;){var E=Object(f.a)(l.value,2),d=E[0],p=E[1];if(3!==n&&p>0){var A=En(un(12*p,a,r)),T=Math.floor(A/12*100+1e-5)/100;if(T>0){hn(-T,vn(a,n),r,s,o,i,d);var v=u.get(d);void 0===v&&(v=0),v+=T,u.set(d,v)}}c.set(d,0)}}catch(g){h.e(g)}finally{h.f()}}(o,i,r.startYearOfTaxYear,r.monthOfTaxYear,t,a,c,e),(h||E)&&(r.monthOfTaxYear=l)}function _n(e,t,a){var n=$a(e,"base"),r=$a(e,b);if(void 0!==n&&void 0!==r){var s=n*(1+Ne(r));e.set("base",s,t,a,"baseChange","38")}else Oe("BUG: missing baseObj or infObj for CPI handling; ".concat(n,", ").concat(r))}function Ln(e,t,a){var n=on["".concat(2022)],r=$a(e,"base");if(void 0!==n&&void 0!==r){var s=n.noTaxBand/r,o=n.lowTaxBand/r,i=n.highTaxBand/r,c=n.adjustNoTaxBand/r,u=n.noNIBand/r,l=n.lowNIBand/r;e.set("noTaxBand",s,t,a.date,a.name,"39"),e.set("lowTaxBand",o,t,a.date,a.name,"39"),e.set("highTaxBand",i,t,a.date,a.name,"39"),e.set("adjustNoTaxBand",c,t,a.date,a.name,"39"),e.set("noNIBand",u,t,a.date,a.name,"39"),e.set("lowNIBand",l,t,a.date,a.name,"39")}else Oe("BUG : undefined resultFromMap or baseVal")}function xn(e,t,a,n,r,s,o,i,c){if(void 0===n.setValue)throw Oe("BUG!!! starts of income/asset/expense should have a value!"),new Error("BUG starts of income/asset/expense should have a value!");if(n.type===Wa){var u=We(n.name,e);void 0!==u&&nn(t,a,c,n.date,"quantity"+n.name,u,e,n.name,"19");var l=e.assets.filter((function(e){return e.NAME===n.name}));if(1!==l.length)throw new Error("BUG!!! '".concat(n.name,"' doesn't match one asset"));!function(e,t,a,n,r){if(e.LIABILITY.includes(z)){var s=0;if(Bn(e.PURCHASE_PRICE))s=parseFloat(e.PURCHASE_PRICE);else{var o=tn(e.PURCHASE_PRICE,t,a,e.NAME);if(void 0===o)throw new Error("BUG!! in logPurchaseValues, value of ".concat(e.PURCHASE_PRICE," can't be understood"));s=o}""!==e.QUANTITY&&(s*=parseFloat(e.QUANTITY)),nn(t,a,n,Xe(e.START,r.triggers),"".concat("Purchase").concat(e.NAME),s,r,"".concat("Purchase").concat(e.NAME),"17")}}(l[0],t,a,c,e)}var h,E=n.setValue,d=E;if(en(n.name,a,t).adjustForCPI)if("number"===typeof d?h=d:Bn(d)&&(h=parseFloat(d)),void 0!==h){var p=$a(t,"base");p&&(d=h/p)}else Oe("don't scale something that's not a number");if(n.type===Ya||n.type===ka?t.set(n.name,d,a,n.date,n.name,"20"):nn(t,a,c,n.date,n.name,d,e,n.name,"20"),n.type===ja){var A=tn(E,t,a,n.name);if(void 0===A)throw new Error("can't interpret ".concat(E," as a number"));On(A,n,t,a,c,e,r,s,o,i,n.name)}else n.type===Va&&hn(-E,n.date,t,a,c,e,n.name)}function Pn(e,t,a,n,r,s,o,i,c){var u=tn(n.name,t,a,n.name);if(void 0===u){var l=t.get(n.name);void 0!==l&&nn(t,a,c,n.date,n.name,l,e,"growth","21")}else{var h=en(n.name,a,t),E=$a(t,"base"),d=u;if(u&&h&&h.adjustForCPI&&E&&(d/=E),h){var p=0,A=0,f=h.scale;0,0!==f&&(A=p=d*f);var m=0;h.adjustForCPI&&(E?1!==E&&(m=d*(E-1),A=p):Oe("Bug - missing or zero baseVal"));var T=d;if(0===p){var v=t.get(n.name);void 0!==v&&(T=v)}else T+=p;if(n.type===Pa||n.type===Ba&&!n.name.startsWith($)?t.set(n.name,T,a,n.date,"growth","22"):nn(t,a,c,n.date,n.name,T,e,"growth","22"),n.type===Ga){var g=m+A;n.name.startsWith(q)&&g>0||On(g,n,t,a,c,e,r,s,o,i,n.name)}else if(n.type===Fa){On(d+m+A,n,t,a,c,e,r,s,o,i,n.name)}else if(n.type===xa){hn(-(d+m+A),n.date,t,a,c,e,n.name)}}else Oe("BUG : missing growth for ".concat(n.name));0}}function Vn(e,t){var a=new Map,n=new Map,r=new Map,s=new Map,o=new Map,i=tr(e);if(i.length>0)return Oe(i),{evaluations:[],todaysAssetValues:a,todaysDebtValues:n,todaysIncomeValues:r,todaysExpenseValues:s,todaysSettingValues:o,reportData:[]};var c=new In;t&&c.setIncludeInReport(t);var u=new Map,l=parseFloat(ur(e.settings,b,"0.0")),h=Re(ur(e.settings,C,"1 Jan 1999")),E=Re(ur(e.settings,M,"1 Jan 1999")),d=hr(e),p=[],A=new Map([]),f=[],m=Un(e,c,u,l,h,E,d,p,A,f).filter((function(e){return void 0!==e.date}));if(Ka(m),m.length>0){c.set(b,l,u,m[0].date,"start value","0"),c.set("base",1,u,m[0].date,"start value","0");var T=m[0].date,v=La({start:m[m.length-1].date,end:T},"1m").map((function(e){return{date:e,name:b,type:Ja,setValue:NaN,transaction:void 0}}));if(m=m.concat(v),new Date(2022,3,5)<E){var g=new Date(2022,3,4);m.push({date:g,name:"captureLastTaxBands",type:Ja,setValue:NaN,transaction:void 0})}Ka(m)}var O={startYearOfTaxYear:void 0,monthOfTaxYear:void 0};m.length>0&&(O.startYearOfTaxYear=rn(m[m.length-1].date),O.monthOfTaxYear=sn(m[m.length-1].date));for(var N=new Map,R=new Map,y=new Map;m.length>0;){var S=m.pop();if(void 0===S)throw new Error("BUG!!! array length > 0 should pop!");0,"EvaluateAllAssets"===S.name&&wn(e,c,u,d,a,n,r,s,o),Dn(e,c,u,S,O,N,R,y,p),"EvaluateAllAssets"===S.name||(S.name===b?_n(c,u,S.date):"captureLastTaxBands"===S.name?Ln(c,u,S):S.type===Ha?Sn(S,c,u,p,e,f,A,N,R):S.type===Va||S.type===ka||S.type===ja||S.type===Ya||S.type===Wa?xn(e,c,u,S,f,A,N,R,p):Pn(e,c,u,S,f,A,N,R,p)),void 0!==O.startYearOfTaxYear&&0===m.length?Tn(N,R,y,O.startYearOfTaxYear,c,u,p,e):m.length}return{evaluations:p,todaysAssetValues:a,todaysDebtValues:n,todaysIncomeValues:r,todaysExpenseValues:s,todaysSettingValues:o,reportData:c.getReport()}}function kn(e,t){var a=Re(ur(e.settings,C,"1 Jan 1999")),n=Re(ur(e.settings,M,"1 Jan 1999")),r=e.transactions.filter((function(e){return e.FROM_VALUE.startsWith("BMV")&&"Cash"===e.TO}));r.forEach((function(e){var t=new Date(e.DATE);t>n&&(n=t)})),n.setMonth(n.getMonth()+1);var s={triggers:e.triggers,expenses:[],incomes:[],transactions:e.transactions.filter((function(e){return"revalueSetting"===e.TYPE||e.FROM_VALUE.startsWith("BMV")})),assets:e.assets.filter((function(t){return"Cash"===t.NAME||void 0!==e.transactions.find((function(e){return e.FROM_VALUE.startsWith("BMV")&&e.FROM===t.NAME}))})).concat([{NAME:"".concat("BMV","base"),CATEGORY:"",START:a.toDateString(),VALUE:"1.0",QUANTITY:"",GROWTH:"0.0",CPI_IMMUNE:!1,CAN_BE_NEGATIVE:!0,IS_A_DEBT:!1,LIABILITY:"",PURCHASE_PRICE:"0.0"}]),settings:e.settings.concat([{NAME:"".concat("BMV","Prerun"),VALUE:"0.0",HINT:"suppress warnings on prerun",TYPE:"const"}]),version:e.version,undoModel:void 0,redoModel:void 0},o=e.settings.find((function(e){return e.NAME===M})),i="";o&&(i=o.VALUE,o.VALUE=n.toDateString());var u=Vn(s,void 0);o&&(o.VALUE=i);for(var l=[],h=function(e){var t=u.evaluations[e];if("Cash"===t.name)return"continue";var a=r.find((function(e){return e.NAME===t.source}));void 0!==a&&function(){for(var n="".concat(a.FROM_VALUE).concat("/").concat(t.date.toDateString()).concat("/").concat(b),r=1,s=0;s<u.evaluations.length;s+=1){var o=u.evaluations[s];if(o.name!=="".concat("BMV","base")){if(o.name===a.FROM_VALUE.substring("BMV".length)&&"Revalue"===o.source)break}else r=o.value}for(var i=e;i>0;i-=1){var c=u.evaluations[i];if(c.name.startsWith("".concat("BMV","base"))){var h=c.value;void 0===l.find((function(e){return e.NAME===n}))&&l.push({NAME:n,VALUE:"".concat(h/r),HINT:"autogenerated setting for Bond maturity values",TYPE:"const"});break}}}()},E=0;E<u.evaluations.length;E+=1)h(E);return Vn(Object(c.a)(Object(c.a)({},e),{},{settings:e.settings.concat(l)}),t)}var Fn=new Map;function Bn(e){if(""===e||void 0===e)return!1;if("number"===typeof e)return e;var t=Fn.get(e);if(void 0!==t)return t;if(!e.replace)return Oe("input has no replace; ".concat(e)),"";var a=new RegExp("^[+-]?([0-9]+([.][0-9]*)?|[.][0-9]+)$"),n=""===e.replace(a,"");return Fn.set(e,n),n}function jn(e,t,a,n,r,s){if(void 0!==r.find((function(e){return(e.NAME===t||e.CATEGORY===t)&&Xe(e.START,n)<=Xe(a,n)})))return!0;var o=s.find((function(r){return r.NAME===t&&(e.startsWith($)||e.startsWith(X)||Xe(r.START,n)<=Xe(a,n))}));return void 0!==o?!!(e.startsWith(Z)||e.startsWith(X)||e.startsWith($)||e.startsWith(ee))||(Oe("Transaction ".concat(e," from income\n        ").concat(t," must be pension-related")),!1):void 0!==(o=s.find((function(e){return e.LIABILITY.includes(t)&&Xe(e.START,n)<=Xe(a,n)})))}function Yn(e){return!(Number.isNaN(e.getTime())||e<Re("1 Jan 1870")||e>Re("1 Jan 2199"))}function Gn(e){return e.length>0&&!e.endsWith(z)&&!e.endsWith(K)&&!e.endsWith("(NI)")?"Asset liability ".concat(e," should end with ").concat(z,", ").concat(K," or ").concat("(NI)"):""}function Wn(e,t){if(0===e.length)return!1;if(Bn(e))return!0;var a=Ce(e);if(void 0!==a.wordPart){if("missing"!==ur(t.settings,a.wordPart,"missing",!1))return!0;if(mr(a.wordPart,t))return!0}return!1}function Hn(e,t){if(0===e.NAME.length)return"Name should be not empty";if(1!==e.NAME.split("/").length)return"Asset name '".concat(e.NAME,"' should not contain '").concat("/","'");if(parseFloat(e.VALUE)<0&&!e.CAN_BE_NEGATIVE)return"Asset '".concat(e.NAME,"' can't be negative but has negative value '").concat(e.VALUE,"'");if(e.LIABILITY.length>0)for(var a=e.LIABILITY.split("/"),n=0;n<a.length;n+=1){var r=Gn(a[n]);if(r.length>0)return r}if(!Bn(e.GROWTH)){var s=ur(t.settings,e.GROWTH,"missing");if("missing"===s)return"Asset growth set to '".concat(e.GROWTH,"'\n        but no corresponding setting found");if(!Bn(s))return"Asset growth set to '".concat(e.GROWTH,"'\n        but corresponding setting not a number")}if(!Wn(e.VALUE,t))return"Asset value set to '".concat(e.VALUE,"'\n      but no corresponding setting found");if(!Bn(e.VALUE)){if(0!==parseFloat(e.GROWTH))return"Asset value '".concat(e.VALUE,"' may not have nonzero growth");if(!e.CPI_IMMUNE)return"Asset value '".concat(e.VALUE,"' may not grow with CPI")}if(!Bn(e.PURCHASE_PRICE)&&""===ur(t.settings,e.PURCHASE_PRICE,"",!1))return"Purchase price '".concat(e.PURCHASE_PRICE,"' should be a numerical or setting value");var o=Ze(e.START,t.triggers);return void 0!==o&&Yn(o)?"":"Asset start date doesn't make sense :\n      ".concat(be(e.START))}function Jn(e){return e.length>0&&!e.endsWith(K)&&!e.endsWith("(NI)")?"Income liability '".concat(e,"' should end with ")+"'".concat(K,"' or '").concat("(NI)","'"):""}function Kn(e,t){if(0===e.NAME.length)return"Income name needs some characters";var a=e.LIABILITY.split("/");if(a.length>3)return"Income liability for '".concat(e.NAME,"' has parts '").concat(a,"' ")+"but should contain at most two parts";var n,r="",s="",o=Object(m.a)(a);try{for(o.s();!(n=o.n()).done;){var i=n.value;if(i.length>0&&!i.endsWith(K)&&!i.endsWith("(NI)"))if(Jn(i).length>0)return"Income liability for '".concat(e.NAME,"' has parts '").concat(a,"' ")+"but the part '".concat(i,"' should end with ")+"'".concat(K,"' or '").concat("(NI)","'");if(i.endsWith(K)?r=i.substring(0,i.length-K.length):i.endsWith("(NI)")&&(s=i.substring(0,i.length-"(NI)".length)),""!==r&&""!==s&&r!==s)return"Income liability for '".concat(e.NAME,"' has parts '").concat(a,"' ")+"but it should be the same person liable for NI and income tax'"}}catch(d){o.e(d)}finally{o.f()}if(!Bn(e.GROWTH))return"Income growth '".concat(e.GROWTH,"' is not a number");if(!Wn(e.VALUE,t))return"Income value '".concat(e.VALUE,"' does not make sense");if(!Bn(e.VALUE)){if(0!==parseFloat(e.GROWTH))return"Income value '".concat(e.VALUE,"' may not have nonzero growth");if(!e.CPI_IMMUNE)return"Income value '".concat(e.VALUE,"' may not grow with CPI")}var c=Ze(e.START,t.triggers);if(void 0===c||!Yn(c))return"Income start date doesn't make sense : ".concat(be(e.START));var u=t.assets.filter((function(e){return"Cash"===e.NAME}));if(u.length>0){var l=Xe(u[0].START,t.triggers);if(c<l)return"Income start date must be after cash starts; ".concat(l.toDateString())}if(t.assets.filter((function(e){return"TaxPot"===e.NAME})).length>0)return"We don't need taxPot any more";var h=Ze(e.VALUE_SET,t.triggers);if(void 0===h||!Yn(h))return"Income value set date doesn't make sense : ".concat(be(e.VALUE_SET));var E=Ze(e.END,t.triggers);return void 0!==E&&Yn(E)?h>c?"Income value must be set on or before the start of the income.\n      For ".concat(e.NAME,", start is ").concat(c.toDateString()," and\n      value is set ").concat(h.toDateString(),"."):"":"Income end date doesn't make sense : ".concat(be(e.END))}function Qn(e){var t=e.substring(e.length-1);if("m"!==t&&"y"!==t)return"transaction recurrence '".concat(e,"' must end in m or y");var a=e.substring(0,e.length-1),n=parseFloat(a);return Number.isNaN(n)?"transaction recurrence '".concat(e,"' must be a number ending in m or y"):""}function qn(e,t){if(0===e.NAME.length)return"Expense name needs some characters";if(!Bn(e.VALUE))return"Expense value '".concat(e.VALUE,"' is not a number");if(!Bn(e.GROWTH))return"Expense growth '".concat(e.GROWTH,"' is not a number");var a=Ze(e.START,t.triggers);if(void 0===a||!Yn(a))return"Expense start date doesn't make sense :\n      ".concat(be(e.START));var n=Ze(e.VALUE_SET,t.triggers);if(void 0===n||!Yn(n))return"Expense value set date doesn't make sense :\n      ".concat(be(e.VALUE_SET));var r=Ze(e.END,t.triggers);if(void 0===r||!Yn(r))return"Expense end date doesn't make sense :\n      ".concat(be(e.END));if(n>a)return"Expense value must be set on or before the start of the income.\n      For ".concat(e.NAME,", start is ").concat(a.toDateString()," and\n      value is set ").concat(n.toDateString(),".");var s=Qn(e.RECURRENCE);return""!==s?s:""}function zn(e,t,a,n,r,s,o){var i=a.find((function(t){return t.NAME===e||t.CATEGORY===e}));if(void 0!==i)return t.NAME.startsWith($)?"Transaction ".concat(va(t.NAME,t.TYPE)," should have TO an income not an asset : ").concat(i.NAME):Xe(i.START,s)>Xe(t.DATE,s)?"Transaction ".concat(va(t.NAME,t.TYPE)," dated before start ")+"of affected asset : ".concat(i.NAME):"";var c=n.find((function(t){return t.NAME===e}));if(void 0!==c)return t.NAME.startsWith("Revalue")||t.NAME.startsWith($)||t.NAME.startsWith(ee)?t.NAME.startsWith($)&&!c.NAME.startsWith($)?"Transaction ".concat(va(t.NAME,t.TYPE)," must have TO income ").concat(t.TO," named starting ").concat($):!t.NAME.startsWith($)&&Xe(c.START,s)>Xe(t.DATE,s)?"Transaction ".concat(va(t.NAME,t.TYPE)," dated before start ")+"of affected income : ".concat(c.NAME):"":"Transactions to incomes must begin '".concat("Revalue","' ")+"or '".concat($," or ").concat(ee);var u=r.find((function(t){return t.NAME===e}));return void 0!==u?t.NAME.startsWith("Revalue")?Xe(u.START,s)>Xe(t.DATE,s)?"Transaction ".concat(va(t.NAME,t.TYPE)," dated before start ")+"of affected expense : ".concat(u.NAME):Xe(u.END,s)<Xe(t.DATE,s)?"Transaction ".concat(va(t.NAME,t.TYPE)," dated after end ")+"of affected expense : ".concat(u.NAME):"":"Transactions to expenses must begin '".concat("Revalue","'"):void 0!==o.find((function(t){return t.NAME===e}))?t.NAME.startsWith("Revalue")?"":"Transactions to setting must begin '".concat("Revalue","'"):"Transaction ".concat(va(t.NAME,t.TYPE)," to unrecognised thing : ").concat(e)}function Zn(e,t){var a=!1;return e.NAME.startsWith("Revalue")&&function(e,t){return void 0!==t.settings.find((function(t){return t.NAME===e}))}(e.TO,t)&&""===e.CATEGORY&&(a=!0),a}function Xn(e,t){var a=t.assets,n=t.incomes,r=t.expenses,s=t.triggers,o=t.settings;if(0===e.NAME.length)return"Transaction name needs some characters";if(e.NAME.startsWith(re)&&""===e.TO)return"conditional transactions need a To asset defined";var i=Ze(e.DATE,s);if(void 0===i||!Yn(i))return"Transaction has bad date : ".concat(be(e.DATE));if(""!==e.FROM){if(!jn(e.NAME,e.FROM,e.DATE,s,a,n))for(var c=e.FROM.split("/"),u=c.length,l=0;l<u;l+=1){var h=c[l];if(!jn(e.NAME,h,e.DATE,s,a,n))return"Transaction from unrecognised asset (could "+"be typo or before asset start date?) : ".concat(be(h))}if(""===e.FROM_VALUE)return"Transaction from ".concat(e.FROM," needs a non-empty from value");if(!Bn(e.FROM_VALUE)){var E=function(e,t){var a=t.find((function(t){return t.NAME===e}));if(void 0!==a)return"";if(e.startsWith("BMV")){var n=e.substring("BMV".length);if(void 0!==(a=t.find((function(e){return e.NAME===n}))))return""}return"Transaction 'from' value must be numbers or a setting, not ".concat(e)}(e.FROM_VALUE,o);if(""!==E)return E}}if(""!==e.TO){if(e.NAME.startsWith("Revalue")){var d=e.TO.split("/");d=vr(d,t);for(var p=0;p<d.length;p+=1){var A=zn(d[p],e,a,n,r,s,o);if(A.length>0)return A}}else{var f=zn(e.TO,e,a,n,r,s,o);if(f.length>0)return f}if("revalueSetting"===e.TYPE);else{if(""===e.TO_VALUE)return"Transaction to ".concat(e.TO," needs a non-empty to value");if(!Wn(e.TO_VALUE,t))return"Transaction to value ".concat(e.TO_VALUE," isn't a number or setting")}}if(e.RECURRENCE.length>0){if(e.NAME.startsWith(Z)||e.NAME.startsWith(X)||e.NAME.startsWith($))return"Pension transaction ".concat(va(e.NAME,e.TYPE)," gets frequency from income, ")+"should not have recurrence ".concat(e.RECURRENCE," defined");var m=Qn(e.RECURRENCE);if(""!==m)return m}if("auto"!==e.TYPE&&"custom"!==e.TYPE&&"liquidateAsset"!==e.TYPE&&"payOffDebt"!==e.TYPE&&"bondInvest"!==e.TYPE&&"bondMature"!==e.TYPE&&"revalueAsset"!==e.TYPE&&"revalueDebt"!==e.TYPE&&e.TYPE!==se&&e.TYPE!==oe&&"revalueSetting"!==e.TYPE)return"transaction type  ".concat(e.TYPE," for ").concat(va(e.NAME,e.TYPE)," is not one of allowed types - internal bug");if("auto"===e.TYPE&&!function(e,t){var a=!1;return(e.NAME.startsWith(Z)||e.NAME.startsWith(X))&&(""===e.FROM||Ar(e.FROM,t))&&!1===e.TO_ABSOLUTE&&e.TO.startsWith(Z)&&!1===e.FROM_ABSOLUTE&&""===e.RECURRENCE&&(a=!0),!a&&e.NAME.startsWith(te)&&e.FROM.startsWith(Z)&&!1===e.FROM_ABSOLUTE&&e.TO.startsWith(ae)&&!1===e.TO_ABSOLUTE&&""===e.RECURRENCE&&(a=!0),!a&&e.NAME.startsWith(q)&&e.FROM.startsWith(Z)&&!1===e.FROM_ABSOLUTE&&e.TO.startsWith(q)&&""===e.RECURRENCE&&(a=!0),!a&&e.NAME.startsWith(ne)&&e.FROM.startsWith(q)&&!1===e.FROM_ABSOLUTE&&e.TO.startsWith(q)&&""===e.RECURRENCE&&(a=!0),(e.NAME.startsWith(Z)||e.NAME.startsWith(X))&&Ar(e.FROM,t)&&!1===e.FROM_ABSOLUTE&&""===e.TO&&""===e.RECURRENCE&&(a=!0),e.NAME.startsWith($)&&Ar(e.FROM,t)&&!1===e.FROM_ABSOLUTE&&!1===e.TO_ABSOLUTE&&""===e.RECURRENCE&&(a=!0),e.NAME.startsWith(ee)&&Ar(e.FROM,t)&&e.FROM.startsWith($)&&!1===e.FROM_ABSOLUTE&&e.TO.startsWith(ee)&&!1===e.TO_ABSOLUTE&&""===e.RECURRENCE&&(a=!0),a}(e,t))return Oe("bad transaction ".concat(be(e)," in model ").concat(be(t))),"autogenerated type of transaction ".concat(va(e.NAME,e.TYPE)," not a recognised format");if("liquidateAsset"===e.TYPE&&!function(e){var t=!1;return e.NAME.startsWith(re)&&"Cash"===e.TO&&(t=!0),t}(e))return"liquidating type of transaction ".concat(va(e.NAME,e.TYPE)," not a recognised format");if("payOffDebt"===e.TYPE&&!function(e,t){var a=!1;return e.NAME.startsWith(re)&&"Cash"===e.FROM&&pr(e.TO,t)&&(a=!0),a}(e,t))return"payoff debt type of transaction ".concat(va(e.NAME,e.TYPE)," not a recognised format");if("bondInvest"===e.TYPE){if("Cash"!==e.FROM)return"May only invest in Bond from ".concat("Cash"," : malformed transaction ").concat(e.NAME);if(!e.FROM_VALUE.startsWith("BMV"))return"Investment in Bond needs ".concat("BMV"," as start of from value : malformed transaction ").concat(e.NAME);var T=e.FROM_VALUE.substring("BMV".length),v=t.settings.filter((function(e){return e.NAME===T}));if(0===v.length)return"May only invest into Bond if there's a setting ".concat(T," : malformed transaction ").concat(e.NAME);if(v.length>1)return"May only invest into Bond if there's a unique setting ".concat(T," : malformed transaction ").concat(e.NAME);var g=t.transactions.filter((function(e){return"revalueSetting"===e.TYPE&&e.TO===T}));if(0===g.length)return"May only invest into Bond if the setting ".concat(T," is revalued ")+"(so we capture the revalue date) : malformed transaction ".concat(e.NAME);if(g.filter((function(t){return new Date(t.DATE)>new Date(e.DATE)})).length>0)return"May only invest into Bond if the setting ".concat(T," is not revalued ")+"after investment date : malformed transaction ".concat(e.NAME)}else if("bondMature"===e.TYPE){if("Cash"!==e.TO)return"May only mature from Bond to ".concat("Cash"," : malformed transaction ").concat(e.NAME);if(!e.FROM_VALUE.startsWith("BMV"))return"Maturing Bond needs ".concat("BMV"," as start of from value : malformed transaction ").concat(e.NAME);var O=t.transactions.filter((function(t){return"bondInvest"===t.TYPE&&(t.FROM_VALUE===e.FROM_VALUE&&(t.RECURRENCE===e.RECURRENCE&&(Rn(new Date(t.DATE),t.NAME).toDateString()===new Date(e.DATE).toDateString()&&Rn(new Date(t.STOP_DATE),t.NAME).toDateString()===new Date(e.STOP_DATE).toDateString())))}));if(1!==O.length)return 0===O.length?"Malformed model : bond maturation ".concat(e.NAME," requires an investment"):"Malformed model : bond maturation ".concat(e.NAME," requires only one investment")}else if(e.FROM_VALUE.startsWith("BMV"))return"Malformed transaction : only ".concat("bondInvest"," and ").concat("bondMature"," types use ").concat("BMV");if("revalueAsset"===e.TYPE&&!function(e,t){var a=!1;return e.NAME.startsWith("Revalue")&&mr(e.TO,t)&&""===e.CATEGORY&&(a=!0),a}(e,t))return"revalue asset type of transaction ".concat(va(e.NAME,e.TYPE)," not a recognised format");if("revalueDebt"===e.TYPE&&!function(e,t){var a=!1;return e.NAME.startsWith("Revalue")&&pr(e.TO,t)&&""===e.CATEGORY&&(a=!0),a}(e,t))return"revalue debt type of transaction ".concat(va(e.NAME,e.TYPE)," not a recognised format");if(e.TYPE===se&&!function(e,t){var a=!1;return e.NAME.startsWith("Revalue")&&Ar(e.TO,t)&&""===e.CATEGORY&&(a=!0),a}(e,t))return"revalue income type of transaction ".concat(va(e.NAME,e.TYPE)," not a recognised format");if(e.TYPE===oe&&!function(e,t){var a=!1;return e.NAME.startsWith("Revalue")&&fr(e.TO,t)&&""===e.CATEGORY&&(a=!0),a}(e,t))return"revalue expense type of transaction ".concat(va(e.NAME,e.TYPE)," not a recognised format");if("revalueSetting"===e.TYPE&&!Zn(e,t))return"revalue setting type of transaction ".concat(va(e.NAME,e.TYPE)," not a recognised format");if("custom"===e.TYPE&&!function(e){var t=!1;return e.NAME.startsWith(re)||e.NAME.startsWith(q)||e.NAME.startsWith($)||e.NAME.startsWith("Revalue")||(t=!0),!t&&e.NAME.startsWith("Revalue")&&(t=!0),t}(e))return"custom type of transaction ".concat(va(e.NAME,e.TYPE)," not a recognised format");var b=parseFloat(e.TO_VALUE),N=parseFloat(e.FROM_VALUE);return!e.FROM_ABSOLUTE&&N>1&&Oe("WARNING : not-absolute value from ".concat(N," > 1.0")),!e.TO_ABSOLUTE&&b>1&&!e.NAME.startsWith(Z)&&!e.NAME.startsWith(X)&&"revalueAsset"!==e.TYPE&&e.TYPE!==oe&&e.TYPE!==se&&"revalueSetting"!==e.TYPE&&Oe("WARNING : ".concat(e.NAME," has not-absolute value to ").concat(b," > 1.0")),""}function $n(e,t){var a,n=0===(a=e.NAME).length?"Date name needs some characters":"today"===a?"Date name can't be 'today'":a.includes("+")?"Date names cannot contain a '+' character":a.includes("-")?"Date names cannot contain a '-' character":"";return n.length>0?n:Ze(e.DATE,t.triggers)?"":"Your important date is not valid : ".concat(e.DATE)}function er(e,t){return"noneFound"!==ur(e,t,"noneFound",!1)?'"'.concat(t,'" setting should not be present'):""}function tr(e){var t=function(e){var t=e.assets.map((function(e){return e.NAME}));if((t=(t=(t=(t=(t=t.concat(e.incomes.map((function(e){return e.NAME})))).concat(e.expenses.map((function(e){return e.NAME})))).concat(e.transactions.map((function(e){return e.NAME})))).concat(e.triggers.map((function(e){return e.NAME})))).concat(e.settings.map((function(e){return e.NAME})))).find((function(e){return"base"===e})))return"'base' as name is reserved";var a,n=t.filter((function(e){return!e.startsWith(Z)})).filter((function(e){return!e.startsWith(ee)})).filter((function(e){return!e.startsWith($)})).reduce((function(e,t){var a=e.get(t);return void 0===a?e.set(t,1):e.set(t,a+1),e}),new Map),r=Object(m.a)(n);try{for(r.s();!(a=r.n()).done;){var s=Object(f.a)(a.value,2),o=s[0];if(s[1]>1)return"duplicate name ".concat(o)}}catch(i){r.e(i)}finally{r.f()}return""}(e);if(t.length>0)return t;if((t=er(e.settings,D)).length>0)return t;if((t=er(e.settings,x)).length>0)return t;if((t=function(e){var t=ur(e,C,"noneFound");if("noneFound"===t)return'"'.concat(C,'" should be present in settings (value is a date)');var a=Re(t);if(Number.isNaN(a.getTime()))return'Setting "'.concat(C,'" should be a valid date string (e.g. 1 April 2018)');var n=ur(e,M,"noneFound");if("noneFound"===n)return'"'.concat(M,'" should be present in settings (value is a date)');var r=Re(n);return Number.isNaN(r.getTime())?'Setting "'.concat(M,'" should be a valid date string (e.g. 1 April 2018)'):r<a?'Setting "'.concat(M,'" should be after setting "').concat(C,'"'):""}(e.settings)).length>0)return t;if((t=er(e.settings,J)).length>0)return t;if((t=function(e){var t=ur(e,S,"");return""===t||Yn(Re(t))?"":"Date of birth ".concat(t," should parse and be reasonable")}(e.settings)).length>0)return t;if((t=function(e){var t=ur(e,b,""),a=parseFloat(t);return Number.isNaN(a)?"Setting for CPI should be a number":""}(e.settings)).length>0)return t;if((t=er(e.settings,F)).length>0)return t;if((t=er(e.settings,B)).length>0)return t;if((t=er(e.settings,j)).length>0)return t;if((t=er(e.settings,Y)).length>0)return t;if((t=er(e.settings,W)).length>0)return t;var a,n=Object(m.a)(e.transactions);try{for(n.s();!(a=n.n()).done;){if((t=Xn(a.value,e)).length>0)return t}}catch(E){n.e(E)}finally{n.f()}var r,s=Object(m.a)(e.assets);try{for(s.s();!(r=s.n()).done;){if((t=Hn(r.value,e)).length>0)return t}}catch(E){s.e(E)}finally{s.f()}var o,i=Object(m.a)(e.incomes);try{for(i.s();!(o=i.n()).done;){if((t=Kn(o.value,e)).length>0)return t}}catch(E){i.e(E)}finally{i.f()}var c,u=Object(m.a)(e.expenses);try{for(u.s();!(c=u.n()).done;){if((t=qn(c.value,e)).length>0)return t}}catch(E){u.e(E)}finally{u.f()}var l,h=Object(m.a)(e.triggers);try{for(h.s();!(l=h.n()).done;){if((t=$n(l.value,e)).length>0)return t}}catch(E){h.e(E)}finally{h.f()}return""}var ar=new Map([[M,"view"],[C,"view"],[S,"view"],[D,"view"],[L,"view"],[x,"view"],[F,"view"],[B,"view"],[j,"view"],[Y,"view"],[J,"view"],[b,"const"]]);function nr(e){var t=ar.get(e);return void 0!==t?t:"const"}function rr(e){[D,J,"Type of view for debt chart",x,F,B,j,Y,G,W,H].forEach((function(t){var a,n=e.settings.findIndex((function(e){return e.NAME===t}));n>=0&&(a=e.settings[n],$o&&$o.state.viewState.migrateViewSettingString(a.NAME,a.VALUE),e.settings.splice(n,1))})),e.version=5}function sr(e,t,a,n){e.transactions.forEach((function(e){t.forEach((function(t){e.NAME.startsWith(t.oldPart)&&(e.NAME="".concat(t.newPart).concat(e.NAME.substring(t.oldPart.length)));var a=e.FROM.split("/"),n=[],r=!1;a.forEach((function(e){e.startsWith(t.oldPart)&&(e="".concat(t.newPart).concat(e.substring(t.oldPart.length)),r=!0),"TaxFree"===t.oldPart&&e.endsWith(t.oldPart)&&(e="".concat(t.newPart).concat(e.substring(0,e.length-t.oldPart.length)),r=!0),n.push(e)})),r&&(e.FROM="",n.forEach((function(t){e.FROM="".concat(e.FROM).concat(t).concat("/")})),e.FROM=e.FROM.substring(0,e.FROM.length-1)),a=e.TO.split("/"),n=[],r=!1,a.forEach((function(e){e.startsWith(t.oldPart)&&(e="".concat(t.newPart).concat(e.substring(t.oldPart.length,e.length)),r=!0),"TaxFree"===t.oldPart&&e.endsWith(t.oldPart)&&(e="".concat(t.newPart).concat(e.substring(0,e.length-t.oldPart.length)),r=!0),n.push(e)})),r&&(e.TO="",n.forEach((function(t){e.TO="".concat(e.TO).concat(t).concat("/")})),e.TO=e.TO.substring(0,e.TO.length-1))}))})),e.incomes.forEach((function(e){a.forEach((function(t){e.NAME.startsWith(t.oldPart)&&(e.NAME="".concat(t.newPart).concat(e.NAME.substring(t.oldPart.length,e.NAME.length)))}))})),e.assets.forEach((function(e){n.forEach((function(t){e.NAME.startsWith(t.oldPart)&&(e.NAME="".concat(t.newPart).concat(e.NAME.substring(t.oldPart.length,e.NAME.length))),"TaxFree"===t.oldPart&&e.NAME.endsWith(t.oldPart)&&(e.NAME="".concat(t.newPart).concat(e.NAME.substring(0,e.NAME.length-t.oldPart.length)))}))}))}function or(e){if(0===e.version&&function(e){var t=Fr();t.settings.forEach((function(t){0===e.settings.filter((function(e){return e.NAME===t.NAME})).length&&e.settings.push(t)})),t.assets.forEach((function(t){0===e.assets.filter((function(e){return e.NAME===t.NAME})).length&&e.assets.push(t)})),e.version=1}(e),1===e.version&&function(e){var t,a=Object(m.a)(e.expenses);try{for(a.s();!(t=a.n()).done;){var n=t.value;void 0===n.RECURRENCE&&(n.RECURRENCE="1m")}}catch(d){a.e(d)}finally{a.f()}var r,s=Object(m.a)(e.assets);try{for(s.s();!(r=s.n()).done;){var o=r.value;void 0===o.IS_A_DEBT&&(o.IS_A_DEBT=!1),void 0===o.QUANTITY&&(o.QUANTITY="")}}catch(d){s.e(d)}finally{s.f()}var i,c=Object(m.a)(e.transactions);try{for(c.s();!(i=c.n()).done;){var u=i.value;void 0===u.TYPE&&(u.TYPE="custom")}}catch(d){c.e(d)}finally{c.f()}var l,h=Object(m.a)(e.settings);try{for(h.s();!(l=h.n()).done;){var E=l.value;void 0===E.TYPE&&(E.TYPE=nr(E.NAME))}}catch(d){h.e(d)}finally{h.f()}e.version=2}(e),2===e.version&&function(e){var t=e.assets.findIndex((function(e){return"TaxPot"===e.NAME}));t>=0&&e.assets.splice(t,1),(t=e.assets.findIndex((function(e){return"TaxPot"===e.NAME})))>=0&&(Oe("still found taxPot!"),e.assets.splice(t,1)),e.version=3}(e),3===e.version&&function(e){-1===e.settings.findIndex((function(e){return e.NAME===G}))&&e.settings.push(Object(c.a)(Object(c.a)({},_r),{},{NAME:G,VALUE:"All"})),-1===e.settings.findIndex((function(e){return e.NAME===W}))&&e.settings.push(Object(c.a)(Object(c.a)({},_r),{},{NAME:W,VALUE:"All"})),-1===e.settings.findIndex((function(e){return e.NAME===H}))&&e.settings.push(Object(c.a)(Object(c.a)({},_r),{},{NAME:H,VALUE:"Y"})),e.version=4}(e),4===e.version&&rr(e),5===e.version&&function(e){sr(e,[{oldPart:"PensionSS",newPart:X},{oldPart:"PensionTransfer",newPart:ee},{oldPart:"PensionDB",newPart:$},{oldPart:"Pension",newPart:Z},{oldPart:"TransferCrystallizedPension",newPart:ne},{oldPart:"CrystallizedPension",newPart:q},{oldPart:"TaxFree",newPart:ae},{oldPart:"MoveTaxFreePart",newPart:te}],[{oldPart:"PensionDB",newPart:$},{oldPart:"PensionTransfer",newPart:ee}],[{oldPart:"CrystallizedPension",newPart:q},{oldPart:"Pension",newPart:Z},{oldPart:"TaxFree",newPart:ae}]),e.version=6}(e),6===e.version&&function(e){sr(e,[{oldPart:"-DBT ",newPart:ee},{oldPart:"-DB ",newPart:$},{oldPart:"-DC ",newPart:Z}],[{oldPart:"-DB ",newPart:$},{oldPart:"-DBT ",newPart:ee}],[{oldPart:"-DC ",newPart:Z}]),e.version=7}(e),7===e.version&&function(e){var t=new Map;e.transactions.forEach((function(e){if(e.NAME.startsWith(q)){var a=e.TO.substring(q.length),n=e.NAME.substring(q.length);t.set(a,n)}})),e.transactions.forEach((function(e){if(e.FROM.startsWith(q)&&e.TO.startsWith(q)&&void 0===t.get(e.TO.substring(q.length))){var a=t.get(e.FROM.substring(q.length));void 0!==a&&t.set(e.TO.substring(q.length),a)}})),e.assets.forEach((function(e){if(e.NAME.startsWith(q)){var a=e.NAME.substring(q.length),n="pensionName",r=t.get(a);void 0!==r&&(n=r),e.NAME="".concat(q).concat(a).concat(".").concat(n)}})),e.transactions.forEach((function(e){var a=e.FROM.split("/"),n=[],r=!1;a.forEach((function(e){if(e.startsWith(q)){var a=e.substring(q.length),s="pensionName",o=t.get(a);void 0!==o&&(s=o),e="".concat(q).concat(a).concat(".").concat(s),r=!0}n.push(e)})),r&&(e.FROM="",n.forEach((function(t){e.FROM="".concat(e.FROM).concat(t).concat("/")})),e.FROM=e.FROM.substring(0,e.FROM.length-1)),a=e.TO.split("/"),n=[],r=!1,a.forEach((function(e){if(e.startsWith(q)){var a=e.substring(q.length),s="pensionName",o=t.get(a);void 0!==o&&(s=o),e="".concat(q).concat(a).concat(".").concat(s),r=!0}n.push(e)})),r&&(e.TO="",n.forEach((function(t){e.TO="".concat(e.TO).concat(t).concat("/")})),e.TO=e.TO.substring(0,e.TO.length-1))})),e.version=8}(e),8!==e.version)throw new Error("code not properly handling versions")}function ir(e){var t=e.match(/PensionDBC/g);null!==t&&t.length>0&&Oe("Old string 'PensionDBC' in loaded data!!");var a=JSON.parse(e);return void 0!==a.testName&&(a=function(e){if("TestModel01"===e)return function(){var e={expenses:[Object(c.a)(Object(c.a)({},Sr),{},{NAME:"Look after dogs",VALUE:"500",VALUE_SET:"1 April 2018",START:"1 April 2018",END:"2 February 2047",GROWTH:"2",CATEGORY:"living costs"}),Object(c.a)(Object(c.a)({},Sr),{},{NAME:"Run car",VALUE:"700",VALUE_SET:"1 April 2018",START:"1 April 2018",END:"GetRidOfCar",GROWTH:"5",CATEGORY:"living costs"}),Object(c.a)(Object(c.a)({},Sr),{},{NAME:"Run house",VALUE:"1300",VALUE_SET:"1 April 2018",START:"1 April 2018",END:"2 February 2099",GROWTH:"2",CATEGORY:"living costs"})],incomes:[Object(c.a)(Object(c.a)({},Ir),{},{NAME:"Main income",VALUE:"3500",VALUE_SET:"1 March 2018",START:"1 March 2018",END:"StopMainWork",GROWTH:"2",LIABILITY:"Joe".concat(K)})],assets:[Object(c.a)(Object(c.a)({},Pr),{},{NAME:"Cash",START:"December 2017",VALUE:"2000"}),Object(c.a)(Object(c.a)({},Pr),{},{NAME:"Stocks",START:"December 2017",VALUE:"4000",GROWTH:"stockMarketGrowth",CATEGORY:"stock"}),Object(c.a)(Object(c.a)({},Pr),{},{NAME:"ISAs",START:"December 2019",VALUE:"2000",GROWTH:"stockMarketGrowth",CATEGORY:"stock"}),Object(c.a)(Object(c.a)({},Pr),{},{NAME:"EarlyMortgage",START:"1 January 2018",VALUE:"-234000",IS_A_DEBT:!0,GROWTH:"2.33",CATEGORY:"mortgage",CAN_BE_NEGATIVE:!0}),Object(c.a)(Object(c.a)({},Pr),{},{NAME:"LateMortgage",START:"1 January 2018",GROWTH:"4.66",IS_A_DEBT:!0,CATEGORY:"mortgage"})],transactions:[Object(c.a)(Object(c.a)({},Ur),{},{NAME:"Each month buy food",FROM:"Cash",FROM_VALUE:"200",DATE:"January 2 2018",RECURRENCE:"1m",CATEGORY:"living costs"}),Object(c.a)(Object(c.a)({},Ur),{},{NAME:"Revalue stocks after loss in 2020 market crash",TO:"Stocks",TO_ABSOLUTE:!0,TO_VALUE:"3000",DATE:"January 2 2020",TYPE:"revalueAsset"}),Object(c.a)(Object(c.a)({},Ur),{},{NAME:"SellCar",TO:"Cash",TO_ABSOLUTE:!0,TO_VALUE:"1000",DATE:"GetRidOfCar"}),Object(c.a)(Object(c.a)({},Ur),{},{NAME:"switchMortgage",FROM:"EarlyMortgage",FROM_ABSOLUTE:!1,FROM_VALUE:"1",TO:"LateMortgage",TO_ABSOLUTE:!1,TO_VALUE:"1",DATE:"TransferMortgage"}),Object(c.a)(Object(c.a)({},Ur),{},{NAME:"Conditional pay early mortgage",FROM:"Cash",FROM_VALUE:"1500",TO:"EarlyMortgage",TO_ABSOLUTE:!1,TO_VALUE:"1",DATE:"1 January 2018",STOP_DATE:"TransferMortgage",RECURRENCE:"1m",CATEGORY:"pay mortgage",TYPE:"payOffDebt"}),Object(c.a)(Object(c.a)({},Ur),{},{NAME:"Conditional pay late mortgage",FROM:"Cash",FROM_VALUE:"1500",TO:"LateMortgage",TO_ABSOLUTE:!1,TO_VALUE:"1",DATE:"TransferMortgage",STOP_DATE:"1 January 2040",RECURRENCE:"1m",CATEGORY:"pay mortgage",TYPE:"payOffDebt"})],settings:[].concat(Lr),triggers:[{NAME:"TransferMortgage",DATE:"Jan 01 2028"},{NAME:"StopMainWork",DATE:"Dec 31 2050"},{NAME:"GetRidOfCar",DATE:"Dec 31 2025"}],version:0,undoModel:void 0,redoModel:void 0};return lr(e.settings,C,"1 Jan 2019","view"),lr(e.settings,M,"1 Feb 2019","view"),e}();if("TestModel02"===e)return function(){var e={expenses:[],incomes:[],assets:[],transactions:[],settings:[].concat(Lr),triggers:[],version:0,undoModel:void 0,redoModel:void 0};return lr(e.settings,C,"1 Jan 2019","const"),lr(e.settings,M,"1 Feb 2019","const"),e}();if("CoarseAndFine"===e)return function(){var e=xr;lr(e,x,V,"view"),lr(e,D,L,"view");var t=Object(c.a)(Object(c.a)({},wr),{},{incomes:[Object(c.a)(Object(c.a)({},Ir),{},{START:"April 1 2018",END:"April 2 2018",NAME:"PRn1",VALUE:"10",VALUE_SET:"January 1 2018",CATEGORY:"PaperRound"}),Object(c.a)(Object(c.a)({},Ir),{},{START:"April 1 2018",END:"June 2 2018",NAME:"PRn2",VALUE:"10",VALUE_SET:"January 1 2018",CATEGORY:"PaperRound"}),Object(c.a)(Object(c.a)({},Ir),{},{START:"April 1 2018",END:"April 2 2018",NAME:"PRn3",VALUE:"10",VALUE_SET:"January 1 2018"})],assets:[Object(c.a)(Object(c.a)({},Pr),{},{NAME:"Cash",CAN_BE_NEGATIVE:!0,START:"April 1 2018",VALUE:"500",CATEGORY:"Accessible"}),Object(c.a)(Object(c.a)({},Pr),{},{NAME:"stocks",START:"April 1 2018",VALUE:"500"}),Object(c.a)(Object(c.a)({},Pr),{},{NAME:"savings",START:"June 1 2018",VALUE:"500",CATEGORY:"Accessible"})],settings:e,expenses:[Object(c.a)(Object(c.a)({},Sr),{},{START:"April 1 2018",END:"June 2 2018",NAME:"Phon",VALUE_SET:"January 1 2018",VALUE:"12.0",CATEGORY:"comms"}),Object(c.a)(Object(c.a)({},Sr),{},{START:"February 1 2018",END:"June 2 2018",NAME:"broadband",VALUE_SET:"January 1 2018",VALUE:"12.0",CATEGORY:"comms"}),Object(c.a)(Object(c.a)({},Sr),{},{START:"January 1 2018",END:"July 2 2018",NAME:"pet food",VALUE_SET:"January 1 2018",VALUE:"12.0"})],version:0,undoModel:void 0,redoModel:void 0});return Er(t,{start:"April 1, 2018",end:"July 10, 2018"}),t}();if("FutureExpense"===e)return function(){var e=Fr(),t=Object(c.a)(Object(c.a)({},e),{},{expenses:[Object(c.a)(Object(c.a)({},Sr),{},{START:"January 1 2018",END:"July 2 2018",NAME:"Phon",VALUE:"99",VALUE_SET:"January 1 2018",GROWTH:"12.0"})],settings:Object(O.a)(Vr({start:"Dec 1, 2016 00:00:00",end:"March 1, 2017 00:00:00"})),version:0,undoModel:void 0,redoModel:void 0});return t.settings.push(Object(c.a)(Object(c.a)({},_r),{},{NAME:D,VALUE:L})),t}();if("ThreeChryslerModel"===e)return function(){var e=Fr(),t=Object(c.a)(Object(c.a)({},e),{},{assets:[].concat(Object(O.a)(e.assets),[Object(c.a)(Object(c.a)({},Pr),{},{NAME:"Cars",START:"January 2 2018",VALUE:"chrysler",QUANTITY:"3",CPI_IMMUNE:!0})]),settings:[].concat(Object(O.a)(e.settings),[{NAME:"twoChryslers",VALUE:"2chrysler",HINT:"",TYPE:"const"},{NAME:"chrysler",VALUE:"50USD",HINT:"",TYPE:"const"},{NAME:"USD",VALUE:"2",HINT:"",TYPE:"adjustable"},Object(c.a)(Object(c.a)({},_r),{},{NAME:D,VALUE:L})]),version:0,undoModel:void 0,redoModel:void 0});return t.assets.filter((function(e){return"Cash"===e.NAME}))[0].START="1 Jan 2018",Er(t,{start:"Dec 1, 2017 00:00:00",end:"June 1, 2018 00:00:00"}),t}();if("MinimalModel"===e)return Fr();if("BenAndJerryModel"===e)return{assets:[{NAME:"PensionJerry Aegon",VALUE:"56324",QUANTITY:"",START:"21/02/2020",GROWTH:"4",CPI_IMMUNE:!1,CAN_BE_NEGATIVE:!1,IS_A_DEBT:!1,CATEGORY:"Pension",PURCHASE_PRICE:"0.0",LIABILITY:""},{NAME:"PensionBen Prudential",VALUE:"45000",QUANTITY:"",START:"21/02/2020",GROWTH:"4",CPI_IMMUNE:!1,CAN_BE_NEGATIVE:!1,IS_A_DEBT:!1,CATEGORY:"Pension",PURCHASE_PRICE:"0.0",LIABILITY:""},{NAME:"Mortgage",VALUE:"-150000",QUANTITY:"",START:"21/02/2020",GROWTH:"3.5",CPI_IMMUNE:!0,CAN_BE_NEGATIVE:!0,IS_A_DEBT:!0,CATEGORY:"Property",PURCHASE_PRICE:"0.0",LIABILITY:""},{NAME:"Jerry stocks",VALUE:"25000",QUANTITY:"",START:"21/02/2020",GROWTH:"4",CPI_IMMUNE:!1,CAN_BE_NEGATIVE:!1,IS_A_DEBT:!1,CATEGORY:"Investment",PURCHASE_PRICE:"14000",LIABILITY:"Jerry(CGT)"},{NAME:"Jerry loan",VALUE:"-5000",QUANTITY:"",START:"21/02/2020",GROWTH:"2.5",CPI_IMMUNE:!0,CAN_BE_NEGATIVE:!0,IS_A_DEBT:!0,CATEGORY:"",PURCHASE_PRICE:"0.0",LIABILITY:""},{NAME:"".concat(ae,"Jerry Aegon"),VALUE:"0.0",QUANTITY:"",START:"21/02/2020",GROWTH:"4",CPI_IMMUNE:!1,CAN_BE_NEGATIVE:!1,IS_A_DEBT:!1,CATEGORY:"Pension",PURCHASE_PRICE:"0.0",LIABILITY:""},{NAME:"ISA",VALUE:"9000",QUANTITY:"",START:"21/02/2020",GROWTH:"4",CPI_IMMUNE:!1,CAN_BE_NEGATIVE:!1,IS_A_DEBT:!1,CATEGORY:"Investment",PURCHASE_PRICE:"0",LIABILITY:""},{NAME:"House",VALUE:"255000",QUANTITY:"",START:"21/02/2020",GROWTH:"2",CPI_IMMUNE:!1,CAN_BE_NEGATIVE:!1,IS_A_DEBT:!1,CATEGORY:"Property",PURCHASE_PRICE:"0",LIABILITY:""},{NAME:"".concat(q,"Jerry"),VALUE:"0.0",QUANTITY:"",START:"21/02/2020",GROWTH:"4",CPI_IMMUNE:!1,CAN_BE_NEGATIVE:!1,IS_A_DEBT:!1,CATEGORY:"Pension",PURCHASE_PRICE:"0.0",LIABILITY:""},{NAME:"".concat(q,"Ben"),VALUE:"0.0",QUANTITY:"",START:"21/02/2020",GROWTH:"4",CPI_IMMUNE:!1,CAN_BE_NEGATIVE:!1,IS_A_DEBT:!1,CATEGORY:"Pension",PURCHASE_PRICE:"0.0",LIABILITY:""},{NAME:"Cash",CATEGORY:"",START:"1 Jan 2017",VALUE:"0.0",QUANTITY:"",GROWTH:"0.0",CPI_IMMUNE:!0,CAN_BE_NEGATIVE:!0,IS_A_DEBT:!1,LIABILITY:"",PURCHASE_PRICE:"0.0"},{NAME:"".concat(ae,"Ben Prudential"),VALUE:"0.0",QUANTITY:"",START:"21/02/2020",GROWTH:"4",CPI_IMMUNE:!1,CAN_BE_NEGATIVE:!1,IS_A_DEBT:!1,CATEGORY:"Pension",PURCHASE_PRICE:"0.0",LIABILITY:""},{NAME:"Ben loan",VALUE:"-5000",QUANTITY:"",START:"21/02/2020",GROWTH:"0",CPI_IMMUNE:!0,CAN_BE_NEGATIVE:!0,IS_A_DEBT:!0,CATEGORY:"",PURCHASE_PRICE:"0.0",LIABILITY:""}],incomes:[{START:"Jerry state pension age",END:"Ben dies",NAME:"".concat(ee,"Jerry work"),VALUE:"0.0",VALUE_SET:"21/02/2020",LIABILITY:"Ben(incomeTax)",GROWTH:"0",CPI_IMMUNE:!1,CATEGORY:"Pension"},{START:"Jerry state pension age",END:"Jerry dies",NAME:"".concat($,"Jerry work"),VALUE:"2000",VALUE_SET:"21/02/2020",LIABILITY:"Jerry(incomeTax)",GROWTH:"0",CPI_IMMUNE:!1,CATEGORY:"Pension"},{START:"Jerry state pension age",END:"Jerry dies",NAME:"".concat($,"Jerry state pension"),VALUE:"730",VALUE_SET:"21/02/2020",LIABILITY:"Jerry(incomeTax)",GROWTH:"0",CPI_IMMUNE:!1,CATEGORY:"Pension"},{START:"Ben state pension age",END:"Ben dies",NAME:"".concat($,"Ben state pension"),VALUE:"730",VALUE_SET:"21/02/2020",LIABILITY:"Ben(incomeTax)",GROWTH:"0",CPI_IMMUNE:!1,CATEGORY:"Pension"},{NAME:"Jerry salary",VALUE:"2755",VALUE_SET:"21/2/2020",START:"21/2/2020",END:"Jerry retires",GROWTH:"2",CPI_IMMUNE:!1,LIABILITY:"Jerry(incomeTax)/Jerry(NI)",CATEGORY:"Salary"},{NAME:"Ben salary",VALUE:"3470",VALUE_SET:"21/2/2020",START:"21/2/2020",END:"Ben retires",GROWTH:"2",CPI_IMMUNE:!1,LIABILITY:"Ben(incomeTax)/Ben(NI)",CATEGORY:"Salary"}],expenses:[{NAME:"Replace car",VALUE:"20000",VALUE_SET:"21/02/2020",START:"21/02/2025",END:"Care costs start",GROWTH:"0",CPI_IMMUNE:!1,CATEGORY:"Major costs",RECURRENCE:"5y"},{NAME:"Leisure expenses working",VALUE:"1000",VALUE_SET:"21/02/2020",START:"21/02/2020",END:"Jerry retires",GROWTH:"0",CPI_IMMUNE:!1,CATEGORY:"Leisure",RECURRENCE:"1m"},{NAME:"Leisure expenses retired",VALUE:"2000",VALUE_SET:"21/02/2020",START:"Jerry retires",END:"Care costs start",GROWTH:"0",CPI_IMMUNE:!1,CATEGORY:"Leisure",RECURRENCE:"1m"},{NAME:"House maintenance",VALUE:"8000",VALUE_SET:"21/02/2020",START:"21/02/2020",END:"Care costs start",GROWTH:"0",CPI_IMMUNE:!1,CATEGORY:"Major costs",RECURRENCE:"4y"},{NAME:"Care costs",VALUE:"3000",VALUE_SET:"21/02/2020",START:"Care costs start",END:"Ben dies",GROWTH:"0",CPI_IMMUNE:!1,CATEGORY:"Care",RECURRENCE:"1m"},{NAME:"Basic expenses small house",VALUE:"1600",VALUE_SET:"21/02/2020",START:"Downsize house",END:"Ben dies",GROWTH:"0",CPI_IMMUNE:!1,CATEGORY:"Basic",RECURRENCE:"1m"},{NAME:"Basic expenses current house",VALUE:"1850",VALUE_SET:"21/02/2020",START:"21/02/2020",END:"Downsize house",GROWTH:"0",CPI_IMMUNE:!1,CATEGORY:"Basic",RECURRENCE:"1m"}],triggers:[{NAME:"Ben dies",DATE:"2068-08-30"},{NAME:"Ben retires",DATE:"2032-07-27"},{NAME:"Ben state pension age",DATE:"2040-08-30"},{NAME:"Care costs start",DATE:"2060-02-20"},{NAME:"Downsize house",DATE:"2047-02-28"},{NAME:"Jerry dies",DATE:"2065-05-04"},{NAME:"Jerry retires",DATE:"2030-05-04"},{NAME:"Jerry state pension age",DATE:"2037-05-04"}],settings:[{NAME:"Today's value focus date",VALUE:"",HINT:"Date to use for 'today's value' tables (defaults to '' meaning today)",TYPE:"view"},{NAME:"End of view range",VALUE:"2069",HINT:"Date at the end of range to be plotted",TYPE:"view"},{NAME:"Date of birth",VALUE:"",HINT:"Date used for representing dates as ages",TYPE:"view"},{NAME:"cpi",VALUE:"2.5",HINT:"Annual rate of inflation",TYPE:"const"},{NAME:"Beginning of view range",VALUE:"2020",HINT:"Date at the start of range to be plotted",TYPE:"view"}],transactions:[{NAME:"".concat(ne,"Jerry Aegon"),FROM:"".concat(q,"Jerry"),FROM_ABSOLUTE:!1,FROM_VALUE:"1.0",TO:"".concat(q,"Ben"),TO_ABSOLUTE:!1,TO_VALUE:"1.0",DATE:"Jerry dies",STOP_DATE:"",RECURRENCE:"",CATEGORY:"Pension",TYPE:"auto"},{NAME:"".concat(ne,"Ben Prudential"),FROM:"".concat(q,"Ben"),FROM_ABSOLUTE:!1,FROM_VALUE:"1.0",TO:"".concat(q,"Jerry"),TO_ABSOLUTE:!1,TO_VALUE:"1.0",DATE:"Ben dies",STOP_DATE:"",RECURRENCE:"",CATEGORY:"Pension",TYPE:"auto"},{NAME:"".concat(ee,"Jerry work"),FROM:"".concat($,"Jerry work"),FROM_ABSOLUTE:!1,FROM_VALUE:"1.0",TO:"".concat(ee,"Jerry work"),TO_ABSOLUTE:!1,TO_VALUE:"0.5",DATE:"Jerry dies",STOP_DATE:"Ben dies",RECURRENCE:"",CATEGORY:"Pension",TYPE:"auto"},{NAME:"PensionJerry work",FROM:"Jerry salary",FROM_ABSOLUTE:!1,FROM_VALUE:"0.05",TO:"",TO_ABSOLUTE:!1,TO_VALUE:"0.0",DATE:"21/02/2020",STOP_DATE:"Jerry retires",RECURRENCE:"",CATEGORY:"Pension",TYPE:"auto"},{NAME:"PensionJerry Aegon",FROM:"",FROM_ABSOLUTE:!1,FROM_VALUE:"0",TO:"PensionJerry Aegon",TO_ABSOLUTE:!1,TO_VALUE:"0",DATE:"21/02/2020",STOP_DATE:"",RECURRENCE:"",CATEGORY:"Pension",TYPE:"auto"},{NAME:"".concat($,"Jerry work"),FROM:"Jerry salary",FROM_ABSOLUTE:!1,FROM_VALUE:"0.00125",TO:"".concat($,"Jerry work"),TO_ABSOLUTE:!1,TO_VALUE:"1.0",DATE:"21/02/2020",STOP_DATE:"Jerry retires",RECURRENCE:"",CATEGORY:"Pension",TYPE:"auto"},{NAME:"".concat(Z,"Ben Prudential"),FROM:"Ben salary",FROM_ABSOLUTE:!1,FROM_VALUE:"0.06",TO:"".concat(Z,"Ben Prudential"),TO_ABSOLUTE:!1,TO_VALUE:"3",DATE:"21/02/2020",STOP_DATE:"Ben retires",RECURRENCE:"",CATEGORY:"Pension",TYPE:"auto"},{NAME:"".concat(te,"Jerry Aegon"),FROM:"".concat(Z,"Jerry Aegon"),FROM_ABSOLUTE:!1,FROM_VALUE:"0.25",TO:"".concat(ae,"Jerry Aegon"),TO_ABSOLUTE:!1,TO_VALUE:"1.0",DATE:"Jerry retires",STOP_DATE:"",RECURRENCE:"",CATEGORY:"Pension",TYPE:"auto"},{NAME:"".concat(te,"Ben Prudential"),FROM:"".concat(Z,"Ben Prudential"),FROM_ABSOLUTE:!1,FROM_VALUE:"0.25",TO:"".concat(ae,"Ben Prudential"),TO_ABSOLUTE:!1,TO_VALUE:"1.0",DATE:"Ben retires",STOP_DATE:"",RECURRENCE:"",CATEGORY:"Pension",TYPE:"auto"},{NAME:"".concat(q,"Jerry Aegon"),FROM:"".concat(Z,"Jerry Aegon"),FROM_ABSOLUTE:!1,FROM_VALUE:"1.0",TO:"".concat(q,"Jerry"),TO_ABSOLUTE:!1,TO_VALUE:"1.0",DATE:"Jerry retires",STOP_DATE:"",RECURRENCE:"",CATEGORY:"Pension",TYPE:"auto"},{NAME:"".concat(q,"Ben Prudential"),FROM:"".concat(Z,"Ben Prudential"),FROM_ABSOLUTE:!1,FROM_VALUE:"1.0",TO:"".concat(q,"Ben"),TO_ABSOLUTE:!1,TO_VALUE:"1.0",DATE:"Ben retires",STOP_DATE:"",RECURRENCE:"",CATEGORY:"Pension",TYPE:"auto"},{NAME:"ConditionalSell stocks for cash",CATEGORY:"Cashflow",FROM:"Jerry stocks",FROM_ABSOLUTE:!0,FROM_VALUE:"500",TO:"Cash",TO_ABSOLUTE:!1,TO_VALUE:"1",DATE:"21/02/2020",STOP_DATE:"",RECURRENCE:"1m",TYPE:"liquidateAsset"},{NAME:"ConditionalSell ".concat(ae,"Ben Prudential"),CATEGORY:"Cashflow",FROM:"".concat(ae,"Ben Prudential"),FROM_ABSOLUTE:!0,FROM_VALUE:"250",TO:"Cash",TO_ABSOLUTE:!1,TO_VALUE:"1",DATE:"21/02/2020",STOP_DATE:"",RECURRENCE:"1m",TYPE:"liquidateAsset"},{NAME:"ConditionalSell ISAs for cash",CATEGORY:"Cashflow",FROM:"ISA",FROM_ABSOLUTE:!0,FROM_VALUE:"500",TO:"Cash",TO_ABSOLUTE:!1,TO_VALUE:"1",DATE:"21/02/2020",STOP_DATE:"",RECURRENCE:"1m",TYPE:"liquidateAsset"},{NAME:"ConditionalSell ".concat(q,"Jerry"),CATEGORY:"Cashflow",FROM:"".concat(q,"Jerry"),FROM_ABSOLUTE:!0,FROM_VALUE:"1000",TO:"Cash",TO_ABSOLUTE:!1,TO_VALUE:"1",DATE:"21/02/2020",STOP_DATE:"",RECURRENCE:"1m",TYPE:"liquidateAsset"},{NAME:"ConditionalSell ".concat(q,"Ben"),CATEGORY:"Cashflow",FROM:"".concat(q,"Ben"),FROM_ABSOLUTE:!0,FROM_VALUE:"1000",TO:"Cash",TO_ABSOLUTE:!1,TO_VALUE:"1",DATE:"21/02/2020",STOP_DATE:"",RECURRENCE:"1m",TYPE:"liquidateAsset"},{NAME:"ConditionalSell ".concat(ae,"Jerry Aegon"),CATEGORY:"Cashflow",FROM:"".concat(ae,"Jerry Aegon"),FROM_ABSOLUTE:!0,FROM_VALUE:"250",TO:"Cash",TO_ABSOLUTE:!1,TO_VALUE:"1",DATE:"21/02/2020",STOP_DATE:"",RECURRENCE:"1m",TYPE:"liquidateAsset"},{NAME:"ConditionalPayment to Mortgage 1",CATEGORY:"Property",FROM:"Cash",FROM_ABSOLUTE:!0,FROM_VALUE:"700",TO:"Mortgage",TO_ABSOLUTE:!1,TO_VALUE:"1.0",DATE:"21/02/2020",STOP_DATE:"",RECURRENCE:"1m",TYPE:"payOffDebt"},{NAME:"ConditionalPayment to Jerry loan 1",CATEGORY:"",FROM:"Cash",FROM_ABSOLUTE:!0,FROM_VALUE:"250",TO:"Jerry loan",TO_ABSOLUTE:!1,TO_VALUE:"1.0",DATE:"21/02/2020",STOP_DATE:"",RECURRENCE:"1m",TYPE:"payOffDebt"},{NAME:"ConditionalPayment to Ben loan 1",CATEGORY:"",FROM:"Cash",FROM_ABSOLUTE:!0,FROM_VALUE:"500",TO:"Ben loan",TO_ABSOLUTE:!1,TO_VALUE:"1.0",DATE:"21/02/2020",STOP_DATE:"",RECURRENCE:"1m",TYPE:"payOffDebt"}],version:5,undoModel:void 0,redoModel:void 0};if(e===Rr)return dr(Rr);if(e===Cr)return dr(Cr);if(e===yr)return dr(yr);throw new Error("test model name not recognised")}(a.testName)),void 0===a.version&&(a.version=0),function e(t){var a,n=Object(m.a)(t.triggers);try{for(n.s();!(a=n.n()).done;){var r=a.value;r.DATE=new Date(r.DATE).toDateString()}}catch(s){n.e(s)}finally{n.f()}t.undoModel&&e(t.undoModel),t.redoModel&&e(t.redoModel)}(a),a}function cr(e,t){var a={value:"",numFound:1},n=t.filter((function(t){return t.NAME===e}));return 1===n.length?a.value=n[0].VALUE:(a.numFound=n.length,a.numFound>1&&Oe("multiple settings: ".concat(be(n)))),a}function ur(e,t,a){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=cr(t,e);if(1===r.numFound)return r.value;if(0===r.numFound)return n&&Oe("BUG!!! '".concat(t,"' value not found in settings list")),a;if(r.numFound>1)throw Oe("BUG!!! multiple '".concat(t,"' values found in settings list")),new Error;return a}function lr(e,t,a,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",s=e.findIndex((function(e){return e.NAME===t}));-1===s?e.push({NAME:t,VALUE:a,HINT:r,TYPE:n}):e.splice(s,1,{NAME:t,VALUE:a,HINT:r,TYPE:n})}function hr(e){var t=new Date;if(0===e.settings.length)return t;var a=ur(e.settings,U,"");return""!==a&&(t=new Date(a)),t}function Er(e,t){lr(e.settings,C,t.start,"view"),lr(e.settings,M,t.end,"view")}function dr(e){var t=ir(e);return or(t),t}function pr(e,t){var a=t.assets.find((function(t){return t.NAME===e}));return void 0!==a&&a.IS_A_DEBT}function Ar(e,t){return void 0!==t.incomes.find((function(t){return t.NAME===e}))}function fr(e,t){return void 0!==t.expenses.find((function(t){return t.NAME===e}))}function mr(e,t){var a=e.split("/"),n=!0;return a.forEach((function(e){(function(e,t){return void 0!==t.assets.find((function(t){return t.NAME===e||t.CATEGORY===e}))})(e,t)||(n=!1)})),n}function Tr(e,t){return t.transactions.filter((function(t){return t.NAME===e})).length>0}function vr(e,t){var a=[];return e.forEach((function(e){var n=t.assets.filter((function(t){return t.CATEGORY===e}));0===n.length?a.push(e):a=a.concat(n.map((function(e){return e.NAME})))})),a}function gr(e){var t=ir(JSON.stringify(e));e.undoModel=t,e.redoModel=void 0}function Or(e){if(void 0!==e.undoModel){var t=e.undoModel;return e.undoModel=void 0,t.redoModel={assets:e.assets,expenses:e.expenses,incomes:e.incomes,settings:e.settings,transactions:e.transactions,triggers:e.triggers,version:e.version,undoModel:e.undoModel,redoModel:e.redoModel},Object.assign(e,t),!0}return!1}function br(e){if(void 0!==e.redoModel){var t=e.redoModel;return e.redoModel=void 0,t.undoModel={assets:e.assets,expenses:e.expenses,incomes:e.incomes,settings:e.settings,transactions:e.transactions,triggers:e.triggers,version:e.version,undoModel:e.undoModel,redoModel:e.redoModel},Object.assign(e,t),!0}return!1}function Nr(e,t,a){var n=st(t,e),r=st(a,e);if(n!==r)return""!==n?"Must maintain special formatting using ".concat(n):"Must not introduce special formatting using ".concat(r);var s=ot(e,a,"already");if(s.length>0)return s;if(gr(e),e.settings.forEach((function(e){e.NAME=ut(e.NAME,t,a),e.VALUE=it(e.VALUE,t,a)})),e.triggers.forEach((function(e){e.NAME=ut(e.NAME,t,a)})),e.assets.forEach((function(e){e.NAME=ut(e.NAME,t,a),e.START=ut(e.START,t,a),e.VALUE=it(e.VALUE,t,a),e.QUANTITY=ut(e.QUANTITY,t,a),e.GROWTH=ut(e.GROWTH,t,a),e.LIABILITY=ct(e.LIABILITY,t,a),e.PURCHASE_PRICE=it(e.PURCHASE_PRICE,t,a)})),e.incomes.forEach((function(e){e.NAME=ut(e.NAME,t,a),e.START=ut(e.START,t,a),e.END=ut(e.END,t,a),e.VALUE=it(e.VALUE,t,a),e.VALUE_SET=ut(e.VALUE_SET,t,a),e.GROWTH=ut(e.GROWTH,t,a),e.LIABILITY=ct(e.LIABILITY,t,a)})),e.expenses.forEach((function(e){e.NAME=ut(e.NAME,t,a),e.START=ut(e.START,t,a),e.END=ut(e.END,t,a),e.VALUE=it(e.VALUE,t,a),e.VALUE_SET=ut(e.VALUE_SET,t,a),e.GROWTH=ut(e.GROWTH,t,a)})),e.transactions.forEach((function(e){e.NAME=ut(e.NAME,t,a),e.FROM=ct(e.FROM,t,a),e.FROM_VALUE=it(e.FROM_VALUE,t,a),e.TO=ct(e.TO,t,a),e.TO_VALUE=it(e.TO_VALUE,t,a),e.DATE=ut(e.DATE,t,a),e.STOP_DATE=ut(e.STOP_DATE,t,a)})),(s=ot(e,t,"still")).length>0)return Or(e),s;var o=tr(e);return""!==o?(Or(e),o):""}var Mr='{"triggers":[\n{"NAME":"GetRidOfCar","DATE":"2025-12-31"},\n{"NAME":"StopMainWork","DATE":"2050-12-31"},\n{"NAME":"TransferMortgage","DATE":"2028-01-01"}],\n"expenses":[\n{"NAME":"Look after dogs","CATEGORY":"living costs","START":"1 April 2018","END":"2 February 2047","VALUE":"500","VALUE_SET":"1 April 2018","CPI_IMMUNE":false,"GROWTH":"2","RECURRENCE":"1m"},\n{"NAME":"Run car","CATEGORY":"living costs","START":"1 April 2018","END":"GetRidOfCar","VALUE":"700","VALUE_SET":"1 April 2018","CPI_IMMUNE":false,"GROWTH":"5","RECURRENCE":"1m"},\n{"NAME":"Run house","CATEGORY":"living costs","START":"1 April 2018","END":"2 February 2099","VALUE":"1300","VALUE_SET":"1 April 2018","CPI_IMMUNE":false,"GROWTH":"2","RECURRENCE":"1m"}],\n"incomes":[\n{"NAME":"Main income","CATEGORY":"","START":"1 March 2018","END":"StopMainWork","VALUE":"3500","VALUE_SET":"1 March 2018","CPI_IMMUNE":false,"GROWTH":"2","LIABILITY":"Joe(incomeTax)"},\n{"NAME":"Side hustle income","CATEGORY":"hustle","START":"1 March 2018","END":"2 April 2025","VALUE":"1500","VALUE_SET":"1 March 2018","CPI_IMMUNE":false,"GROWTH":"0","LIABILITY":""},\n{"NAME":"Side hustle income later","CATEGORY":"hustle","START":"2 April 2025","END":"2 April 2029","VALUE":"1500","VALUE_SET":"1 March 2018","CPI_IMMUNE":false,"GROWTH":"0","LIABILITY":""}],\n"assets":[\n{"NAME":"Cash","CATEGORY":"","START":"December 2017","VALUE":"2000","GROWTH":"0","CPI_IMMUNE":false,"CAN_BE_NEGATIVE":true,"LIABILITY":"","PURCHASE_PRICE":"0","IS_A_DEBT":false,"QUANTITY":""},\n{"NAME":"EarlyMortgage","VALUE":"-234000","QUANTITY":"","START":"1 January 2018","LIABILITY":"","GROWTH":"2.33","CPI_IMMUNE":true,"CAN_BE_NEGATIVE":true,"IS_A_DEBT":true,"PURCHASE_PRICE":"0","CATEGORY":"mortgage"},\n{"NAME":"ISAs","CATEGORY":"stock","START":"December 2019","VALUE":"2000","GROWTH":"stockMarketGrowth","CPI_IMMUNE":false,"CAN_BE_NEGATIVE":false,"LIABILITY":"","PURCHASE_PRICE":"0","IS_A_DEBT":false,"QUANTITY":""},\n{"NAME":"LateMortgage","VALUE":"0","QUANTITY":"","START":"1 January 2018","LIABILITY":"","GROWTH":"4.66","CPI_IMMUNE":true,"CAN_BE_NEGATIVE":true,"IS_A_DEBT":true,"PURCHASE_PRICE":"0","CATEGORY":"mortgage"},\n{"NAME":"Stocks","CATEGORY":"stock","START":"December 2017","VALUE":"4000","GROWTH":"stockMarketGrowth","CPI_IMMUNE":false,"CAN_BE_NEGATIVE":false,"LIABILITY":"","PURCHASE_PRICE":"0","IS_A_DEBT":false,"QUANTITY":""}],\n"transactions":[\n{"DATE":"1 January 2018","FROM":"Cash","FROM_VALUE":"1500","FROM_ABSOLUTE":true,"NAME":"Conditional pay early mortgage","TO":"EarlyMortgage","TO_ABSOLUTE":false,"TO_VALUE":"1","STOP_DATE":"TransferMortgage","RECURRENCE":"1m","TYPE":"payOffDebt","CATEGORY":"pay mortgage"},\n{"DATE":"TransferMortgage","FROM":"Cash","FROM_VALUE":"1500","FROM_ABSOLUTE":true,"NAME":"Conditional pay late mortgage","TO":"LateMortgage","TO_ABSOLUTE":false,"TO_VALUE":"1","STOP_DATE":"","RECURRENCE":"1m","TYPE":"payOffDebt","CATEGORY":"pay mortgage"},\n{"NAME":"Each month buy food","FROM":"Cash","FROM_ABSOLUTE":true,"FROM_VALUE":"200","TO":"","TO_ABSOLUTE":true,"TO_VALUE":"0.0","DATE":"January 2 2018","STOP_DATE":"","RECURRENCE":"1m","CATEGORY":"living costs","TYPE":"custom"},\n{"DATE":"January 2 2020","FROM":"","FROM_VALUE":"0","FROM_ABSOLUTE":true,"NAME":"Revalue stocks after loss in 2020 market crash","TO":"Stocks","TO_ABSOLUTE":true,"TO_VALUE":"3000","STOP_DATE":"","RECURRENCE":"","TYPE":"revalueAsset","CATEGORY":""},\n{"NAME":"SellCar","FROM":"","FROM_ABSOLUTE":true,"FROM_VALUE":"0.0","TO":"Cash","TO_ABSOLUTE":true,"TO_VALUE":"1000","DATE":"GetRidOfCar","STOP_DATE":"","RECURRENCE":"","CATEGORY":"","TYPE":"custom"},\n{"NAME":"switchMortgage","FROM":"EarlyMortgage","FROM_ABSOLUTE":false,"FROM_VALUE":"1","TO":"LateMortgage","TO_ABSOLUTE":false,"TO_VALUE":"1","DATE":"TransferMortgage","STOP_DATE":"","RECURRENCE":"","CATEGORY":"","TYPE":"custom"}],\n"settings":[\n{"NAME":"Beginning of view range","VALUE":"1 Jan 2019","HINT":"Date at the start of range to be plotted","TYPE":"view"},\n{"NAME":"cpi","VALUE":"2.5","HINT":"Annual rate of inflation","TYPE":"const"},\n{"NAME":"Date of birth","VALUE":"","HINT":"Date used for representing dates as ages","TYPE":"view"},\n{"NAME":"End of view range","VALUE":"1 Jan 2042","HINT":"Date at the end of range to be plotted","TYPE":"view"},\n{"NAME":"stockMarketGrowth","VALUE":"6.236","HINT":"Custom setting for stock market growth","TYPE":"adjustable"},\n{"NAME": "Today\'s value focus date","VALUE": "","HINT": "Date to use for \'today\'s value\' tables (defaults to \'\' meaning today)","TYPE": "view"}\n]}',Rr='{"assets":[\n{"NAME":"Cash","CATEGORY":"","START":"1 Jan 2019","VALUE":"0.0","QUANTITY":"","GROWTH":"0.0","CPI_IMMUNE":true,"CAN_BE_NEGATIVE":true,"IS_A_DEBT":false,"LIABILITY":"","PURCHASE_PRICE":"0.0"}],\n"incomes":[\n{"NAME":"TeachingJob","VALUE":"2500","VALUE_SET":"JobStart","START":"JobStart","END":"JobStop","GROWTH":"2","CPI_IMMUNE":true,"LIABILITY":"Joe(incomeTax)/Joe(NI)","CATEGORY":""},\n{"START":"PensionBegins","END":"PensionStops","NAME":"PensionTransferTeachersPensionScheme","VALUE":"0.0","VALUE_SET":"PensionExists","LIABILITY":"Jack(incomeTax)","GROWTH":"2","CPI_IMMUNE":true,"CATEGORY":""},\n{"START":"PensionBegins","END":"PensionTransfers","NAME":"PensionDBTeachersPensionScheme","VALUE":"0","VALUE_SET":"PensionExists","LIABILITY":"Joe(incomeTax)","GROWTH":"2","CPI_IMMUNE":true,"CATEGORY":""}],\n"expenses":[\n],"triggers":[\n{"NAME":"PensionTransfers","DATE":"2035-01-01"},\n{"NAME":"PensionStops","DATE":"2040-01-01"},\n{"NAME":"PensionExists","DATE":"2022-01-01"},\n{"NAME":"PensionBegins","DATE":"2030-01-01"},\n{"NAME":"JobStop","DATE":"2028-01-01"},\n{"NAME":"JobStart","DATE":"2020-01-01"}],\n"settings":[\n{"NAME":"Today\'s value focus date","VALUE":"","HINT":"Date to use for \'today\'s value\' tables (defaults to \'\' meaning today)","TYPE":"view"},\n{"NAME":"End of view range","VALUE":"1 Jan 2045","HINT":"Date at the end of range to be plotted","TYPE":"view"},\n{"NAME":"Date of birth","VALUE":"","HINT":"Date used for representing dates as ages","TYPE":"view"},\n{"NAME":"cpi","VALUE":"2.5","HINT":"Annual rate of inflation","TYPE":"const"},\n{"NAME":"Beginning of view range","VALUE":"1 Jan 2017","HINT":"Date at the start of range to be plotted","TYPE":"view"}],\n"transactions":[\n{"NAME":"PensionTransferTeachersPensionScheme","FROM":"PensionDBTeachersPensionScheme","FROM_ABSOLUTE":false,"FROM_VALUE":"1.0","TO":"PensionTransferTeachersPensionScheme","TO_ABSOLUTE":false,"TO_VALUE":"0.5","DATE":"PensionTransfers","STOP_DATE":"PensionStops","RECURRENCE":"","CATEGORY":"","TYPE":"auto"},\n{"NAME":"PensionTeachersPensionScheme","FROM":"TeachingJob","FROM_ABSOLUTE":false,"FROM_VALUE":"0.05","TO":"","TO_ABSOLUTE":false,"TO_VALUE":"0.0","DATE":"PensionExists","STOP_DATE":"JobStop","RECURRENCE":"","CATEGORY":"","TYPE":"auto"},\n{"NAME":"PensionDBTeachersPensionScheme","FROM":"TeachingJob","FROM_ABSOLUTE":false,"FROM_VALUE":"0.0016666666666666668","TO":"PensionDBTeachersPensionScheme","TO_ABSOLUTE":false,"TO_VALUE":"1.0","DATE":"PensionExists","STOP_DATE":"JobStop","RECURRENCE":"","CATEGORY":"","TYPE":"auto"}],\n"version":4}',Cr='{"expenses":[\n],"incomes":[\n{"NAME":"javaJob1","CATEGORY":"programming","START":"2021","END":"2028","VALUE":"2500","VALUE_SET":"2020","GROWTH":"2","CPI_IMMUNE":true,"LIABILITY":"Joe(incomeTax)/Joe(NI)"}],\n"assets":[\n{"NAME":"PensionAegon","VALUE":"0","QUANTITY":"","START":"2021","GROWTH":"2.0","CPI_IMMUNE":false,"CAN_BE_NEGATIVE":false,"IS_A_DEBT":false,"CATEGORY":"pension","PURCHASE_PRICE":"0.0","LIABILITY":""},\n{"NAME":"CrystallizedPensionJoe","VALUE":"0.0","QUANTITY":"","START":"2021","GROWTH":"2.0","CPI_IMMUNE":false,"CAN_BE_NEGATIVE":false,"IS_A_DEBT":false,"CATEGORY":"pension","PURCHASE_PRICE":"0.0","LIABILITY":""},\n{"NAME":"CrystallizedPensionJack","VALUE":"0.0","QUANTITY":"","START":"2021","GROWTH":"2.0","CPI_IMMUNE":false,"CAN_BE_NEGATIVE":false,"IS_A_DEBT":false,"CATEGORY":"pension","PURCHASE_PRICE":"0.0","LIABILITY":""},\n{"NAME":"Cash","CATEGORY":"","START":"1 Jan 2017","VALUE":"0.0","QUANTITY":"","GROWTH":"0.0","CPI_IMMUNE":true,"CAN_BE_NEGATIVE":true,"IS_A_DEBT":false,"LIABILITY":"","PURCHASE_PRICE":"0.0"},\n{"NAME":"AegonTaxFree","VALUE":"0.0","QUANTITY":"","START":"2021","GROWTH":"2.0","CPI_IMMUNE":false,"CAN_BE_NEGATIVE":false,"IS_A_DEBT":false,"CATEGORY":"pension","PURCHASE_PRICE":"0.0","LIABILITY":""}],\n"transactions":[\n{"NAME":"TransferCrystallizedPensionAegon","FROM":"CrystallizedPensionJoe","FROM_ABSOLUTE":false,"FROM_VALUE":"1.0","TO":"CrystallizedPensionJack","TO_ABSOLUTE":false,"TO_VALUE":"1.0","DATE":"2035","STOP_DATE":"","RECURRENCE":"","CATEGORY":"pension","TYPE":"auto"},\n{"NAME":"PensionAegon","FROM":"javaJob1","FROM_ABSOLUTE":false,"FROM_VALUE":"0.05","TO":"PensionAegon","TO_ABSOLUTE":false,"TO_VALUE":"11","DATE":"2021","STOP_DATE":"2025","RECURRENCE":"","CATEGORY":"pension","TYPE":"auto"},\n{"NAME":"MoveTaxFreePartAegon","FROM":"PensionAegon","FROM_ABSOLUTE":false,"FROM_VALUE":"0.25","TO":"AegonTaxFree","TO_ABSOLUTE":false,"TO_VALUE":"1.0","DATE":"2030","STOP_DATE":"","RECURRENCE":"","CATEGORY":"pension","TYPE":"auto"},\n{"NAME":"CrystallizedPensionAegon","FROM":"PensionAegon","FROM_ABSOLUTE":false,"FROM_VALUE":"1.0","TO":"CrystallizedPensionJoe","TO_ABSOLUTE":false,"TO_VALUE":"1.0","DATE":"2030","STOP_DATE":"","RECURRENCE":"","CATEGORY":"pension","TYPE":"auto"}],\n"settings":[\n{"NAME":"Today\'s value focus date","VALUE":"","HINT":"Date to use for \'today\'s value\' tables (defaults to \'\' meaning today)","TYPE":"view"},\n{"NAME":"stockMarketGrowth","VALUE":"6.236","HINT":"Custom setting for stock market growth","TYPE":"const"},\n{"NAME":"End of view range","VALUE":"1 Feb 2045","HINT":"","TYPE":"const"},\n{"NAME":"Date of birth","VALUE":"","HINT":"Date used for representing dates as ages","TYPE":"view"},\n{"NAME":"cpi","VALUE":"2.5","HINT":"Annual rate of inflation","TYPE":"const"},\n{"NAME":"Beginning of view range","VALUE":"1 Jan 2019","HINT":"","TYPE":"const"}],\n"triggers":[\n],"version":4}',yr='\n{"assets":[\n  {"NAME":"Cash","CATEGORY":"","START":"1 Jan 2017","VALUE":"0.0","QUANTITY":"","GROWTH":"0.0","CPI_IMMUNE":true,"CAN_BE_NEGATIVE":true,"IS_A_DEBT":false,"LIABILITY":"","PURCHASE_PRICE":"0.0"},\n  {"NAME":"-PEN javaDCP","VALUE":"0","QUANTITY":"","START":"2021","GROWTH":"0","CPI_IMMUNE":false,"CAN_BE_NEGATIVE":false,"IS_A_DEBT":false,"CATEGORY":"","PURCHASE_PRICE":"0.0","LIABILITY":""},\n  {"NAME":"-PEN cppDCP","VALUE":"0","QUANTITY":"","START":"2022","GROWTH":"0","CPI_IMMUNE":false,"CAN_BE_NEGATIVE":false,"IS_A_DEBT":false,"CATEGORY":"","PURCHASE_PRICE":"0.0","LIABILITY":""},\n  {"NAME":"-CPTaxFree javaDCP","VALUE":"0.0","QUANTITY":"","START":"2021","GROWTH":"0","CPI_IMMUNE":false,"CAN_BE_NEGATIVE":false,"IS_A_DEBT":false,"CATEGORY":"","PURCHASE_PRICE":"0.0","LIABILITY":""},\n  {"NAME":"-CPTaxFree cppDCP","VALUE":"0.0","QUANTITY":"","START":"2022","GROWTH":"0","CPI_IMMUNE":false,"CAN_BE_NEGATIVE":false,"IS_A_DEBT":false,"CATEGORY":"","PURCHASE_PRICE":"0.0","LIABILITY":""},\n  {"NAME":"-CPTaxable Joe.javaDCP","VALUE":"0.0","QUANTITY":"","START":"2021","GROWTH":"0","CPI_IMMUNE":false,"CAN_BE_NEGATIVE":false,"IS_A_DEBT":false,"CATEGORY":"","PURCHASE_PRICE":"0.0","LIABILITY":""},\n  {"NAME":"-CPTaxable Joe.cppDCP","VALUE":"0.0","QUANTITY":"","START":"2022","GROWTH":"0","CPI_IMMUNE":false,"CAN_BE_NEGATIVE":false,"IS_A_DEBT":false,"CATEGORY":"","PURCHASE_PRICE":"0.0","LIABILITY":""},\n  {"NAME":"-CPTaxable Jen.cppDCP","VALUE":"0.0","QUANTITY":"","START":"2022","GROWTH":"0","CPI_IMMUNE":false,"CAN_BE_NEGATIVE":false,"IS_A_DEBT":false,"CATEGORY":"","PURCHASE_PRICE":"0.0","LIABILITY":""},\n  {"NAME":"-CPTaxable Jane.javaDCP","VALUE":"0.0","QUANTITY":"","START":"2021","GROWTH":"0","CPI_IMMUNE":false,"CAN_BE_NEGATIVE":false,"IS_A_DEBT":false,"CATEGORY":"","PURCHASE_PRICE":"0.0","LIABILITY":""}],\n  "incomes":[\n  {"NAME":"JoeBasic","VALUE":"1050","VALUE_SET":"2020","START":"2020","END":"2030","GROWTH":"0","CPI_IMMUNE":true,"LIABILITY":"Joe(incomeTax)/Joe(NI)","CATEGORY":""},\n  {"NAME":"JenBasic","VALUE":"1050","VALUE_SET":"2020","START":"2020","END":"2030","GROWTH":"0","CPI_IMMUNE":true,"LIABILITY":"Jen(incomeTax)/Jen(NI)","CATEGORY":""},\n  {"NAME":"JeffBasic","VALUE":"1050","VALUE_SET":"2020","START":"2020","END":"2030","GROWTH":"0","CPI_IMMUNE":true,"LIABILITY":"Jeff(incomeTax)/Jeff(NI)","CATEGORY":""},\n  {"NAME":"java","VALUE":"3000","VALUE_SET":"2020","START":"2021","END":"2022","GROWTH":"0","CPI_IMMUNE":true,"LIABILITY":"Joe(incomeTax)/Joe(NI)","CATEGORY":""},\n  {"NAME":"JaneBasic","VALUE":"1050","VALUE_SET":"2020","START":"2020","END":"2030","GROWTH":"0","CPI_IMMUNE":true,"LIABILITY":"Jane(incomeTax)/Jane(NI)","CATEGORY":""},\n  {"NAME":"JakeBasic","VALUE":"1050","VALUE_SET":"2020","START":"2020","END":"2030","GROWTH":"0","CPI_IMMUNE":true,"LIABILITY":"Jake(incomeTax)/Jake(NI)","CATEGORY":""},\n  {"NAME":"cpp","VALUE":"4000","VALUE_SET":"2020","START":"2022","END":"2023","GROWTH":"0","CPI_IMMUNE":true,"LIABILITY":"Joe(incomeTax)/Joe(NI)","CATEGORY":""},\n  {"START":"2026","END":"2028","NAME":"-PT javaPensh","VALUE":"0.0","VALUE_SET":"2021","LIABILITY":"Jeff(incomeTax)","GROWTH":"0","CPI_IMMUNE":true,"CATEGORY":""},\n  {"START":"2026","END":"2028","NAME":"-PT cppPensh","VALUE":"0.0","VALUE_SET":"2022","LIABILITY":"Jake(incomeTax)","GROWTH":"0","CPI_IMMUNE":true,"CATEGORY":""},\n  {"START":"2026","END":"2027","NAME":"-PDB javaPensh","VALUE":"0","VALUE_SET":"2021","LIABILITY":"Joe(incomeTax)","GROWTH":"0","CPI_IMMUNE":true,"CATEGORY":""},\n  {"START":"2026","END":"2027","NAME":"-PDB cppPensh","VALUE":"0","VALUE_SET":"2022","LIABILITY":"Joe(incomeTax)","GROWTH":"0","CPI_IMMUNE":true,"CATEGORY":""}],\n  "expenses":[],\n  "triggers":[],\n  "settings":[\n  {"NAME":"Today\'s value focus date","VALUE":"","HINT":"Date to use for \'today\'s value\' tables (defaults to \'\' meaning today)","TYPE":"view"},\n  {"NAME":"End of view range","VALUE":"1 Jan 2030","HINT":"Date at the end of range to be plotted","TYPE":"view"},\n  {"NAME":"Date of birth","VALUE":"","HINT":"Date used for representing dates as ages","TYPE":"view"},\n  {"NAME":"cpi","VALUE":"0","HINT":"Annual rate of inflation","TYPE":"const"},\n  {"NAME":"Beginning of view range","VALUE":"30 Dec 2019","HINT":"Date at the start of range to be plotted","TYPE":"view"}],\n  "transactions":[\n  {"NAME":"-PT javaPensh","FROM":"-PDB javaPensh","FROM_ABSOLUTE":false,"FROM_VALUE":"1.0","TO":"-PT javaPensh","TO_ABSOLUTE":false,"TO_VALUE":"0.5","DATE":"2027","STOP_DATE":"2028","RECURRENCE":"","CATEGORY":"","TYPE":"auto"},\n  {"NAME":"-PT cppPensh","FROM":"-PDB cppPensh","FROM_ABSOLUTE":false,"FROM_VALUE":"1.0","TO":"-PT cppPensh","TO_ABSOLUTE":false,"TO_VALUE":"0.5","DATE":"2027","STOP_DATE":"2028","RECURRENCE":"","CATEGORY":"","TYPE":"auto"},\n  {"NAME":"-PEN javaPensh","FROM":"java","FROM_ABSOLUTE":false,"FROM_VALUE":"0.05","TO":"","TO_ABSOLUTE":false,"TO_VALUE":"0.0","DATE":"2021","STOP_DATE":"2022","RECURRENCE":"","CATEGORY":"","TYPE":"auto"},\n  {"NAME":"-PEN javaDCP","FROM":"java","FROM_ABSOLUTE":false,"FROM_VALUE":"0.05","TO":"-PEN javaDCP","TO_ABSOLUTE":false,"TO_VALUE":"2","DATE":"2021","STOP_DATE":"2022","RECURRENCE":"","CATEGORY":"","TYPE":"auto"},\n  {"NAME":"-PEN cppPensh","FROM":"cpp","FROM_ABSOLUTE":false,"FROM_VALUE":"0.05","TO":"","TO_ABSOLUTE":false,"TO_VALUE":"0.0","DATE":"2022","STOP_DATE":"2023","RECURRENCE":"","CATEGORY":"","TYPE":"auto"},\n  {"NAME":"-PEN cppDCP","FROM":"cpp","FROM_ABSOLUTE":false,"FROM_VALUE":"0.05","TO":"-PEN cppDCP","TO_ABSOLUTE":false,"TO_VALUE":"2","DATE":"2022","STOP_DATE":"2025","RECURRENCE":"","CATEGORY":"","TYPE":"auto"},\n  {"NAME":"-PDB javaPensh","FROM":"java","FROM_ABSOLUTE":false,"FROM_VALUE":"0.0016666666666666668","TO":"-PDB javaPensh","TO_ABSOLUTE":false,"TO_VALUE":"1.0","DATE":"2021","STOP_DATE":"2022","RECURRENCE":"","CATEGORY":"","TYPE":"auto"},\n  {"NAME":"-PDB cppPensh","FROM":"cpp","FROM_ABSOLUTE":false,"FROM_VALUE":"0.0016666666666666668","TO":"-PDB cppPensh","TO_ABSOLUTE":false,"TO_VALUE":"1.0","DATE":"2022","STOP_DATE":"2023","RECURRENCE":"","CATEGORY":"","TYPE":"auto"},\n  {"NAME":"-CPTaxFreeM javaDCP","FROM":"-PEN javaDCP","FROM_ABSOLUTE":false,"FROM_VALUE":"0.25","TO":"-CPTaxFree javaDCP","TO_ABSOLUTE":false,"TO_VALUE":"1.0","DATE":"2023","STOP_DATE":"","RECURRENCE":"","CATEGORY":"","TYPE":"auto"},\n  {"NAME":"-CPTaxFreeM cppDCP","FROM":"-PEN cppDCP","FROM_ABSOLUTE":false,"FROM_VALUE":"0.25","TO":"-CPTaxFree cppDCP","TO_ABSOLUTE":false,"TO_VALUE":"1.0","DATE":"2024","STOP_DATE":"","RECURRENCE":"","CATEGORY":"","TYPE":"auto"},\n  {"NAME":"-CPTaxable javaDCP","FROM":"-PEN javaDCP","FROM_ABSOLUTE":false,"FROM_VALUE":"1.0","TO":"-CPTaxable Joe.javaDCP","TO_ABSOLUTE":false,"TO_VALUE":"1.0","DATE":"2023","STOP_DATE":"","RECURRENCE":"","CATEGORY":"","TYPE":"auto"},\n  {"NAME":"-CPTaxable cppDCP","FROM":"-PEN cppDCP","FROM_ABSOLUTE":false,"FROM_VALUE":"1.0","TO":"-CPTaxable Joe.cppDCP","TO_ABSOLUTE":false,"TO_VALUE":"1.0","DATE":"2024","STOP_DATE":"","RECURRENCE":"","CATEGORY":"","TYPE":"auto"},\n  {"NAME":"-CPT javaDCP","FROM":"-CPTaxable Joe.javaDCP","FROM_ABSOLUTE":false,"FROM_VALUE":"1.0","TO":"-CPTaxable Jane.javaDCP","TO_ABSOLUTE":false,"TO_VALUE":"1.0","DATE":"2024","STOP_DATE":"","RECURRENCE":"","CATEGORY":"","TYPE":"auto"},\n  {"NAME":"-CPT cppDCP","FROM":"-CPTaxable Joe.cppDCP","FROM_ABSOLUTE":false,"FROM_VALUE":"1.0","TO":"-CPTaxable Jen.cppDCP","TO_ABSOLUTE":false,"TO_VALUE":"1.0","DATE":"2025","STOP_DATE":"","RECURRENCE":"","CATEGORY":"","TYPE":"auto"}],\n  "version":8}\n',Sr={NAME:"NoName",CATEGORY:"",START:"1 Jan 2017",END:"1 Jan 2017",VALUE:"0.0",VALUE_SET:"1 Jan 2017",CPI_IMMUNE:!1,GROWTH:"0.0",RECURRENCE:"1m"},Ir={NAME:"NoName",CATEGORY:"",START:"1 Jan 2017",END:"1 Jan 2017",VALUE:"0",VALUE_SET:"1 Jan 2017",CPI_IMMUNE:!1,GROWTH:"0",LIABILITY:""},Ur={NAME:"NoName",FROM:"",FROM_ABSOLUTE:!0,FROM_VALUE:"0.0",TO:"",TO_ABSOLUTE:!0,TO_VALUE:"0.0",DATE:"1 Jan 2017",STOP_DATE:"",RECURRENCE:"",CATEGORY:"",TYPE:"custom"},wr={triggers:[],incomes:[],expenses:[],transactions:[],assets:[],settings:[],version:0,undoModel:void 0,redoModel:void 0},Dr={NAME:"NoName",VALUE:"NoValue",HINT:"NoHint",TYPE:"const"},_r=Object(c.a)(Object(c.a)({},Dr),{},{HINT:"",TYPE:"view"}),Lr=[Object(c.a)(Object(c.a)({},_r),{},{NAME:C,VALUE:"1 Jan 2019",HINT:y}),Object(c.a)(Object(c.a)({},_r),{},{NAME:M,VALUE:"1 Feb 2019",HINT:R}),Object(c.a)(Object(c.a)({},_r),{},{NAME:J,VALUE:"val"}),Object(c.a)(Object(c.a)({},_r),{},{NAME:D,VALUE:_}),Object(c.a)(Object(c.a)({},_r),{},{NAME:x,VALUE:k}),Object(c.a)(Object(c.a)({},Dr),{},{NAME:b,VALUE:"2.5",HINT:N}),Object(c.a)(Object(c.a)({},Dr),{},{NAME:"stockMarketGrowth",VALUE:"6.236",HINT:"Custom setting for stock market growth"}),Object(c.a)(Object(c.a)({},_r),{},{NAME:F,VALUE:"Cash"}),Object(c.a)(Object(c.a)({},_r),{},{NAME:j,VALUE:"All"}),Object(c.a)(Object(c.a)({},_r),{},{NAME:Y,VALUE:"All"}),Object(c.a)(Object(c.a)({},_r),{},{NAME:S,VALUE:"",HINT:I}),Object(c.a)(Object(c.a)({},_r),{},{NAME:U,VALUE:"",HINT:w})],xr=[Object(c.a)(Object(c.a)({},_r),{},{NAME:x,VALUE:k}),Object(c.a)(Object(c.a)({},_r),{},{NAME:J,VALUE:"val"}),Object(c.a)(Object(c.a)({},_r),{},{NAME:F,VALUE:"All"}),Object(c.a)(Object(c.a)({},_r),{},{NAME:B,VALUE:"All"}),Object(c.a)(Object(c.a)({},_r),{},{NAME:j,VALUE:"All"}),Object(c.a)(Object(c.a)({},_r),{},{NAME:Y,VALUE:"All"}),Object(c.a)(Object(c.a)({},_r),{},{NAME:G,VALUE:"All"}),Object(c.a)(Object(c.a)({},_r),{},{NAME:W,VALUE:"All"}),Object(c.a)(Object(c.a)({},_r),{},{NAME:H,VALUE:"Y"}),Object(c.a)(Object(c.a)({},Dr),{},{NAME:b,VALUE:"0.0",HINT:N}),Object(c.a)(Object(c.a)({},_r),{},{NAME:S,VALUE:"",HINT:I}),Object(c.a)(Object(c.a)({},_r),{},{NAME:U,VALUE:"",HINT:w})],Pr={NAME:"NoName",CATEGORY:"",START:"1 Jan 2017",VALUE:"0",QUANTITY:"",GROWTH:"0",CPI_IMMUNE:!1,CAN_BE_NEGATIVE:!1,IS_A_DEBT:!1,LIABILITY:"",PURCHASE_PRICE:"0"};function Vr(e){return[Object(c.a)(Object(c.a)({},Dr),{},{NAME:b,VALUE:"0.0",HINT:N}),Object(c.a)(Object(c.a)({},_r),{},{NAME:S,VALUE:"",HINT:I}),Object(c.a)(Object(c.a)({},_r),{},{NAME:U,VALUE:"",HINT:w}),Object(c.a)(Object(c.a)({},_r),{},{NAME:C,VALUE:e.start,HINT:y}),Object(c.a)(Object(c.a)({},_r),{},{NAME:M,VALUE:e.end,HINT:R})]}var kr={assets:[{NAME:"Cash",CATEGORY:"",START:"1 Jan 2017",VALUE:"0.0",QUANTITY:"",GROWTH:"0.0",CPI_IMMUNE:!0,CAN_BE_NEGATIVE:!0,IS_A_DEBT:!1,LIABILITY:"",PURCHASE_PRICE:"0.0"}],incomes:[],expenses:[],triggers:[],settings:[{NAME:b,VALUE:"2.5",HINT:N,TYPE:"const"},{NAME:C,VALUE:"1 Jan 2017",HINT:y,TYPE:"view"},{NAME:M,VALUE:"1 Jan 2023",HINT:R,TYPE:"view"},{NAME:S,VALUE:"",HINT:I,TYPE:"view"},{NAME:U,VALUE:"",HINT:w,TYPE:"view"}],transactions:[],version:8,undoModel:void 0,redoModel:void 0};function Fr(){return ir(JSON.stringify(kr))}var Br=a(68),jr=Object(r.createContext)(),Yr=function(e){Object(p.a)(a,e);var t=Object(A.a)(a);function a(){var e;Object(h.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={auth0Client:null,isLoading:!0,isAuthenticated:!1,user:null},e.config={domain:"dev-49nrx3uc.eu.auth0.com",client_id:"tY4zF9iFvwTXUnM6L2IQzOXaydqODU5a",redirect_uri:window.location.origin+"/FinKitty"},e.initializeAuth0=Object(T.a)(l.a.mark((function t(){var a,n,r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,Object(Br.a)(e.config);case 3:if(a=t.sent,e.setState({auth0Client:a}),!window.location.search.includes("code=")){t.next=7;break}return t.abrupt("return",e.handleRedirectCallback());case 7:return t.next=9,a.isAuthenticated();case 9:if(!(n=t.sent)){t.next=16;break}return t.next=13,a.getUser();case 13:t.t0=t.sent,t.next=17;break;case 16:t.t0=null;case 17:r=t.t0,e.setState({isLoading:!1,isAuthenticated:n,user:r});case 19:case"end":return t.stop()}}),t)}))),e.handleRedirectCallback=Object(T.a)(l.a.mark((function t(){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({isLoading:!0}),t.next=3,e.state.auth0Client.handleRedirectCallback();case 3:return t.next=5,e.state.auth0Client.getUser();case 5:a=t.sent,e.setState({user:a,isAuthenticated:!0,isLoading:!1}),window.history.replaceState({},document.title,window.location.pathname);case 8:case"end":return t.stop()}}),t)}))),e}return Object(E.a)(a,[{key:"componentDidMount",value:function(){this.initializeAuth0()}},{key:"render",value:function(){var e=this,t=this.state,a=t.auth0Client,n=t.isLoading,r=t.isAuthenticated,o=t.user,i=this.props.children,c={isLoading:n,isAuthenticated:r,user:o,loginWithRedirect:function(){return a.loginWithRedirect.apply(a,arguments)},loginForTesting:function(){e.setState({user:{sub:"TestUserID"},isAuthenticated:!0,isLoading:!1})},getTokenSilently:function(){return a.getTokenSilently.apply(a,arguments)},getIdTokenClaims:function(){return a.getIdTokenClaims.apply(a,arguments)},logout:function(){return a.logout.apply(a,arguments)}};return s.a.createElement(jr.Provider,{value:c},i)}}]),a}(r.Component),Gr=a(14);function Wr(e,t){var a=t.find((function(t){return t.NAME===e}));if(void 0!==a)return a.CATEGORY.length>0?a.CATEGORY:e}function Hr(e,t){var a=Wr(e,t.incomes);void 0===a&&(a=Wr(e,t.expenses)),void 0===a&&(a=Wr(e,t.assets)),void 0===a&&(a=Wr(e,t.transactions));var n=t.transactions.find((function(t){return Mn(t)===e}));return void 0!==n?n.CATEGORY.length>0?n.CATEGORY:e:void 0===a?e:a}var Jr=function(){function e(t){var a,r,s,o=this;Object(h.a)(this,e),this.kvPairs=new Map,this.show=(a={},Object(Gr.a)(a,n.Asset,new Map),Object(Gr.a)(a,n.Debt,new Map),Object(Gr.a)(a,n.Income,new Map),Object(Gr.a)(a,n.Expense,new Map),a),this.dependents=(r={},Object(Gr.a)(r,n.Asset,new Map),Object(Gr.a)(r,n.Debt,new Map),Object(Gr.a)(r,n.Income,new Map),Object(Gr.a)(r,n.Expense,new Map),r),this.supercategories=(s={},Object(Gr.a)(s,n.Asset,new Map),Object(Gr.a)(s,n.Debt,new Map),Object(Gr.a)(s,n.Income,new Map),Object(Gr.a)(s,n.Expense,new Map),s),t.forEach((function(e){o.kvPairs.set(e.NAME,e.VALUE);var t=o.makeContextFromString(e.NAME);void 0!==t&&o.show[t].set(e.VALUE,!0)})),this.dependents=this.makeEmptyDependents(),this.supercategories=this.makeEmptySuperCategories()}return Object(E.a)(e,[{key:"makeEmptyDependents",value:function(){var e,t=(e={},Object(Gr.a)(e,n.Asset,new Map),Object(Gr.a)(e,n.Debt,new Map),Object(Gr.a)(e,n.Income,new Map),Object(Gr.a)(e,n.Expense,new Map),e);return t[n.Asset].set("All",[]),t[n.Debt].set("All",[]),t[n.Income].set("All",[]),t[n.Expense].set("All",[]),t}},{key:"makeEmptySuperCategories",value:function(){var e;return e={},Object(Gr.a)(e,n.Asset,new Map),Object(Gr.a)(e,n.Debt,new Map),Object(Gr.a)(e,n.Income,new Map),Object(Gr.a)(e,n.Expense,new Map),e}},{key:"setInMapIfAbsent",value:function(e,t,a){var n=this.show[e];if(void 0===n.get(t)){var r=this.highlightButton(e,a)||this.highlightButton(e,"All");n.set(t,r)}}},{key:"addToDependents",value:function(e,t,a){var n=this.dependents[e],r=n.get(t);void 0===r&&(r=[],n.set(t,r)),void 0===r.find((function(e){return e===a}))&&r.push(a),this.addToSuperCategories(e,a,t)}},{key:"addToSuperCategories",value:function(e,t,a){var n=this.supercategories[e],r=n.get(t);void 0===r&&(r=[],n.set(t,r)),void 0===r.find((function(e){return e===a}))&&r.push(a)}},{key:"setItemFromModel",value:function(e,t){this.addToDependents(e,"All",t.NAME),this.addToDependents(e,"All",t.CATEGORY),this.addToDependents(e,t.CATEGORY,t.NAME),this.setInMapIfAbsent(e,t.CATEGORY,t.CATEGORY),this.setInMapIfAbsent(e,t.NAME,t.CATEGORY)}},{key:"setModel",value:function(e){var t=this;this.dependents=this.makeEmptyDependents(),this.supercategories=this.makeEmptySuperCategories(),e.assets.forEach((function(e){e.IS_A_DEBT?t.setItemFromModel(n.Debt,e):t.setItemFromModel(n.Asset,e)})),e.expenses.forEach((function(e){t.setItemFromModel(n.Expense,e)})),e.incomes.forEach((function(e){t.setItemFromModel(n.Income,e)}))}},{key:"makeContextFromString",value:function(e){return e===F?n.Asset:e===B?n.Debt:e===Y?n.Income:e===j?n.Expense:void 0}},{key:"setViewSetting",value:function(e,t){return!!this.kvPairs.get(e)&&(this.kvPairs.set(e,t),!0)}},{key:"setViewFilter",value:function(e,t,a){var n=this;this.show[e].set(t,a);var r=this.dependents[e].get(t);if(void 0!==r&&r.forEach((function(t){n.show[e].set(t,a)})),!1===a){var s=this.supercategories[e].get(t);void 0!==s&&s.forEach((function(t){n.show[e].set(t,!1)}))}}},{key:"toggleViewFilter",value:function(e,t){this.highlightButton(e,t)?this.setViewFilter(e,t,!1):this.setViewFilter(e,t,!0)}},{key:"migrateViewSettingString",value:function(e,t){var a=this.makeContextFromString(e);return void 0!==a?void 0!==this.show[a].get(t)&&(this.migrateViewSetting(a,t),!0):!!this.kvPairs.get(e)&&(this.kvPairs.set(e,t),e===D&&t!==_&&Oe("migrateViewSettingString seting non-annual frequency"),!0)}},{key:"migrateViewSetting",value:function(e,t){var a,n=Object(m.a)(this.show[e]);try{for(n.s();!(a=n.n()).done;){var r=Object(f.a)(a.value,1)[0];this.show[e].set(r,!1)}}catch(s){n.e(s)}finally{n.f()}this.setViewFilter(e,t,!0)}},{key:"getShowItem",value:function(e,t){var a=this.show[e].get(t);return void 0!==a&&a}},{key:"getShowAll",value:function(e){var t=this.show[e].get("All");return void 0!==t&&t}},{key:"getViewSetting",value:function(e,t){var a=this.kvPairs.get(e);return void 0===a&&(a=t),a}},{key:"getChartViewType",value:function(e){return this.kvPairs.get(J)===e}},{key:"highlightButton",value:function(e,t){var a=this.show[e].get(t);return void 0!==a&&a}}]),e}();function Kr(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t){Oe("twoMap:");var a,n=Object(m.a)(e);try{for(n.s();!(a=n.n()).done;){var r=Object(f.a)(a.value,2),s=r[0],o=r[1];Oe("twoMap[".concat(s,"]..."));var i,c=Object(m.a)(o);try{for(c.s();!(i=c.n()).done;){var u=Object(f.a)(i.value,2),l=u[0],h=u[1];Oe("twoMap[".concat(s,"][").concat(l,"]=").concat(h))}}catch(E){c.e(E)}finally{c.f()}}}catch(E){n.e(E)}finally{n.f()}}}function Qr(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t){Oe("threeMap:");var a,n=Object(m.a)(e);try{for(n.s();!(a=n.n()).done;){var r=Object(f.a)(a.value,2),s=r[0],o=r[1];Oe("threeMap[".concat(s,"]..."));var i,c=Object(m.a)(o);try{for(c.s();!(i=c.n()).done;){var u=Object(f.a)(i.value,2),l=u[0],h=u[1];Oe("threeMap[".concat(s,"][").concat(l,"]..."));var E,d=Object(m.a)(h);try{for(d.s();!(E=d.n()).done;){var p=Object(f.a)(E.value,2),A=p[0],T=p[1];Oe("threeMap[".concat(s,"][").concat(l,"][").concat(A,"] = ").concat(be(T)))}}catch(v){d.e(v)}finally{d.f()}}}catch(v){c.e(v)}finally{c.f()}}}catch(v){n.e(v)}finally{n.f()}}}function qr(e,t,a){var n=new Map;return t.forEach((function(t){var r=0,s=t.toDateString();a.forEach((function(t){var a=e.get(s);if(void 0!==a){var n=a.get(t);void 0!==n&&(r+=n)}}));var o=n.get(s);void 0===o&&(n.set(s,new Map),o=n.get(s)),void 0!==o&&o.set("Total",r)})),Kr(n),n}function zr(e,t,a,n){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=e,i=a;s&&(o=qr(o,t,i),i=["Total"]),Kr(o);var c=new Map;t.forEach((function(e){var t=e.toDateString();i.forEach((function(a){var s=0,i=o.get(t);if(void 0!==i){var u=i.get(a);void 0!==u&&(s=u,r&&(s=-s))}c.has(a)||c.set(a,[]);var l=c.get(a);if(void 0===l)Oe("BUG; chartArray should be defined");else{var h=He(s),E=ur(n,S,""),d=t;if(""!==E){var p=e.getTime()-Re(E).getTime(),A=Math.floor(p/315576e5);d="".concat(A)}l.push({label:d,y:s,ttip:"".concat(parseFloat(h).toFixed(2)," at ").concat(t)})}}))}));var u,l=[],h=Object(m.a)(c);try{for(h.s();!(u=h.n()).done;){var E=Object(f.a)(u.value,2),d=E[0],p=E[1];l.push({name:d,chartDataPoints:p})}}catch(T){h.e(T)}finally{h.f()}var A=[];return l.forEach((function(e){e.chartDataPoints.findIndex((function(e){return 0!==e.y}))>=0&&A.push({item:{NAME:e.name},chartDataPoints:e.chartDataPoints})})),A}function Zr(e,t,a){var r=e.split("/"),s={asset:!1,debt:!1,tax:!1};return r.length>1&&r.shift(),r.forEach((function(e){var r=function(e,t,a){var r={asset:!1,debt:!1,tax:!1},s=t.assets.filter((function(t){return t.NAME===e}));0!==s.length&&(s[0].IS_A_DEBT?a.getShowItem(n.Debt,s[0].NAME)&&(r.debt=!0):a.getShowItem(n.Asset,s[0].NAME)&&(r.asset=!0));var o=t.assets.filter((function(t){return t.CATEGORY===e}));return 0!==o.length&&o.forEach((function(e){e.IS_A_DEBT?a.getShowItem(n.Debt,e.NAME)&&(r.debt=!0):a.getShowItem(n.Asset,e.NAME)&&(r.asset=!0)})),r}(e,t,a);r.asset&&(s.asset=!0),r.debt&&(s.debt=!0),r.tax&&(s.tax=!0)})),s}function Xr(e,t,a){var n=[],r=[];return e.forEach((function(e){var s=Zr(e,t,a);s.asset?n.push(e):s.debt&&r.push(e)})),{assetChartNames:n,debtChartNames:r}}function $r(e,t,a,n,r){var s=new Set,o=new Map;return t.forEach((function(t){a.forEach((function(a){var i=t.toDateString(),c=e.get(i);if(void 0!==c){var u=c.get(a);if(void 0!==u){o.has(i)||o.set(i,new Map);var l=o.get(i);if(void 0!==l){var h=function(e,t,a){var n=t.get(e);if(void 0!==n)return n;var r=e.split("/");if(0===r.length)return t.set(e,""),"";var s=r[0],o=Hr(s,a);if(1===r.length&&o!==s)return t.set(e,o),o;if(r.length>1&&("growth"===s||"Revalue"===s)){var i=r[1],c=Hr(i,a);if(c!==i){var u=s+"/"+c;return t.set(e,u),u}}if(r.length>1){var l=o+"/"+Hr(r[1],a);return t.set(e,l),l}return t.set(e,e),e}(a,r,n);s.add(h);var E=l.get(h);if(void 0===E)l.set(h,u);else{var d=E+u;l.set(h,d)}}else Oe("BUG - map should exist")}}}))})),{map:o,sources:s}}function es(e,t,a,n,r){var s=new Set,o=new Map;return t.forEach((function(t){a.forEach((function(a){var s=t.toDateString(),i=e.get(s);if(void 0!==i){var c=i.get(a);if(void 0!==c){o.has(s)||o.set(s,new Map);var u=o.get(s);void 0!==u?n.getShowItem(r,a)&&u.set(a,c):Oe("BUG - map should exist")}}}))})),{map:o,sources:s}}function ts(e,t){var a=t.get(e.name);if(void 0!==a)return a;!function(e,t){if(e.name.startsWith("Purchase")){var a=t.get(e.name.substring("Purchase".length));if(a===za)return;if(void 0===a)throw new Error("BUG!! purchase evaluation of an unknown type: ".concat(be(e)));Oe("BUG!! Purchase of non-asset? : ".concat(be(e)))}else if(e.name.startsWith("quantity")){if(t.get(e.name.substring("quantity".length))===za);}else{if(!e.name.startsWith("BMV"))throw new Error("BUG!! evaluation of an unknown type: ".concat(be(e)));if(t.get(e.name.substring("BMV".length))===Za);}}(e,t)}function as(e,t,a){if(0===a.evaluations.length)return{labels:[],expensesData:[],incomesData:[],assetData:[],debtData:[],taxData:[],todaysAssetValues:new Map,todaysDebtValues:new Map,todaysIncomeValues:new Map,todaysExpenseValues:new Map,todaysSettingValues:new Map,reportData:[]};var r={start:Re(ur(e.settings,C,"Oct 1, 2017")),end:Re(ur(e.settings,M,"Oct 1, 2022"))},s=e.incomes.map((function(e){return e.NAME})),o=e.expenses.map((function(e){return e.NAME})),i=e.assets.filter((function(e){return!1===e.IS_A_DEBT})).map((function(e){return e.NAME})),c=e.assets.filter((function(e){return!0===e.IS_A_DEBT})).map((function(e){return e.NAME})),u=new Map,l=function(e){var t=e.getViewSetting(x,k),a=e.getViewSetting(D,_),n=e.getViewSetting(W,"All"),r=e.getViewSetting(G,"All"),s=e.getViewSetting(H,"All");return{detail:t,frequency:a,taxChartType:n,taxChartPerson:r,taxChartNet:"Y"===s||"y"===s||"yes"===s}}(t),h=l.detail,E=l.frequency,d=l.taxChartType,p=l.taxChartPerson,A=l.taxChartNet,f=t.getShowAll(n.Asset),m=t.getShowAll(n.Debt),T=t.getShowAll(n.Income),v=t.getShowAll(n.Expense),g=t.getChartViewType("+"),b=t.getChartViewType("-"),N=t.getChartViewType("val"),R={labels:[],expensesData:[],incomesData:[],assetData:[],debtData:[],taxData:[],todaysAssetValues:new Map,todaysDebtValues:new Map,todaysIncomeValues:new Map,todaysExpenseValues:new Map,todaysSettingValues:new Map,reportData:[]};R.todaysAssetValues=a.todaysAssetValues,R.todaysDebtValues=a.todaysDebtValues,R.todaysIncomeValues=a.todaysIncomeValues,R.todaysExpenseValues=a.todaysExpenseValues,R.todaysSettingValues=a.todaysSettingValues;var y=function(e){var t=new Map;return e.expenses.forEach((function(e){t.set(e.NAME,Qa)})),e.incomes.forEach((function(e){t.set(e.NAME,qa),e.LIABILITY.split("/").forEach((function(e){if(e.endsWith(K)){var a=e.substring(0,e.length-K.length),n=Ie(a),r=we(a);t.set(r,Xa),t.set(n,Xa)}else if(e.endsWith("(NI)")){var s=e.substring(0,e.length-"(NI)".length),o=Ue(s),i=we(s);t.set(i,Xa),t.set(o,Xa)}}))})),e.assets.forEach((function(e){if(t.set(e.NAME,za),e.NAME.startsWith($)&&t.set("".concat(e.NAME,"Contribution"),Xa),e.LIABILITY.split("/").forEach((function(e){if(e.endsWith(z)){var a=e.substring(0,e.length-z.length),n=De(a),r=_e(a);t.set(r,Xa),t.set(n,Xa)}else if(e.endsWith(K)){var s=e.substring(0,e.length-K.length),o=Ie(s),i=we(s);t.set(i,Xa),t.set(o,Xa)}else if(e.endsWith("(NI)")){var c=e.substring(0,e.length-"(NI)".length),u=Ue(c),l=we(c);t.set(l,Xa),t.set(u,Xa)}})),e.NAME.startsWith(q)){var a=e.NAME.substring(q.length).split(".")[0],n=Ie(a),r=we(a);t.set(r,Xa),t.set(n,Xa)}})),e.settings.forEach((function(e){t.set(e.NAME,Za)})),t.set(K,Xa),t.set("(NI)",Xa),t.set(z,Xa),t}(e),S=function(e,t){return La(e,t===L?"1m":"1y",!0)}(r,E),I=new Map;I.set("assetOrDebtFocus",new Map),I.set("tax",new Map);var U=[],w=new Map;a.evaluations.forEach((function(a){var r=S.find((function(e){return e>=a.date}));if(void 0!==r){var s=ts(a,y);if(s){if(s===qa||s===Qa){if("Revalue"===a.source)return;if(a.name.startsWith($)){var o=e.incomes.find((function(e){return e.NAME===a.name}));if(void 0===o)throw new Error("couldn't match income for ".concat(a.name));if(a.date<Xe(o.START,e.triggers))return}}!function(e,t){void 0===e.get(t)&&e.set(t,new Map)}(I,s);var i=I.get(s);if(void 0!==i){var c=r.toDateString();i.has(c)||i.set(c,new Map);var u=i.get(c);if(void 0!==u){var l=u.get(a.name);if(s===Xa)u.set(a.source,a.value);else if(void 0===l||s===za)u.set(a.name,a.value);else if(s===qa||s===Qa||s===Qa){var h=l+a.value;u.set(a.name,h)}else if(s!==Za)throw new Error("unhandled evaluation type ".concat(s))}}Qr(I);var E,f=!1;if(s===Xa){var m=function(e){var t={isIncome:!1,isGain:!1,isIncomeTax:!1,isNationalInsurance:!1,isNet:!1,isCGT:!1,person:""},a=e;return a.includes("income")?(t.isIncome=!0,a.includes(K)?(t.isIncomeTax=!0,a=a.substring(0,a.length-K.length-1)):a.includes("(NI)")?(t.isNationalInsurance=!0,a=a.substring(0,a.length-"(NI)".length-1)):(t.isNet=!0,a=a.substring(0,a.length-Q.length-1)),a=a.substring(0,a.length-"income".length-1)):(t.isGain=!0,a.includes(z)?(t.isCGT=!0,a=a.substring(0,a.length-z.length-1)):(t.isNet=!0,a=a.substring(0,a.length-Q.length-1)),a=a.substring(0,a.length-"gain".length-1)),t.person=a,t}(a.source),T=!1,v=!1;"All"===d?T=!0:"gain"===d?m.isGain&&(T=!0):"income"===d&&m.isIncome&&(T=!0),T&&!A&&m.isNet&&(T=!1),T&&("All"===p||m.person===p)&&(v=!0),f=T&&v}else f=t.getShowItem(n.Asset,a.name)||t.getShowItem(n.Debt,a.name);if(f)if(void 0!==(E=s===Xa?I.get("tax"):I.get("assetOrDebtFocus"))){var O=r.toDateString();E.has(O)||E.set(O,new Map);var M=E.get(O);if(void 0!==M)if(s!==Xa&&N)U.indexOf(a.name)<0&&U.push(a.name),M.set(a.name,a.value);else if(s===Xa){var R=a.source;M.set(R,a.value),U.indexOf(R)<0&&U.push(R)}else{var C=a.source+"/"+a.name,D=0,_=w.get(a.name);void 0!==_&&(D=_);var L=a.value-D,x=M.get(C);void 0!==x&&(L+=x),g&&L<0||b&&L>0||0===L||(M.set(C,L),U.indexOf(C)<0&&U.push(C)),w.set(a.name,a.value)}}}}})),Qr(I),S.shift();var F=U;if(h===V||h===P){var B=I.get("assetOrDebtFocus");if(void 0!==B){var j=$r(B,S,U,e,u);void 0!==j&&(I.set("assetOrDebtFocus",j.map),U=Object(O.a)(j.sources)),i=Object(O.a)(j.sources),c=Object(O.a)(j.sources)}if(v&&void 0!==(B=I.get(Qa))){var Y=$r(B,S,o,e,u);I.set(Qa,Y.map),o=Object(O.a)(Y.sources)}if(T&&void 0!==(B=I.get(qa))){var J=$r(B,S,s,e,u);I.set(qa,J.map),s=Object(O.a)(J.sources)}}if(!v){var Z=I.get(Qa);if(void 0!==Z){var X=es(Z,S,o,t,n.Expense);I.set(Qa,X.map)}}if(!T){var ee=I.get(qa);if(void 0!==ee){var te=es(ee,S,s,t,n.Income);I.set(qa,te.map)}}var ae=I.get("assetOrDebtFocus");if(void 0!==ae){var ne=[],re=[];ne=N&&f?i:U,!f&&N&&(ne=ne.filter((function(e){return i.includes(e)}))),re=N&&m?c:U,!m&&N&&(re=re.filter((function(e){return c.includes(e)})));var se=Xr(ne,e,t),oe=Xr(re,e,t);R.assetData=zr(ae,S,se.assetChartNames,e.settings,!1,h===P),R.debtData=zr(ae,S,oe.debtChartNames,e.settings,!0,h===P)}var ie=I.get("tax");void 0!==ie&&(Kr(ie),R.taxData=zr(ie,S,F,e.settings,!1,h===P)),Qr(I);var ce=I.get(Qa);void 0!==ce&&(R.expensesData=zr(ce,S,o,e.settings,!1,h===P));var ue=I.get(qa);return void 0!==ue&&(R.incomesData=zr(ue,S,s,e.settings,!1,h===P)),R.labels=S.map((function(e){return e.toDateString()})),R}var ns=function(e){Object(p.a)(a,e);var t=Object(A.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).defaultState=void 0,n.defaultState={NAME:"",DATE:""},n.state=n.defaultState,n.handleName=n.handleName.bind(Object(d.a)(n)),n.handleValueChange=n.handleValueChange.bind(Object(d.a)(n)),n.add=n.add.bind(Object(d.a)(n)),n.delete=n.delete.bind(Object(d.a)(n)),n}return Object(E.a)(a,[{key:"render",value:function(){return s.a.createElement("form",{className:"container-fluid",onSubmit:this.add},s.a.createElement(g.a,null,s.a.createElement(v.a,null,"Name:",s.a.createElement(yt,{type:"text",name:"triggername",value:this.state.NAME,placeholder:"Enter name",onChange:this.handleName}))," ")," ",s.a.createElement(g.a,null,s.a.createElement(v.a,null,"Date:",s.a.createElement(yt,{type:"text",name:"date",value:this.state.DATE,placeholder:"Enter date",onChange:this.handleValueChange}),Rt("Create new important date (over-writes any existing with the same name)",this.add,"addTrigger","addTrigger","primary"))," ")," ")}},{key:"handleName",value:function(e){var t=e.target.value;this.setState({NAME:t})}},{key:"handleValueChange",value:function(e){var t=e.target.value;this.setState({DATE:t})}},{key:"add",value:function(){var e=Object(T.a)(l.a.mark((function e(t){var a,n,r=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),""!==this.state.NAME){e.next=4;break}return this.props.showAlert("Name should be not empty"),e.abrupt("return");case 4:if(!oc()){e.next=9;break}if(void 0===this.props.model.triggers.find((function(e){return e.NAME===r.state.NAME}))){e.next=9;break}return this.props.showAlert("There's already a date called ".concat(this.state.NAME)),e.abrupt("return");case 9:if(a={NAME:this.state.NAME,DATE:this.state.DATE},!((n=this.props.checkFunction(a,this.props.model)).length>0)){e.next=15;break}this.props.showAlert(n),e.next=19;break;case 15:return e.next=17,this.props.submitFunction(a,this.props.model);case 17:this.setState(this.defaultState),this.props.showAlert("added important date OK");case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=Object(T.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,this.props.deleteFunction(this.state.NAME);case 3:if(!e.sent){e.next=8;break}this.setState(this.defaultState),this.props.showAlert("deleted important date"),e.next=9;break;case 8:this.props.showAlert("failed to delete ".concat(this.state.NAME));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),a}(r.Component),rs=function(e){Object(p.a)(a,e);var t=Object(A.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={selectedItem:""},n}return Object(E.a)(a,[{key:"newTriggerMade",value:function(e){this.props.submitTriggerFunction(e,this.props.model),this.setState(Object(c.a)(Object(c.a)({},this.state),{},{selectedItem:e.NAME})),this.props.handleChange(e.NAME)}},{key:"render",value:function(){var e,t,a=this,n=this.props.triggers.sort((function(e,t){return Me(e.NAME,t.NAME)})).map((function(e){return{text:e.NAME,action:function(t){t.preventDefault(),a.props.handleChange(e.NAME)}}}));n.push((e=this.newTriggerMade.bind(this),t=this.props.showAlert,{text:"Make new important date",action:function(){var a=Object(T.a)(l.a.mark((function a(n){var r,s;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(n.preventDefault(),null!==(r=prompt("Name for new important date",""))&&0!==r.length){a.next=5;break}return t("names need to have some characters"),a.abrupt("return");case 5:if(null!==(s=prompt("Important date (e.g. 1 Jan 2019)",""))&&0!==s.length){a.next=9;break}return t("date didn't make sense"),a.abrupt("return");case 9:if(Re(s).getTime()){a.next=13;break}return t("date didn't make sense"),a.abrupt("return");case 13:return a.next=15,e({NAME:r,DATE:s});case 15:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()}));var r=n.map((function(e){return s.a.createElement("option",{value:e.text,id:"option-useTrigger-".concat(e.text),key:e.text,className:"text-muted"},e.text)}));return s.a.createElement("select",{className:"custom-select",onChange:function(e){var t=n.find((function(t){return t.text===e.target.value}));void 0!==t&&t.action(e)},value:this.props.selectedItem},s.a.createElement("option",null,"Choose a date (optional)"),r)}}]),a}(r.Component);var ss=function(e){Object(p.a)(a,e);var t=Object(A.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).handleChange=n.handleChange.bind(Object(d.a)(n)),n}return Object(E.a)(a,[{key:"handleChange",value:function(e){"today"===e.target.value&&(e.target.value=(new Date).toDateString()),this.props.onChangeHandler(e)}},{key:"render",value:function(){var e=this;return s.a.createElement(g.a,null,s.a.createElement("div",{className:"col p-2 mb-2 bg-secondary text-white"},this.props.introLabel)," ",s.a.createElement(v.a,null,s.a.createElement(rs,{triggers:this.props.triggers,model:this.props.model,showAlert:this.props.showAlert,submitTriggerFunction:this.props.submitTriggerFunction,handleChange:this.props.setDateFunction,selectedItem:""})),s.a.createElement(v.a,null,s.a.createElement(lt.a,{placement:"top",overlay:function(t){return s.a.createElement(ht.a,t,"".concat(function(e){return 0===e.model.settings.length?"":et(e.inputValue,e.triggers)}(e.props)))}},s.a.createElement("input",{type:"text",name:this.props.inputName,value:this.props.inputValue,placeholder:"Enter date",onChange:this.handleChange,className:"form-control"}))))}}]),a}(r.Component);function os(e,t,a){var n=e.assets.sort((function(e,t){return Me(e.NAME,t.NAME)})).map((function(e){return{text:e.NAME,action:function(a){a.preventDefault(),t(e.NAME)}}})).concat(e.settings.filter((function(e){return"adjustable"===e.TYPE})).sort((function(e,t){return Me(e.NAME,t.NAME)})).map((function(e){return{text:e.NAME,action:function(a){a.preventDefault(),t(e.NAME)}}}))),r=n.map((function(e){return s.a.createElement("option",{value:e.text,id:"option-asset-".concat(e.text),key:e.text,className:"text-muted"},e.text)}));return s.a.createElement("select",{className:"custom-select",id:a,onChange:function(e){var t=n.find((function(t){return t.text===e.target.value}));void 0!==t&&t.action(e)}},s.a.createElement("option",null,"Choose an asset/setting"),r)}var is=function(e){Object(p.a)(a,e);var t=Object(A.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).defaultState=void 0,n.transactionFromSelectID="fromAssetSelect",n.transactionToSelectID="toAssetSelect",n.defaultState={NAME:"",CATEGORY:"",FROM:"",FROM_ABSOLUTE:"",FROM_VALUE:"",FROM_INPUT_VALUE:"",TO:"",TO_ABSOLUTE:"",TO_VALUE:"",TO_INPUT_VALUE:"",DATE:"",STOP_DATE:"",RECURRENCE:"",LIQUIDATE_FOR_CASH:"No"},n.state=n.defaultState,n.handleNameChange=n.handleNameChange.bind(Object(d.a)(n)),n.handleFromChange=n.handleFromChange.bind(Object(d.a)(n)),n.handleToChange=n.handleToChange.bind(Object(d.a)(n)),n.handleFromValueChange=n.handleFromValueChange.bind(Object(d.a)(n)),n.handleToValueChange=n.handleToValueChange.bind(Object(d.a)(n)),n.handleCategoryChange=n.handleCategoryChange.bind(Object(d.a)(n)),n.handleRecurrenceChange=n.handleRecurrenceChange.bind(Object(d.a)(n)),n.handleLiquidateForCashChange=n.handleLiquidateForCashChange.bind(Object(d.a)(n)),n.handleDateChange=n.handleDateChange.bind(Object(d.a)(n)),n.setDate=n.setDate.bind(Object(d.a)(n)),n.handleStopDateChange=n.handleStopDateChange.bind(Object(d.a)(n)),n.setStopDate=n.setStopDate.bind(Object(d.a)(n)),n.add=n.add.bind(Object(d.a)(n)),n.delete=n.delete.bind(Object(d.a)(n)),n}return Object(E.a)(a,[{key:"render",value:function(){return s.a.createElement("form",{className:"container-fluid",onSubmit:this.add},s.a.createElement(g.a,null,s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Transaction name",type:"text",name:"transactionname",value:this.state.NAME,placeholder:"Enter name",onChange:this.handleNameChange}))," "),s.a.createElement("div",{className:"container-fluid"},s.a.createElement(ss,{introLabel:"Date on which the transaction occurs",model:this.props.model,showAlert:this.props.showAlert,setDateFunction:this.setDate,inputName:"date",inputValue:this.state.DATE,onChangeHandler:this.handleDateChange,triggers:this.props.model.triggers,submitTriggerFunction:this.props.submitTriggerFunction})),s.a.createElement(g.a,null,s.a.createElement(v.a,null,s.a.createElement("label",null,"Transact from asset (optional):"))," ",s.a.createElement(v.a,null,s.a.createElement("label",null,"Transact to asset (optional):"))," "),s.a.createElement(g.a,null,s.a.createElement(v.a,null,os(this.props.model,this.handleFromChange,this.transactionFromSelectID))," ",s.a.createElement(v.a,null,os(this.props.model,this.handleToChange,this.transactionToSelectID))," "),s.a.createElement(g.a,null,s.a.createElement(v.a,null,s.a.createElement(yt,{title:"How much to reduce the value of the asset being sold (can be % of asset value)",type:"text",name:"fromValue",value:this.state.FROM_INPUT_VALUE,placeholder:"Enter value",onChange:this.handleFromValueChange}))," ",s.a.createElement(v.a,null,s.a.createElement(yt,{title:"How much to add to the value of the asset being purchased (can be % of transaction amount)",type:"text",name:"toValue",value:this.state.TO_INPUT_VALUE,placeholder:"Enter value",onChange:this.handleToValueChange}))," "),s.a.createElement(g.a,null,s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Transaction recurrence, e.g. 6m, 2y (optional)",type:"text",name:"recurrence",value:this.state.RECURRENCE,placeholder:"Enter recurrence",onChange:this.handleRecurrenceChange}))," ",s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Liquidate asset to maintain cash-flow",type:"text",name:"liquidateForCash",value:this.state.LIQUIDATE_FOR_CASH,placeholder:"Enter whether we only transact to keep cash afloat",onChange:this.handleLiquidateForCashChange}))," "),s.a.createElement("div",{className:"container-fluid"},s.a.createElement(ss,{introLabel:"Date on which any recurrence stops (optional)",model:this.props.model,showAlert:this.props.showAlert,setDateFunction:this.setStopDate,inputName:"stopDate",inputValue:this.state.STOP_DATE,onChangeHandler:this.handleStopDateChange,triggers:this.props.model.triggers,submitTriggerFunction:this.props.submitTriggerFunction})),s.a.createElement(g.a,null,s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Category (optional)",type:"text",name:"transactioncategory",value:this.state.CATEGORY,placeholder:"category",onChange:this.handleCategoryChange}))," "),Rt("Create new transaction (over-writes any existing with the same name)",this.add,"addTransaction","addTransaction","primary"))}},{key:"handleNameChange",value:function(e){var t=e.target.value;this.setState({NAME:t})}},{key:"handleFromChange",value:function(e){this.setState({FROM:e})}},{key:"handleToChange",value:function(e){this.setState({TO:e})}},{key:"handleFromValueChange",value:function(e){var t=e.target.value,a=Ge(t);this.setState({FROM_ABSOLUTE:xe(a.absolute)}),this.setState({FROM_VALUE:a.value}),this.setState({FROM_INPUT_VALUE:t})}},{key:"handleToValueChange",value:function(e){var t=e.target.value,a=Ge(t);this.setState({TO_ABSOLUTE:xe(a.absolute)}),this.setState({TO_VALUE:a.value}),this.setState({TO_INPUT_VALUE:t})}},{key:"handleCategoryChange",value:function(e){var t=e.target.value;this.setState({CATEGORY:t})}},{key:"handleRecurrenceChange",value:function(e){var t=e.target.value;this.setState({RECURRENCE:t})}},{key:"handleLiquidateForCashChange",value:function(e){var t=e.target.value;this.setState({LIQUIDATE_FOR_CASH:t})}},{key:"setDate",value:function(e){this.setState({DATE:e})}},{key:"handleDateChange",value:function(e){var t=e.target.value;this.setDate(t)}},{key:"setStopDate",value:function(e){this.setState({STOP_DATE:e})}},{key:"handleStopDateChange",value:function(e){var t=e.target.value;this.setStopDate(t)}},{key:"resetSelect",value:function(e){var t=document.getElementById(e);null!==t&&(t.selectedIndex="0")}},{key:"add",value:function(){var e=Object(T.a)(l.a.mark((function e(t){var a,n,r,s,o,i,c,u,h,E=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),""!==this.state.NAME){e.next=4;break}return this.props.showAlert("Name should be not empty"),e.abrupt("return");case 4:if(!oc()){e.next=9;break}if(void 0===this.props.model.transactions.find((function(e){return e.NAME===E.state.NAME}))){e.next=9;break}return this.props.showAlert("There's already a transaction called ".concat(this.state.NAME)),e.abrupt("return");case 9:if(a=this.state.FROM_ABSOLUTE,n=this.state.FROM_VALUE,""===this.state.FROM&&(""===a&&(a="True"),""===n&&(n="0")),r=this.state.TO_ABSOLUTE,s=this.state.TO_VALUE,""===this.state.TO&&(""===r&&(r="True"),""===s&&(s="0")),""!==a){e.next=18;break}return this.props.showAlert("From absolute should be T (absolute value) or F (relative value"),e.abrupt("return");case 18:if(""!==r){e.next=21;break}return this.props.showAlert("To absolute should be T (absolute value) or F (relative value"),e.abrupt("return");case 21:if((o=Pe(this.state.LIQUIDATE_FOR_CASH)).checksOK){e.next=25;break}return this.props.showAlert("Whether we're keeping cash afloat should be 'y' or 'n'"),e.abrupt("return");case 25:if(!o.value||"Cash"===this.state.TO){e.next=28;break}return this.props.showAlert("If we're liquidating assets to keep cash afloat, the TO asset should be CASH"),e.abrupt("return");case 28:if(i="custom",c=this.state.NAME,o.value&&(i="liquidateAsset",c="".concat(re).concat(this.state.NAME)),u={NAME:c,CATEGORY:this.state.CATEGORY,FROM:this.state.FROM,FROM_ABSOLUTE:Le(a),FROM_VALUE:n,TO:this.state.TO,TO_ABSOLUTE:Le(r),TO_VALUE:s,DATE:this.state.DATE,STOP_DATE:this.state.STOP_DATE,RECURRENCE:this.state.RECURRENCE,TYPE:i},!((h=this.props.checkFunction(u,this.props.model)).length>0)){e.next=37;break}this.props.showAlert(h),e.next=43;break;case 37:return e.next=39,this.props.submitFunction(u,this.props.model);case 39:this.props.showAlert("added new transaction"),this.setState(this.defaultState),this.resetSelect(this.transactionFromSelectID),this.resetSelect(this.transactionToSelectID);case 43:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=Object(T.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,this.props.deleteFunction(this.state.NAME);case 3:if(!e.sent){e.next=10;break}this.props.showAlert("deleted transaction"),this.setState(this.defaultState),this.resetSelect(this.transactionFromSelectID),this.resetSelect(this.transactionToSelectID),e.next=11;break;case 10:this.props.showAlert("failed to delete ".concat(this.state.NAME));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),a}(r.Component),cs=a(69),us=a.n(cs),ls=a(70),hs=a.n(ls),Es=a(71),ds=a.n(Es);function ps(){return s.a.createElement(s.a.Fragment,null,s.a.createElement("h3",null,"Get a handle on your planned expenses"),s.a.createElement("img",{src:hs.a,alt:"Sample expense graph screenshot",width:500,height:300}),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("h3",null,"See the prospects for your future financial health"),s.a.createElement("img",{src:us.a,alt:"Sample asset graph screenshot",width:500,height:300}),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("h3",null,"Check on your predicted tax payments"),s.a.createElement("img",{src:ds.a,alt:"Sample tax graph screenshot",width:500,height:300}))}var As=a(129),fs=a(72),ms=a.n(fs),Ts=a(54),vs=a.n(Ts);function gs(e,t){return Oe("drawing navbar content; isWaiting = ".concat(e)),s.a.createElement(As.a,{expand:"lg",bg:"light",sticky:"top"},s.a.createElement(As.a.Brand,{href:"#home",id:"finkitty-brand"},s.a.createElement("img",{src:e?vs.a:ms.a,alt:"FinKitty cat",width:70,height:"auto",onClick:function(){_i(ie,6)},id:"btn-Home"})),t())}function Os(e){return Object(c.a)(Object(c.a)({},e),{},{displayLegend:!1})}function bs(e,t,a,n,r,o,i,c,u,l,h,E){return s.a.createElement(wt.a,null,s.a.createElement(g.a,null,s.a.createElement(v.a,null,Qt(Os(i),Gt(0,e.settings,"Incomes"),t)),s.a.createElement(v.a,null,Zt(Os(o),Gt(0,e.settings,"Expenses"),t)),s.a.createElement(v.a,null,ea(Os(n),!1,Gt(0,e.settings,"Assets"),t))),s.a.createElement(g.a,null,s.a.createElement(v.a,null,na(Os(c),Gt(0,e.settings,"Tax"),t)),s.a.createElement(v.a,null,ea(Os(r),!0,Gt(0,e.settings,"Debts"),t)),s.a.createElement(v.a,null,s.a.createElement(It,{name:"view start date",getValue:u,submitFunction:l,showAlert:a}),s.a.createElement(It,{name:"view end date",getValue:h,submitFunction:E,showAlert:a}),jt(t),function(e){var t=[L,_],a=e.getViewSetting(D,_),n=t.map((function(t){return Rt(t,(function(a){a.persist(),Vt(e,D,t)}),t,"chooseViewFrequencyType",t===a?"secondary":"outline-secondary")}));return s.a.createElement("div",{role:"group"},n)}(t))))}function Ns(e,t,a,n,r,o,i,c,u,l,h,E){if(ni(me)){var d=0!==i.labels.length||0!==n.labels.length||0!==o.labels.length||0!==c.labels.length||0!==r.labels.length;return s.a.createElement("div",{className:"ml-3"},d?bs(e,t,a,n,r,o,i,c,u,l,h,E):s.a.createElement(s.a.Fragment,null),s.a.createElement("div",{className:d?"scrollClass resizeClass":""},s.a.createElement("br",null),Ca(e,a),ya(e,a),Na(e,a,se,"Income revaluations"),Sa(e,a),Na(e,a,oe,"Expense revaluations"),Ra(e,a),Ma(e,a),function(e,t){var a=ga(e,"custom"),n=ga(e,"auto");if(0!==a.length||0!==n.length)return s.a.createElement(s.a.Fragment,null,ba(a,e,t,"Custom transactions","Custom transactions"),ba(n,e,t,"Auto-generated transactions","Auto-generated transactions"))}(e,a),Da(e,0,a)))}}var Ms="definedBenefitsPension";function Rs(e,t,a){var n=e.incomes.map((function(e){return{text:e.NAME,action:function(a){a.preventDefault(),t(e.NAME)}}})),r=n.map((function(e){return s.a.createElement("option",{value:e.text,id:"option-income-".concat(e.text),key:e.text,className:"text-muted"},e.text)}));return s.a.createElement("select",{className:"custom-select",id:a,onChange:function(e){var t=n.find((function(t){return t.text===e.target.value}));void 0!==t&&t.action(e)}},s.a.createElement("option",null,"Choose an income"),r)}var Cs=function(e){Object(p.a)(a,e);var t=Object(A.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).defaultState=void 0,n.incomeSourceSelectID="fromIncomeSelectIncomeForm",n.defaultState={NAME:"",VALUE:"",VALUE_SET:"",START:"",END:"",GROWTH:"",GROWS_WITH_CPI:"",LIABILITY:"",CATEGORY:"",inputting:"income",DB_INCOME_SOURCE:"",DB_CONTRIBUTION_AMOUNT:"",DB_ACCRUAL:"",DB_SS:"",DB_STOP_SOURCE:"",DB_START:"",DB_END:"",DB_TRANSFER_TO:"",DB_TRANSFER_PROPORTION:"",DB_TRANSFERRED_STOP:""},n.state=n.defaultState,n.handleNameChange=n.handleNameChange.bind(Object(d.a)(n)),n.handleValueChange=n.handleValueChange.bind(Object(d.a)(n)),n.handleGrowthChange=n.handleGrowthChange.bind(Object(d.a)(n)),n.handleGrowsWithCPIChange=n.handleGrowsWithCPIChange.bind(Object(d.a)(n)),n.handleLiabilityChange=n.handleLiabilityChange.bind(Object(d.a)(n)),n.handleCategoryChange=n.handleCategoryChange.bind(Object(d.a)(n)),n.revalue=n.revalue.bind(Object(d.a)(n)),n.handleDbpIncomeSourceChange=n.handleDbpIncomeSourceChange.bind(Object(d.a)(n)),n.handleDbpSsChange=n.handleDbpSsChange.bind(Object(d.a)(n)),n.handleDbpAccrualChange=n.handleDbpAccrualChange.bind(Object(d.a)(n)),n.handleDbpTransferTo=n.handleDbpTransferTo.bind(Object(d.a)(n)),n.handleDbpContAmount=n.handleDbpContAmount.bind(Object(d.a)(n)),n.handleDbpTransferProportion=n.handleDbpTransferProportion.bind(Object(d.a)(n)),n.handleValueSetChange=n.handleValueSetChange.bind(Object(d.a)(n)),n.setValueSet=n.setValueSet.bind(Object(d.a)(n)),n.handleStartChange=n.handleStartChange.bind(Object(d.a)(n)),n.setStart=n.setStart.bind(Object(d.a)(n)),n.handleEndChange=n.handleEndChange.bind(Object(d.a)(n)),n.setEnd=n.setEnd.bind(Object(d.a)(n)),n.handleDbpStartChange=n.handleDbpStartChange.bind(Object(d.a)(n)),n.setDbpStart=n.setDbpStart.bind(Object(d.a)(n)),n.handleDbpEndChange=n.handleDbpEndChange.bind(Object(d.a)(n)),n.setDbpEnd=n.setDbpEnd.bind(Object(d.a)(n)),n.handleDbpStopSourceChange=n.handleDbpStopSourceChange.bind(Object(d.a)(n)),n.setDbpStopSource=n.setDbpStopSource.bind(Object(d.a)(n)),n.handleDbpTransferredStopChange=n.handleDbpTransferredStopChange.bind(Object(d.a)(n)),n.setDbpTransferredStop=n.setDbpTransferredStop.bind(Object(d.a)(n)),n.add=n.add.bind(Object(d.a)(n)),n.delete=n.delete.bind(Object(d.a)(n)),n.setInputincome=n.setInputincome.bind(Object(d.a)(n)),n.setInputDBP=n.setInputDBP.bind(Object(d.a)(n)),n.setInputRevalue=n.setInputRevalue.bind(Object(d.a)(n)),n}return Object(E.a)(a,[{key:"render",value:function(){return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"btn-group ml-3",role:"group"},Rt("Add new income mode",this.setInputincome,"useIncomeInputs","useIncomeInputs","income"===this.state.inputting?"primary":"outline-secondary"),Rt("Add pension mode",this.setInputDBP,"useDBPInputs","useDBPInputs",this.state.inputting===Ms?"primary":"outline-secondary"),Rt("Revalue income mode",this.setInputRevalue,"useRevalueInputsIncome","useRevalueInputsIncome","revalue"===this.state.inputting?"primary":"outline-secondary")),s.a.createElement("form",{className:"container-fluid",onSubmit:this.add},s.a.createElement(g.a,null,s.a.createElement(v.a,null,s.a.createElement(yt,{title:this.state.inputting===Ms?"Pension name":"Income name",type:"text",name:"incomename",value:this.state.NAME,placeholder:"Enter name",onChange:this.handleNameChange})),s.a.createElement(v.a,null,s.a.createElement(yt,{title:"".concat(this.state.inputting===Ms?"Pension":"income"===this.state.inputting?"Income":"New income"," value (amount before tax, per month)"),type:"text",name:"incomevalue",value:this.state.VALUE,placeholder:"Enter value",onChange:this.handleValueChange}))),s.a.createElement("div",{className:"container-fluid"},s.a.createElement(ss,{introLabel:"".concat(this.state.inputting===Ms?"Date on which the pension's value is set":"income"===this.state.inputting?"Date on which the new income's value is set":"Date on which the income's new value is set"),model:this.props.model,showAlert:this.props.showAlert,setDateFunction:this.setValueSet,inputName:"income valuation date",inputValue:this.state.VALUE_SET,onChangeHandler:this.handleValueSetChange,triggers:this.props.model.triggers,submitTriggerFunction:this.props.submitTriggerFunction})),this.inputsForGeneralIncome(),this.inputsForDefinedBenefitsPensionIncome(),this.growthsEtc(),this.revalueButton()))}},{key:"growthsEtc",value:function(){if("income"===this.state.inputting||this.state.inputting===Ms)return s.a.createElement(s.a.Fragment,null,s.a.createElement(g.a,null,s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Annual growth percentage (excluding inflation, e.g. 2 for 2% p.a.)",type:"text",name:"incomegrowth",value:this.state.GROWTH,placeholder:"Enter growth",onChange:this.handleGrowthChange}))," ",s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Does value grow with inflation?",type:"text",name:"incomecpi-grows",value:this.state.GROWS_WITH_CPI,placeholder:"Enter Y/N",onChange:this.handleGrowsWithCPIChange}))," "),s.a.createElement(g.a,null,s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Tax liability (empty or someone's name)",type:"text",name:"taxable",value:this.state.LIABILITY,placeholder:"Enter tax liability",onChange:this.handleLiabilityChange})),s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Category (optional)",type:"text",name:"incomecategory",value:this.state.CATEGORY,placeholder:"category",onChange:this.handleCategoryChange}))," "),Rt("Create new income (over-writes any existing with the same name)",this.add,"addIncome","addIncome","primary"))}},{key:"revalueButton",value:function(){if("revalue"===this.state.inputting)return Rt("Add income revaluation",this.revalue,"revalueIncome","revalueIncome","primary")}},{key:"inputsForGeneralIncome",value:function(){return s.a.createElement("div",{style:{display:"income"===this.state.inputting?"block":"none"}},s.a.createElement("div",{className:"container-fluid"},s.a.createElement(ss,{introLabel:"Date on which the income starts",model:this.props.model,showAlert:this.props.showAlert,setDateFunction:this.setStart,inputName:"income start date",inputValue:this.state.START,onChangeHandler:this.handleStartChange,triggers:this.props.model.triggers,submitTriggerFunction:this.props.submitTriggerFunction}),s.a.createElement(ss,{introLabel:"Date on which the income ends",model:this.props.model,showAlert:this.props.showAlert,setDateFunction:this.setEnd,inputName:"income end date",inputValue:this.state.END,onChangeHandler:this.handleEndChange,triggers:this.props.model.triggers,submitTriggerFunction:this.props.submitTriggerFunction})))}},{key:"inputsForDefinedBenefitsPensionIncome",value:function(){return s.a.createElement("div",{style:{display:this.state.inputting===Ms?"block":"none"}},s.a.createElement("div",{className:"container-fluid"},s.a.createElement(ss,{introLabel:"Date on which contributions end (optional)",model:this.props.model,showAlert:this.props.showAlert,setDateFunction:this.setDbpStopSource,inputName:"end date",inputValue:this.state.DB_STOP_SOURCE,onChangeHandler:this.handleDbpStopSourceChange,triggers:this.props.model.triggers,submitTriggerFunction:this.props.submitTriggerFunction}),s.a.createElement(ss,{introLabel:"Date on which the pension starts",model:this.props.model,showAlert:this.props.showAlert,setDateFunction:this.setDbpStart,inputName:"pension start date",inputValue:this.state.DB_START,onChangeHandler:this.handleDbpStartChange,triggers:this.props.model.triggers,submitTriggerFunction:this.props.submitTriggerFunction}),s.a.createElement(ss,{introLabel:"Date on which the pension ends",model:this.props.model,showAlert:this.props.showAlert,setDateFunction:this.setDbpEnd,inputName:"pension end/transfer date",inputValue:this.state.DB_END,onChangeHandler:this.handleDbpEndChange,triggers:this.props.model.triggers,submitTriggerFunction:this.props.submitTriggerFunction}),s.a.createElement(ss,{introLabel:"Date on which transferred pension stops (optional)",model:this.props.model,showAlert:this.props.showAlert,setDateFunction:this.setDbpTransferredStop,inputName:"transferred stop date",inputValue:this.state.DB_TRANSFERRED_STOP,onChangeHandler:this.handleDbpTransferredStopChange,triggers:this.props.model.triggers,submitTriggerFunction:this.props.submitTriggerFunction})),s.a.createElement(g.a,null,s.a.createElement(v.a,null,s.a.createElement("label",null,"Income source (optional)"),Rs(this.props.model,this.handleDbpIncomeSourceChange,this.incomeSourceSelectID))," ",s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Is contribution salary-sacrificed (optional)",type:"text",name:"contributionSSIncome",value:this.state.DB_SS,placeholder:"Enter Y/N",onChange:this.handleDbpSsChange}))," "),s.a.createElement(g.a,null,s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Pension contribution amount (e.g. 0.05 for 5%, optional)",type:"text",name:"contributionAmountPensionIncome",value:this.state.DB_CONTRIBUTION_AMOUNT,placeholder:"Enter amount of contributions",onChange:this.handleDbpContAmount}))," ",s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Contribution accrual to annual benefit (e.g. 0.02 for 1/50, optional)",type:"text",name:"incomeaccrual",value:this.state.DB_ACCRUAL,placeholder:"Enter accrual rate",onChange:this.handleDbpAccrualChange}))," "),s.a.createElement(g.a,null,s.a.createElement(v.a,null,s.a.createElement(yt,{title:"On death, pension transfers to (optional)",type:"text",name:"transferNameIncome",value:this.state.DB_TRANSFER_TO,placeholder:"Enter person to transfer to",onChange:this.handleDbpTransferTo})),s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Proportion transferred on death (e.g. 0.5 for 50%, optional)",type:"text",name:"transferProportion",value:this.state.DB_TRANSFER_PROPORTION,placeholder:"Enter transfer proportion",onChange:this.handleDbpTransferProportion}))," "))}},{key:"handleNameChange",value:function(e){this.setState({NAME:e.target.value})}},{key:"handleGrowthChange",value:function(e){this.setState({GROWTH:e.target.value})}},{key:"handleCategoryChange",value:function(e){this.setState({CATEGORY:e.target.value})}},{key:"handleLiabilityChange",value:function(e){this.setState({LIABILITY:e.target.value})}},{key:"handleGrowsWithCPIChange",value:function(e){this.setState({GROWS_WITH_CPI:e.target.value})}},{key:"handleValueChange",value:function(e){this.setState({VALUE:e.target.value})}},{key:"handleDbpIncomeSourceChange",value:function(e){this.setState({DB_INCOME_SOURCE:e})}},{key:"handleDbpSsChange",value:function(e){this.setState({DB_SS:e.target.value})}},{key:"handleDbpAccrualChange",value:function(e){this.setState({DB_ACCRUAL:e.target.value})}},{key:"handleDbpTransferProportion",value:function(e){this.setState({DB_TRANSFER_PROPORTION:e.target.value})}},{key:"setDbpStopSource",value:function(e){this.setState({DB_STOP_SOURCE:e})}},{key:"handleDbpStopSourceChange",value:function(e){this.setDbpStopSource(e.target.value)}},{key:"handleDbpTransferTo",value:function(e){this.setState({DB_TRANSFER_TO:e.target.value})}},{key:"handleDbpContAmount",value:function(e){this.setState({DB_CONTRIBUTION_AMOUNT:e.target.value})}},{key:"setDbpTransferredStop",value:function(e){this.setState({DB_TRANSFERRED_STOP:e})}},{key:"handleDbpTransferredStopChange",value:function(e){this.setDbpTransferredStop(e.target.value)}},{key:"setDbpEnd",value:function(e){this.setState({DB_END:e})}},{key:"handleDbpEndChange",value:function(e){this.setDbpEnd(e.target.value)}},{key:"setValueSet",value:function(e){this.setState({VALUE_SET:e})}},{key:"handleValueSetChange",value:function(e){this.setValueSet(e.target.value)}},{key:"setDbpStart",value:function(e){this.setState({DB_START:e})}},{key:"handleDbpStartChange",value:function(e){var t=e.target.value;this.setDbpStart(t)}},{key:"setStart",value:function(e){this.setState({START:e})}},{key:"handleStartChange",value:function(e){var t=e.target.value;this.setStart(t)}},{key:"setEnd",value:function(e){this.setState({END:e})}},{key:"handleEndChange",value:function(e){this.setEnd(e.target.value)}},{key:"resetSelect",value:function(e){var t=document.getElementById(e);null!==t&&(t.selectedIndex="0")}},{key:"revalue",value:function(){var e=Object(T.a)(l.a.mark((function e(t){var a,n,r,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),Ar(this.state.NAME,this.props.model)){e.next=4;break}return this.props.showAlert("Income name ".concat(this.state.NAME," should be an existing income")),e.abrupt("return");case 4:if((a=Ge(this.state.VALUE)).checksOK){e.next=8;break}return this.props.showAlert("Income value ".concat(this.state.VALUE," should be a numerical or % value")),e.abrupt("return");case 8:if(n=Ze(this.state.VALUE_SET,this.props.model.triggers),!(void 0===n)){e.next=13;break}return this.props.showAlert("Value set date should be a date"),e.abrupt("return");case 13:for(r=1;Tr("".concat("Revalue"," ").concat(this.state.NAME," ").concat(r),this.props.model);)r+=1;return s={NAME:"".concat("Revalue"," ").concat(this.state.NAME," ").concat(r),FROM:"",FROM_ABSOLUTE:!1,FROM_VALUE:"0.0",TO:this.state.NAME,TO_ABSOLUTE:a.absolute,TO_VALUE:a.value,DATE:this.state.VALUE_SET,TYPE:se,RECURRENCE:"",STOP_DATE:"",CATEGORY:""},e.next=18,this.props.checkTransactionFunction(s,this.props.model);case 18:if(!((o=e.sent).length>0)){e.next=22;break}return this.props.showAlert(o),e.abrupt("return");case 22:return e.next=24,this.props.submitTransactionFunction(s,this.props.model);case 24:return this.props.showAlert("added new data"),this.setState(this.defaultState),this.resetSelect(this.incomeSourceSelectID),e.abrupt("return");case 28:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"add",value:function(){var e=Object(T.a)(l.a.mark((function e(t){var a,n,r,s,o,i,c,u,h,E,d,p,A,f,m,T,v,g,O,b,N,M,R,C,y,S=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),Oe("in income form's add function"),""!==this.state.NAME){e.next=5;break}return this.props.showAlert("Income name should be non-empty"),e.abrupt("return");case 5:if(!oc()){e.next=10;break}if(void 0===this.props.model.incomes.find((function(e){return e.NAME===S.state.NAME}))){e.next=10;break}return this.props.showAlert("There's already an income called ".concat(this.state.NAME)),e.abrupt("return");case 10:if(!!Wn(this.state.VALUE,this.props.model)){e.next=14;break}return this.props.showAlert("Income value ".concat(this.state.VALUE," should be numerical or built from an Asset or setting")),e.abrupt("return");case 14:if(a=Ze(this.state.VALUE_SET,this.props.model.triggers),!(void 0===a)){e.next=19;break}return this.props.showAlert("Value set date should be a date"),e.abrupt("return");case 19:if((n=Fe(this.state.GROWTH,this.props.model.settings)).checksOK){e.next=23;break}return this.props.showAlert("Growth value '".concat(this.state.GROWTH,"' should be a numerical value")),e.abrupt("return");case 23:if((r=Pe(this.state.GROWS_WITH_CPI)).checksOK){e.next=27;break}return this.props.showAlert("Grows with inflation '".concat(this.state.GROWS_WITH_CPI,"' should be a Y/N value")),e.abrupt("return");case 27:if(this.state.inputting!==Ms){e.next=164;break}if(s=Pe(this.state.DB_SS),""===this.state.DB_INCOME_SOURCE){e.next=45;break}if(s.checksOK){e.next=35;break}return this.props.showAlert("Salary sacrifice '".concat(this.state.DB_SS,"' should be a Y/N value")),e.abrupt("return");case 35:if(!!Bn(this.state.DB_CONTRIBUTION_AMOUNT)){e.next=39;break}return this.props.showAlert("Contribution amount '".concat(this.state.DB_CONTRIBUTION_AMOUNT,"' should be a numerical value")),e.abrupt("return");case 39:if(!!Bn(this.state.DB_ACCRUAL)){e.next=43;break}return this.props.showAlert("Accrual value '".concat(this.state.DB_ACCRUAL,"' should be a numerical value")),e.abrupt("return");case 43:e.next=53;break;case 45:if(!Bn(this.state.DB_CONTRIBUTION_AMOUNT)){e.next=49;break}return this.props.showAlert("Contribution amount '".concat(this.state.DB_CONTRIBUTION_AMOUNT,"' from no income?")),e.abrupt("return");case 49:if(!Bn(this.state.DB_ACCRUAL)){e.next=53;break}return this.props.showAlert("Accrual value '".concat(this.state.DB_ACCRUAL,"' from no income?")),e.abrupt("return");case 53:if(o=Se(this.state.LIABILITY,!1),""===(i=Jn(o))){e.next=58;break}return this.props.showAlert(i),e.abrupt("return");case 58:if(void 0!==(c=this.props.model.incomes.find((function(e){return e.NAME===S.state.DB_INCOME_SOURCE})))||""===this.state.DB_INCOME_SOURCE){e.next=64;break}return this.props.showAlert("".concat(this.state.DB_INCOME_SOURCE," not recognised as an income")),e.abrupt("return");case 64:if(!c){e.next=80;break}if(0!==(u=c.LIABILITY).length){e.next=69;break}return this.props.showAlert("Source income '".concat(c.NAME,"' should pay income tax")),e.abrupt("return");case 69:if(h=u.split("/"),void 0!==(E=h.find((function(e){return e.endsWith(K)})))){e.next=76;break}return this.props.showAlert("Source income '".concat(c.NAME,"' should have an income tax liability")),e.abrupt("return");case 76:if(E===o){e.next=80;break}return Oe("".concat(E," !== ").concat(o)),this.props.showAlert("Source income '".concat(c.NAME,"' should have income tax liability ").concat(o)),e.abrupt("return");case 80:if(""===this.state.DB_TRANSFER_TO){e.next=90;break}if(!!Bn(this.state.DB_TRANSFER_PROPORTION)){e.next=85;break}return this.props.showAlert("Transfer proportion ".concat(this.state.DB_TRANSFER_PROPORTION," should be a numerical value")),e.abrupt("return");case 85:if(d=Se(this.state.DB_TRANSFER_TO,!1),""===(i=Jn(d))){e.next=90;break}return this.props.showAlert(i),e.abrupt("return");case 90:return p=$+this.state.NAME,A={START:this.state.DB_START,END:this.state.DB_END,NAME:p,VALUE:this.state.VALUE,VALUE_SET:this.state.VALUE_SET,LIABILITY:o,GROWTH:n.value,CPI_IMMUNE:!r.value,CATEGORY:this.state.CATEGORY},e.next=94,this.props.checkIncomeFunction(A,this.props.model);case 94:if(!((f=e.sent).length>0)){e.next=98;break}return this.props.showAlert(f),e.abrupt("return");case 98:if(""===this.state.DB_TRANSFER_TO||void 0===d){e.next=107;break}return T=ee+this.state.NAME,m={START:this.state.DB_START,END:this.state.DB_TRANSFERRED_STOP,NAME:T,VALUE:"0.0",VALUE_SET:this.state.VALUE_SET,LIABILITY:d,GROWTH:n.value,CPI_IMMUNE:!r.value,CATEGORY:this.state.CATEGORY},e.next=103,this.props.checkIncomeFunction(m,this.props.model);case 103:if(!((v=e.sent).length>0)){e.next=107;break}return this.props.showAlert(v),e.abrupt("return");case 107:return e.next=109,this.props.submitIncomeFunction(A,this.props.model);case 109:if(!m){e.next=112;break}return e.next=112,this.props.submitIncomeFunction(m,this.props.model);case 112:if(""===this.state.DB_INCOME_SOURCE){e.next=138;break}return g={NAME:(s.value?X:Z)+this.state.NAME,FROM:this.state.DB_INCOME_SOURCE,FROM_ABSOLUTE:!1,FROM_VALUE:this.state.DB_CONTRIBUTION_AMOUNT,TO:"",TO_ABSOLUTE:!1,TO_VALUE:"0.0",DATE:this.state.VALUE_SET,STOP_DATE:this.state.DB_STOP_SOURCE,RECURRENCE:"",CATEGORY:this.state.CATEGORY,TYPE:"auto"},e.next=116,this.props.checkTransactionFunction(g,this.props.model);case 116:if(!((f=e.sent).length>0)){e.next=125;break}return this.props.showAlert(f),e.next=121,this.props.deleteFunction(A.NAME);case 121:if(!m){e.next=124;break}return e.next=124,this.props.deleteFunction(m.NAME);case 124:return e.abrupt("return");case 125:return b="".concat(parseFloat(this.state.DB_ACCRUAL)/12),O={NAME:p,FROM:this.state.DB_INCOME_SOURCE,FROM_ABSOLUTE:!1,FROM_VALUE:b,TO:p,TO_ABSOLUTE:!1,TO_VALUE:"1.0",DATE:this.state.VALUE_SET,STOP_DATE:this.state.DB_STOP_SOURCE,RECURRENCE:"",CATEGORY:this.state.CATEGORY,TYPE:"auto"},e.next=129,this.props.checkTransactionFunction(O,this.props.model);case 129:if(!((f=e.sent).length>0)){e.next=138;break}return this.props.showAlert(f),e.next=134,this.props.deleteFunction(A.NAME);case 134:if(!m){e.next=137;break}return e.next=137,this.props.deleteFunction(m.NAME);case 137:return e.abrupt("return");case 138:if(""===this.state.DB_TRANSFER_TO||!T){e.next=151;break}return N={NAME:T,FROM:p,FROM_ABSOLUTE:!1,FROM_VALUE:"1.0",TO:T,TO_ABSOLUTE:!1,TO_VALUE:this.state.DB_TRANSFER_PROPORTION,DATE:this.state.DB_END,STOP_DATE:this.state.DB_TRANSFERRED_STOP,RECURRENCE:"",CATEGORY:this.state.CATEGORY,TYPE:"auto"},e.next=142,this.props.checkTransactionFunction(N,this.props.model);case 142:if(!((f=e.sent).length>0)){e.next=151;break}return this.props.showAlert(f),e.next=147,this.props.deleteFunction(A.NAME);case 147:if(!m){e.next=150;break}return e.next=150,this.props.deleteFunction(m.NAME);case 150:return e.abrupt("return");case 151:if(!g){e.next=154;break}return e.next=154,this.props.submitTransactionFunction(g,this.props.model);case 154:if(!O){e.next=157;break}return e.next=157,this.props.submitTransactionFunction(O,this.props.model);case 157:if(!N){e.next=160;break}return e.next=160,this.props.submitTransactionFunction(N,this.props.model);case 160:return this.props.showAlert("added new data"),this.setState(this.defaultState),this.resetSelect(this.incomeSourceSelectID),e.abrupt("return");case 164:if(a=Ze(this.state.START,this.props.model.triggers),!(void 0===a)){e.next=169;break}return this.props.showAlert("Start date '".concat(this.state.START,"' should be a date")),e.abrupt("return");case 169:if(a=Ze(this.state.END,this.props.model.triggers),!(void 0===a)){e.next=174;break}return this.props.showAlert("End date '".concat(this.state.END,"' should be a date")),e.abrupt("return");case 174:if(M=Se(this.state.LIABILITY,!0),""===(R=Jn(M))){e.next=179;break}return this.props.showAlert(R),e.abrupt("return");case 179:return C={NAME:this.state.NAME,VALUE:this.state.VALUE,VALUE_SET:this.state.VALUE_SET,START:this.state.START,END:this.state.END,GROWTH:n.value,CPI_IMMUNE:!r.value,LIABILITY:M,CATEGORY:this.state.CATEGORY},e.next=182,this.props.checkIncomeFunction(C,this.props.model);case 182:if(!((y=e.sent).length>0)){e.next=187;break}this.props.showAlert(y),e.next=193;break;case 187:return e.next=189,this.props.submitIncomeFunction(C,this.props.model);case 189:if(!e.sent){e.next=193;break}this.props.showAlert("added new income ".concat(C.NAME)),this.setState(this.defaultState),this.resetSelect(this.incomeSourceSelectID);case 193:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=Object(T.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,this.props.deleteFunction(this.state.NAME);case 3:if(!e.sent){e.next=8;break}this.props.showAlert("deleted income"),this.setState(this.defaultState),e.next=9;break;case 8:this.props.showAlert("failed to delete ".concat(this.state.NAME));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setInputDBP",value:function(e){e.preventDefault(),this.setState(Object(c.a)(Object(c.a)({},this.state),{},{inputting:Ms}))}},{key:"setInputincome",value:function(e){e.preventDefault(),this.setState(Object(c.a)(Object(c.a)({},this.state),{},{inputting:"income"}))}},{key:"setInputRevalue",value:function(e){e.preventDefault(),this.setState(Object(c.a)(Object(c.a)({},this.state),{},{inputting:"revalue"}))}}]),a}(r.Component);function ys(e,t,a){var n=a.get(e);void 0===n?a.set(e,Object(c.a)({},t)):n.incomeVal+=t.incomeVal}function Ss(e,t){return s.a.createElement(At,{deleteFunction:void 0,handleGridRowsUpdated:function(){return!1},rows:fa(Array.from(e.entries()).filter((function(e){return 0!==e[1].incomeVal})).map((function(e){return{NAME:e[0],VALUE:"".concat(e[1].incomeVal),CATEGORY:"".concat(e[1].category)}})).sort((function(e,t){return Me(t.NAME,e.NAME)}))),columns:[Object(c.a)(Object(c.a)({},pa),{},{key:"NAME",name:"name",formatter:s.a.createElement(mt,{name:"name",value:"unset"}),editable:!1}),Object(c.a)(Object(c.a)({},pa),{},{key:"VALUE",name:"value",formatter:s.a.createElement(Et,{name:"value",value:"unset"}),editable:!1}),Object(c.a)(Object(c.a)({},pa),{},{key:"CATEGORY",name:"category",formatter:s.a.createElement(mt,{name:"name",value:"unset"}),editable:!1})],triggers:t.triggers})}function Is(e,t){if(0!==t.size){for(var a=new Map,n=0,r=Array.from(t.entries());n<r.length;n++){var o=r[n];if(""===o[1].category)ys(o[0],o[1],a);else ys(o[1].category,o[1],a)}var i=hr(e);return s.a.createElement(s.a.Fragment,null,oa(Ss(t,e),"Income values at ".concat(i.toDateString())),oa(Ss(a,e),"Income values (categorised) at ".concat(i.toDateString())))}}var Us=function(e){Object(p.a)(a,e);var t=Object(A.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).defaultState=void 0,n.defaultState={NAME:"",VALUE:"",VALUE_SET:"",START:"",END:"",GROWTH:"",GROWS_WITH_CPI:"",CATEGORY:"",RECURRENCE:"",inputting:"expense"},n.state=n.defaultState,n.handleNameChange=n.handleNameChange.bind(Object(d.a)(n)),n.handleValueChange=n.handleValueChange.bind(Object(d.a)(n)),n.handleGrowthChange=n.handleGrowthChange.bind(Object(d.a)(n)),n.handleGrowsWithCPIChange=n.handleGrowsWithCPIChange.bind(Object(d.a)(n)),n.handleCategoryChange=n.handleCategoryChange.bind(Object(d.a)(n)),n.handleRecurrenceChange=n.handleRecurrenceChange.bind(Object(d.a)(n)),n.setInputRevalue=n.setInputRevalue.bind(Object(d.a)(n)),n.setInputExpense=n.setInputExpense.bind(Object(d.a)(n)),n.twoExtraDates=n.twoExtraDates.bind(Object(d.a)(n)),n.newExpenseForm=n.newExpenseForm.bind(Object(d.a)(n)),n.revalue=n.revalue.bind(Object(d.a)(n)),n.handleValueSetChange=n.handleValueSetChange.bind(Object(d.a)(n)),n.setValueSet=n.setValueSet.bind(Object(d.a)(n)),n.handleStartChange=n.handleStartChange.bind(Object(d.a)(n)),n.setStart=n.setStart.bind(Object(d.a)(n)),n.handleEndChange=n.handleEndChange.bind(Object(d.a)(n)),n.setEnd=n.setEnd.bind(Object(d.a)(n)),n.add=n.add.bind(Object(d.a)(n)),n.delete=n.delete.bind(Object(d.a)(n)),n}return Object(E.a)(a,[{key:"newExpenseForm",value:function(){if("expense"===this.state.inputting)return s.a.createElement(s.a.Fragment,null,s.a.createElement(g.a,null,s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Annual growth percentage (excluding inflation, e.g. 2 for 2% p.a.)",type:"text",name:"expensegrowth",value:this.state.GROWTH,placeholder:"Enter growth",onChange:this.handleGrowthChange}))," ",s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Does value grow with inflation?",type:"text",name:"expensecpi-grows",value:this.state.GROWS_WITH_CPI,placeholder:"Enter Y/N",onChange:this.handleGrowsWithCPIChange}))," "),s.a.createElement(g.a,null,s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Recurrence",type:"text",name:"expenserecurrence",value:this.state.RECURRENCE,placeholder:"recurrence",onChange:this.handleRecurrenceChange}))," ",s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Category (optional)",type:"text",name:"expensecategory",value:this.state.CATEGORY,placeholder:"category",onChange:this.handleCategoryChange}))," "))}},{key:"twoExtraDates",value:function(){if("expense"===this.state.inputting)return s.a.createElement(s.a.Fragment,null,s.a.createElement(ss,{introLabel:"Date on which the expense starts",model:this.props.model,showAlert:this.props.showAlert,setDateFunction:this.setStart,inputName:"start date",inputValue:this.state.START,onChangeHandler:this.handleStartChange,triggers:this.props.model.triggers,submitTriggerFunction:this.props.submitTriggerFunction}),s.a.createElement(ss,{introLabel:"Date on which the expense ends",model:this.props.model,showAlert:this.props.showAlert,setDateFunction:this.setEnd,inputName:"end date",inputValue:this.state.END,onChangeHandler:this.handleEndChange,triggers:this.props.model.triggers,submitTriggerFunction:this.props.submitTriggerFunction}))}},{key:"goButton",value:function(){return"expense"===this.state.inputting?Rt("Create new expense (over-writes any existing with the same name)",this.add,"addExpense","addExpense","primary"):Rt("Revalue an expense",this.revalue,"revalueExpense","revalueExpense","primary")}},{key:"render",value:function(){return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"btn-group ml-3",role:"group"},Rt("Add new expense mode",this.setInputExpense,"useExpenseInputs","useExpenseInputs","expense"===this.state.inputting?"primary":"outline-secondary"),Rt("Revalue expense mode",this.setInputRevalue,"useRevalueInputsExpense","useRevalueInputsExpense","revalue"===this.state.inputting?"primary":"outline-secondary")),s.a.createElement("form",{className:"container-fluid",onSubmit:this.add},s.a.createElement(g.a,null,s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Expense name",type:"text",name:"expensename",value:this.state.NAME,placeholder:"Enter name",onChange:this.handleNameChange})),s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Expense value",type:"text",name:"expensevalue",value:this.state.VALUE,placeholder:"Enter value",onChange:this.handleValueChange}))," "),s.a.createElement("div",{className:"container-fluid"},s.a.createElement(ss,{introLabel:"Date on which the expense value is set",model:this.props.model,showAlert:this.props.showAlert,setDateFunction:this.setValueSet,inputName:"expense valuation date",inputValue:this.state.VALUE_SET,onChangeHandler:this.handleValueSetChange,triggers:this.props.model.triggers,submitTriggerFunction:this.props.submitTriggerFunction}),this.twoExtraDates()),this.newExpenseForm(),this.goButton()))}},{key:"handleNameChange",value:function(e){var t=e.target.value;this.setState({NAME:t})}},{key:"handleGrowthChange",value:function(e){var t=e.target.value;this.setState({GROWTH:t})}},{key:"handleRecurrenceChange",value:function(e){var t=e.target.value;this.setState({RECURRENCE:t})}},{key:"handleCategoryChange",value:function(e){var t=e.target.value;this.setState({CATEGORY:t})}},{key:"handleGrowsWithCPIChange",value:function(e){var t=e.target.value;this.setState({GROWS_WITH_CPI:t})}},{key:"handleValueChange",value:function(e){var t=e.target.value;this.setState({VALUE:t})}},{key:"setInputRevalue",value:function(e){e.preventDefault(),this.setState(Object(c.a)(Object(c.a)({},this.state),{},{inputting:"revalue"}))}},{key:"setInputExpense",value:function(e){e.preventDefault(),this.setState(Object(c.a)(Object(c.a)({},this.state),{},{inputting:"expense"}))}},{key:"setValueSet",value:function(e){this.setState({VALUE_SET:e})}},{key:"handleValueSetChange",value:function(e){var t=e.target.value;this.setValueSet(t)}},{key:"setStart",value:function(e){this.setState({START:e})}},{key:"handleStartChange",value:function(e){var t=e.target.value;this.setStart(t)}},{key:"setEnd",value:function(e){this.setState({END:e})}},{key:"handleEndChange",value:function(e){var t=e.target.value;this.setEnd(t)}},{key:"revalue",value:function(){var e=Object(T.a)(l.a.mark((function e(t){var a,n,r,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),(a=Ge(this.state.VALUE)).checksOK){e.next=5;break}return this.props.showAlert("Expense value ".concat(this.state.VALUE," should be a numerical or % value")),e.abrupt("return");case 5:if(n=Ze(this.state.VALUE_SET,this.props.model.triggers),!(void 0===n)){e.next=10;break}return this.props.showAlert("Value set date should be a date"),e.abrupt("return");case 10:for(r=1;Tr("".concat("Revalue"," ").concat(this.state.NAME," ").concat(r),this.props.model);)r+=1;return s={NAME:"".concat("Revalue"," ").concat(this.state.NAME," ").concat(r),FROM:"",FROM_ABSOLUTE:!1,FROM_VALUE:"0.0",TO:this.state.NAME,TO_ABSOLUTE:a.absolute,TO_VALUE:a.value,DATE:this.state.VALUE_SET,TYPE:oe,RECURRENCE:"",STOP_DATE:"",CATEGORY:""},e.next=15,this.props.checkTransactionFunction(s,this.props.model);case 15:if(!((o=e.sent).length>0)){e.next=19;break}return this.props.showAlert(o),e.abrupt("return");case 19:return e.next=21,this.props.submitTransactionFunction(s,this.props.model);case 21:return this.props.showAlert("added new data"),this.setState(this.defaultState),e.abrupt("return");case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"add",value:function(){var e=Object(T.a)(l.a.mark((function e(t){var a,n,r,s,o,i=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),""!==this.state.NAME){e.next=4;break}return this.props.showAlert("Name should be not empty"),e.abrupt("return");case 4:if(!oc()){e.next=9;break}if(void 0===this.props.model.expenses.find((function(e){return e.NAME===i.state.NAME}))){e.next=9;break}return this.props.showAlert("There's already an expense called ".concat(this.state.NAME)),e.abrupt("return");case 9:if(!!Bn(this.state.VALUE)){e.next=13;break}return this.props.showAlert("Expense value ".concat(this.state.VALUE," should be a numerical value")),e.abrupt("return");case 13:if(a=Ze(this.state.START,this.props.model.triggers),!(void 0===a)){e.next=18;break}return this.props.showAlert("Start date '".concat(this.state.START,"' should be a date")),e.abrupt("return");case 18:if(a=Ze(this.state.END,this.props.model.triggers),!(void 0===a)){e.next=23;break}return this.props.showAlert("End date '".concat(this.state.END,"' should be a date")),e.abrupt("return");case 23:if(a=Ze(this.state.VALUE_SET,this.props.model.triggers),!(void 0===a)){e.next=28;break}return this.props.showAlert("Value set date should be a date"),e.abrupt("return");case 28:if((n=Fe(this.state.GROWTH,this.props.model.settings)).checksOK){e.next=32;break}return this.props.showAlert("Growth value '".concat(this.state.GROWTH,"' should be a numerical value")),e.abrupt("return");case 32:if((r=Pe(this.state.GROWS_WITH_CPI)).checksOK){e.next=36;break}return this.props.showAlert("Grows with inflation '".concat(this.state.GROWS_WITH_CPI,"' should be a Y/N value")),e.abrupt("return");case 36:if(s={NAME:this.state.NAME,VALUE:this.state.VALUE,VALUE_SET:this.state.VALUE_SET,START:this.state.START,END:this.state.END,GROWTH:n.value,CPI_IMMUNE:!r.value,CATEGORY:this.state.CATEGORY,RECURRENCE:this.state.RECURRENCE},!((o=this.props.checkFunction(s,this.props.model)).length>0)){e.next=42;break}this.props.showAlert(o),e.next=46;break;case 42:return e.next=44,this.props.submitFunction(s,this.props.model);case 44:this.props.showAlert("added new expense"),this.setState(this.defaultState);case 46:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=Object(T.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,this.props.deleteFunction(this.state.NAME);case 3:if(!e.sent){e.next=8;break}this.props.showAlert("deleted expense"),this.setState(this.defaultState),e.next=9;break;case 8:this.props.showAlert("failed to delete ".concat(this.state.NAME));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),a}(r.Component);function ws(e,t,a){var n=a.get(e);void 0===n?a.set(e,Object(c.a)({},t)):n.expenseVal+=t.expenseVal}function Ds(e,t){return s.a.createElement(At,{deleteFunction:void 0,handleGridRowsUpdated:function(){return!1},rows:fa(Array.from(e.entries()).filter((function(e){return 0!==e[1].expenseVal})).map((function(e){return{NAME:e[0],VALUE:"".concat(e[1].expenseVal),FREQ:"".concat(e[1].expenseFreq),CATEGORY:"".concat(e[1].category)}}))).sort((function(e,t){return Me(e.NAME,t.NAME)})),columns:[Object(c.a)(Object(c.a)({},pa),{},{key:"NAME",name:"name",formatter:s.a.createElement(mt,{name:"name",value:"unset"}),editable:!1}),Object(c.a)(Object(c.a)({},pa),{},{key:"VALUE",name:"value",formatter:s.a.createElement(Et,{name:"value",value:"unset"}),editable:!1}),Object(c.a)(Object(c.a)({},pa),{},{key:"FREQ",name:"frequency",formatter:s.a.createElement(mt,{name:"frequency",value:"unset"}),editable:!1}),Object(c.a)(Object(c.a)({},pa),{},{key:"CATEGORY",name:"category",formatter:s.a.createElement(mt,{name:"name",value:"unset"}),editable:!1})],triggers:t.triggers})}function _s(e,t){if(0!==t.size){for(var a=new Map,n=0,r=Array.from(t.entries());n<r.length;n++){var o=r[n];if(""===o[1].category)ws(o[0],o[1],a);else{var i=o[1].category;ws("".concat(i).concat(o[1].expenseFreq),o[1],a)}}var c=hr(e);return s.a.createElement(s.a.Fragment,null,oa(Ds(t,e),"Expense values at ".concat(c.toDateString())),oa(Ds(a,e),"Expense values (categorised) at ".concat(c.toDateString())))}}var Ls=function(e){Object(p.a)(a,e);var t=Object(A.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).defaultState=void 0,n.incomeSourceSelectID="fromIncomeSelectAssetForm",n.defaultState={NAME:"",VALUE:"",QUANTITY:"",START:"",GROWTH:"",GROWS_WITH_INFLATION:"",PURCHASE_PRICE:"",LIABILITY:"",CATEGORY:"",inputting:"asset",DCP_STOP:"",DCP_CRYSTALLIZE:"",DCP_SS:"",DCP_INCOME_SOURCE:"",DCP_CONTRIBUTION_AMOUNT:"",DCP_EMP_CONTRIBUTION_AMOUNT:"",DCP_TRANSFER_TO:"",DCP_TRANSFER_DATE:""},n.state=n.defaultState,n.handleNameChange=n.handleNameChange.bind(Object(d.a)(n)),n.handleValueChange=n.handleValueChange.bind(Object(d.a)(n)),n.handleQuantityChange=n.handleQuantityChange.bind(Object(d.a)(n)),n.handleGrowthChange=n.handleGrowthChange.bind(Object(d.a)(n)),n.handleLiabilityChange=n.handleLiabilityChange.bind(Object(d.a)(n)),n.handleCategoryChange=n.handleCategoryChange.bind(Object(d.a)(n)),n.handlePurchasePriceChange=n.handlePurchasePriceChange.bind(Object(d.a)(n)),n.handleGrowsWithCPIChange=n.handleGrowsWithCPIChange.bind(Object(d.a)(n)),n.handleStartChange=n.handleStartChange.bind(Object(d.a)(n)),n.handleDcpTransferTo=n.handleDcpTransferTo.bind(Object(d.a)(n)),n.setDcpTransferDate=n.setDcpTransferDate.bind(Object(d.a)(n)),n.handleDcpTransferDateChange=n.handleDcpTransferDateChange.bind(Object(d.a)(n)),n.setStart=n.setStart.bind(Object(d.a)(n)),n.inputPension=n.inputPension.bind(Object(d.a)(n)),n.inputAsset=n.inputAsset.bind(Object(d.a)(n)),n.inputRevalue=n.inputRevalue.bind(Object(d.a)(n)),n.setStop=n.setStop.bind(Object(d.a)(n)),n.handleStopChange=n.handleStopChange.bind(Object(d.a)(n)),n.setCrystallize=n.setCrystallize.bind(Object(d.a)(n)),n.handleCrystallizeChange=n.handleCrystallizeChange.bind(Object(d.a)(n)),n.handleDcpIncomeSourceChange=n.handleDcpIncomeSourceChange.bind(Object(d.a)(n)),n.handleDcpContAmount=n.handleDcpContAmount.bind(Object(d.a)(n)),n.handleDcpEmpContAmount=n.handleDcpEmpContAmount.bind(Object(d.a)(n)),n.handleDcpSsChange=n.handleDcpSsChange.bind(Object(d.a)(n)),n.add=n.add.bind(Object(d.a)(n)),n.addFromButton=n.addFromButton.bind(Object(d.a)(n)),n.addFromForm=n.addFromForm.bind(Object(d.a)(n)),n.delete=n.delete.bind(Object(d.a)(n)),n.goButtons=n.goButtons.bind(Object(d.a)(n)),n.revalue=n.revalue.bind(Object(d.a)(n)),n.ValueQuantityAndCategory=n.ValueQuantityAndCategory.bind(Object(d.a)(n)),n.growthAndInflation=n.growthAndInflation.bind(Object(d.a)(n)),n}return Object(E.a)(a,[{key:"inputsForGeneralAsset",value:function(){return s.a.createElement("div",{style:{display:"asset"===this.state.inputting?"block":"none"}},s.a.createElement(g.a,null,s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Capital Gains Tax Liability (empty or someone's name)",type:"text",name:"liabilityCGT",value:this.state.LIABILITY,placeholder:"Enter liability",onChange:this.handleLiabilityChange})),s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Original purchase price (optional, needed for CGT purposes)",type:"text",name:"purchase",value:this.state.PURCHASE_PRICE,placeholder:"purchase",onChange:this.handlePurchasePriceChange}))))}},{key:"growthAndInflation",value:function(){if("revalue"!==this.state.inputting)return s.a.createElement(g.a,null,s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Annual growth percentage (excluding inflation, e.g. 2 for 2% p.a.)",type:"text",name:"assetgrowth",value:this.state.GROWTH,placeholder:"Enter growth",onChange:this.handleGrowthChange})),s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Does value grow with inflation?",type:"text",name:"assetcpi-grows",value:this.state.GROWS_WITH_INFLATION,placeholder:"Enter Y/N",onChange:this.handleGrowsWithCPIChange})))}},{key:"ValueQuantityAndCategory",value:function(){return"revalue"===this.state.inputting?s.a.createElement(g.a,null,s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Asset".concat(" name"),type:"text",name:"assetname",value:this.state.NAME,placeholder:"Enter name",onChange:this.handleNameChange})),s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Asset value",type:"text",name:"assetvalue",value:this.state.VALUE,placeholder:"Enter value",onChange:this.handleValueChange}))):"definedContributionsPension"===this.state.inputting?s.a.createElement(g.a,null,s.a.createElement(v.a,null,s.a.createElement(yt,{title:"".concat("definedContributionsPension"===this.state.inputting?"Pension":"Asset"," name"),type:"text",name:"assetname",value:this.state.NAME,placeholder:"Enter name",onChange:this.handleNameChange})),s.a.createElement(v.a,null,s.a.createElement(yt,{title:"".concat("definedContributionsPension"===this.state.inputting?"Pension":"Asset"," value"),type:"text",name:"assetvalue",value:this.state.VALUE,placeholder:"Enter value",onChange:this.handleValueChange})),s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Category (optional)",type:"text",name:"assetcategory",value:this.state.CATEGORY,placeholder:"category",onChange:this.handleCategoryChange}))):s.a.createElement(g.a,null,s.a.createElement(v.a,null,s.a.createElement(yt,{title:"".concat("definedContributionsPension"===this.state.inputting?"Pension":"Asset"," name"),type:"text",name:"assetname",value:this.state.NAME,placeholder:"Enter name",onChange:this.handleNameChange})),s.a.createElement(v.a,null,s.a.createElement(yt,{title:"".concat("definedContributionsPension"===this.state.inputting?"Pension":"Asset"," value"),type:"text",name:"assetvalue",value:this.state.VALUE,placeholder:"Enter value",onChange:this.handleValueChange})),s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Quantity (optional)",type:"text",name:"assetquantity",value:this.state.QUANTITY,placeholder:"Enter quantity",onChange:this.handleQuantityChange})),s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Category (optional)",type:"text",name:"assetcategory",value:this.state.CATEGORY,placeholder:"category",onChange:this.handleCategoryChange})))}},{key:"goButtons",value:function(){return"asset"===this.state.inputting?Rt("Create new asset (over-writes any existing with the same name)",this.addFromButton,"addAsset","addAsset","primary"):"revalue"===this.state.inputting?Rt("Revalue this asset",this.revalue,"revalueAsset","revalueAsset","primary"):"definedContributionsPension"===this.state.inputting?Rt("Create new pension",this.addFromButton,"addPension","addPension","primary"):void 0}},{key:"inputsForDCP",value:function(){return s.a.createElement("div",{style:{display:"definedContributionsPension"===this.state.inputting?"block":"none"}},s.a.createElement("div",{className:"container-fluid"},s.a.createElement(ss,{introLabel:"Stop date for contributions",model:this.props.model,showAlert:this.props.showAlert,setDateFunction:this.setStop,inputName:"stop date",inputValue:this.state.DCP_STOP,onChangeHandler:this.handleStopChange,triggers:this.props.model.triggers,submitTriggerFunction:this.props.submitTriggerFunction})),s.a.createElement("div",{className:"container-fluid"},s.a.createElement(ss,{introLabel:"Date on which the pension crystallizes",model:this.props.model,showAlert:this.props.showAlert,setDateFunction:this.setCrystallize,inputName:"crystallize date",inputValue:this.state.DCP_CRYSTALLIZE,onChangeHandler:this.handleCrystallizeChange,triggers:this.props.model.triggers,submitTriggerFunction:this.props.submitTriggerFunction})),s.a.createElement("div",{className:"container-fluid"},"definedContributionsPension"===this.state.inputting?s.a.createElement(ss,{introLabel:"On death, pension transfers to (optional)",model:this.props.model,showAlert:this.props.showAlert,setDateFunction:this.setDcpTransferDate,inputName:"transferred stop date",inputValue:this.state.DCP_TRANSFER_DATE,onChangeHandler:this.handleDcpTransferDateChange,triggers:this.props.model.triggers,submitTriggerFunction:this.props.submitTriggerFunction}):s.a.createElement("div",null)),s.a.createElement(g.a,null,s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Is contribution salary-sacrificed",type:"text",name:"contributionSSAsset",value:this.state.DCP_SS,placeholder:"Enter Y/N",onChange:this.handleDcpSsChange}))," ",s.a.createElement(v.a,null,s.a.createElement("label",null,"Income from which pension contributions are made"),Rs(this.props.model,this.handleDcpIncomeSourceChange,this.incomeSourceSelectID))," ")," ",s.a.createElement(g.a,null,s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Pension contribution amount (>0, e.g. 0.05 for 5%)",type:"text",name:"contributionAmountPensionAsset",value:this.state.DCP_CONTRIBUTION_AMOUNT,placeholder:"Enter amount of contributions",onChange:this.handleDcpContAmount}))," ",s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Employer contribution amount (e.g. 0.05 for 5%)",type:"text",name:"contributionAmount",value:this.state.DCP_EMP_CONTRIBUTION_AMOUNT,placeholder:"Employer contributions",onChange:this.handleDcpEmpContAmount}))," ")," ",s.a.createElement(g.a,null,s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Income Tax Liability (someone's name)",type:"text",name:"liabilityIC",value:this.state.LIABILITY,placeholder:"Enter liability",onChange:this.handleLiabilityChange})),s.a.createElement(v.a,null,s.a.createElement(yt,{title:"On death, pension transfers to (optional)",type:"text",name:"transferNameAsset",value:this.state.DCP_TRANSFER_TO,placeholder:"Enter person to transfer to",onChange:this.handleDcpTransferTo}))))}},{key:"render",value:function(){return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"btn-group ml-3",role:"group"},Rt("Add new asset mode",this.inputAsset,"inputAsset","inputAsset","asset"===this.state.inputting?"primary":"outline-secondary"),Rt("Add pension mode",this.inputPension,"useDCPInputs","useDCPInputs","definedContributionsPension"===this.state.inputting?"primary":"outline-secondary"),Rt("Revalue asset mode",this.inputRevalue,"revalueAssetInputs","revalueAssetInputs","revalue"===this.state.inputting?"primary":"outline-secondary")),s.a.createElement("form",{className:"container-fluid",onSubmit:this.addFromForm},this.ValueQuantityAndCategory(),s.a.createElement("div",{className:"container-fluid"},s.a.createElement(ss,{introLabel:"Date on which the ".concat("revalue"===this.state.inputting?"revaluation occurs":"definedContributionsPension"===this.state.inputting?"pension asset begins":"asset starts"),model:this.props.model,showAlert:this.props.showAlert,setDateFunction:this.setStart,inputName:"start date",inputValue:this.state.START,onChangeHandler:this.handleStartChange,triggers:this.props.model.triggers,submitTriggerFunction:this.props.submitTriggerFunction})),this.growthAndInflation(),this.inputsForGeneralAsset(),this.inputsForDCP(),this.goButtons()))}},{key:"handleNameChange",value:function(e){var t=e.target.value;this.setState({NAME:t})}},{key:"handleGrowthChange",value:function(e){var t=e.target.value;this.setState({GROWTH:t})}},{key:"handleCategoryChange",value:function(e){var t=e.target.value;this.setState({CATEGORY:t})}},{key:"handlePurchasePriceChange",value:function(e){var t=e.target.value;this.setState({PURCHASE_PRICE:t})}},{key:"handleLiabilityChange",value:function(e){var t=e.target.value;this.setState({LIABILITY:t})}},{key:"handleValueChange",value:function(e){var t=e.target.value;this.setState({VALUE:t})}},{key:"handleQuantityChange",value:function(e){var t=e.target.value;this.setState({QUANTITY:t})}},{key:"handleGrowsWithCPIChange",value:function(e){var t=e.target.value;this.setState({GROWS_WITH_INFLATION:t})}},{key:"setStart",value:function(e){this.setState({START:e})}},{key:"handleStartChange",value:function(e){var t=e.target.value;this.setStart(t)}},{key:"setStop",value:function(e){this.setState({DCP_STOP:e})}},{key:"handleStopChange",value:function(e){var t=e.target.value;this.setStop(t)}},{key:"setCrystallize",value:function(e){this.setState({DCP_CRYSTALLIZE:e})}},{key:"handleCrystallizeChange",value:function(e){var t=e.target.value;this.setCrystallize(t)}},{key:"handleDcpSsChange",value:function(e){var t=e.target.value;this.setState({DCP_SS:t})}},{key:"handleDcpIncomeSourceChange",value:function(e){this.setState({DCP_INCOME_SOURCE:e})}},{key:"handleDcpContAmount",value:function(e){var t=e.target.value;this.setState({DCP_CONTRIBUTION_AMOUNT:t})}},{key:"handleDcpEmpContAmount",value:function(e){var t=e.target.value;this.setState({DCP_EMP_CONTRIBUTION_AMOUNT:t})}},{key:"handleDcpTransferTo",value:function(e){this.setState({DCP_TRANSFER_TO:e.target.value})}},{key:"setDcpTransferDate",value:function(e){this.setState({DCP_TRANSFER_DATE:e})}},{key:"handleDcpTransferDateChange",value:function(e){this.setDcpTransferDate(e.target.value)}},{key:"revalue",value:function(){var e=Object(T.a)(l.a.mark((function e(t){var a,n,r,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),(a=Ge(this.state.VALUE)).checksOK){e.next=5;break}return this.props.showAlert("Income value ".concat(this.state.VALUE," should be a numerical or % value")),e.abrupt("return");case 5:if(n=Ze(this.state.START,this.props.model.triggers),!(void 0===n)){e.next=10;break}return this.props.showAlert("Value set date should be a date"),e.abrupt("return");case 10:for(r=1;Tr("".concat("Revalue"," ").concat(this.state.NAME," ").concat(r),this.props.model);)r+=1;if(s={NAME:"".concat("Revalue"," ").concat(this.state.NAME," ").concat(r),FROM:"",FROM_ABSOLUTE:!1,FROM_VALUE:"0.0",TO:this.state.NAME,TO_ABSOLUTE:a.absolute,TO_VALUE:a.value,DATE:this.state.START,TYPE:"revalueAsset",RECURRENCE:"",STOP_DATE:"",CATEGORY:""},!((o=this.props.checkTransactionFunction(s,this.props.model)).length>0)){e.next=17;break}return this.props.showAlert(o),e.abrupt("return");case 17:return e.next=19,this.props.submitTransactionFunction(s,this.props.model);case 19:return this.props.showAlert("added new data"),this.setState(this.defaultState),this.resetSelect(this.incomeSourceSelectID),e.abrupt("return");case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addFromForm",value:function(){var e=Object(T.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),this.add();case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addFromButton",value:function(){var e=Object(T.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),this.add();case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"add",value:function(){var e=Object(T.a)(l.a.mark((function e(){var t,a,n,r,s,o,i,c,u,h,E,d,p,A,f,m,T,v,g,O,b,N,M,R,C,y,S,I=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==this.state.NAME){e.next=3;break}return this.props.showAlert("Name should be not empty"),e.abrupt("return");case 3:if(!oc()){e.next=8;break}if(void 0===(t=this.props.model.assets.find((function(e){return e.NAME===I.state.NAME})))){e.next=8;break}return t.IS_A_DEBT?this.props.showAlert("There's already a debt called ".concat(this.state.NAME)):this.props.showAlert("There's already an asset called ".concat(this.state.NAME)),e.abrupt("return");case 8:if(!!Wn(this.state.VALUE,this.props.model)){e.next=12;break}return this.props.showAlert("Asset value ".concat(this.state.VALUE," should be a numerical value or built from a setting")),e.abrupt("return");case 12:if(a=Ze(this.state.START,this.props.model.triggers),!(void 0===a)){e.next=17;break}return this.props.showAlert("Start date '".concat(this.state.START,"' should be a date")),e.abrupt("return");case 17:if(!!Bn(this.state.GROWTH)){e.next=23;break}if(""!==ur(this.props.model.settings,this.state.GROWTH,"",!1)){e.next=23;break}return this.props.showAlert("Growth value '".concat(this.state.GROWTH,"' should be a numerical or setting value")),e.abrupt("return");case 23:if("definedContributionsPension"!==this.state.inputting){e.next=144;break}if(n=Z+this.state.NAME,r=ae+this.state.NAME,s=q+this.state.LIABILITY+"."+this.state.NAME,o=q+this.state.DCP_TRANSFER_TO+"."+this.state.NAME,i={NAME:n,VALUE:this.state.VALUE,QUANTITY:"",START:this.state.START,GROWTH:this.state.GROWTH,CPI_IMMUNE:!1,CAN_BE_NEGATIVE:!1,IS_A_DEBT:!1,CATEGORY:this.state.CATEGORY,PURCHASE_PRICE:"0.0",LIABILITY:""},!((c=this.props.checkAssetFunction(i,this.props.model)).length>0)){e.next=33;break}return this.props.showAlert(c),e.abrupt("return");case 33:if(u={NAME:r,VALUE:"0.0",QUANTITY:"",START:this.state.START,GROWTH:this.state.GROWTH,CPI_IMMUNE:!1,CAN_BE_NEGATIVE:!1,IS_A_DEBT:!1,CATEGORY:this.state.CATEGORY,PURCHASE_PRICE:"0.0",LIABILITY:""},!((c=this.props.checkAssetFunction(u,this.props.model)).length>0)){e.next=38;break}return this.props.showAlert(c),e.abrupt("return");case 38:if(h={NAME:s,VALUE:"0.0",QUANTITY:"",START:this.state.START,GROWTH:this.state.GROWTH,CPI_IMMUNE:!1,CAN_BE_NEGATIVE:!1,IS_A_DEBT:!1,CATEGORY:this.state.CATEGORY,PURCHASE_PRICE:"0.0",LIABILITY:""},!((c=this.props.checkAssetFunction(h,this.props.model)).length>0)){e.next=43;break}return this.props.showAlert(c),e.abrupt("return");case 43:if(E={NAME:o,VALUE:"0.0",QUANTITY:"",START:this.state.START,GROWTH:this.state.GROWTH,CPI_IMMUNE:!1,CAN_BE_NEGATIVE:!1,IS_A_DEBT:!1,CATEGORY:this.state.CATEGORY,PURCHASE_PRICE:"0.0",LIABILITY:""},""===this.state.DCP_TRANSFER_TO){e.next=49;break}if(!((c=this.props.checkAssetFunction(E,this.props.model)).length>0)){e.next=49;break}return this.props.showAlert(c),e.abrupt("return");case 49:if((d=Pe(this.state.DCP_SS)).checksOK){e.next=53;break}return this.props.showAlert("Salary sacrifice '".concat(this.state.DCP_SS,"' should be a Y/N value")),e.abrupt("return");case 53:if(!!Bn(this.state.DCP_CONTRIBUTION_AMOUNT)){e.next=57;break}return this.props.showAlert("Contribution amount '".concat(this.state.DCP_CONTRIBUTION_AMOUNT,"' should be a numerical value")),e.abrupt("return");case 57:if(!!Bn(this.state.DCP_EMP_CONTRIBUTION_AMOUNT)){e.next=61;break}return this.props.showAlert("Contribution amount '".concat(this.state.DCP_EMP_CONTRIBUTION_AMOUNT,"' should be a numerical value")),e.abrupt("return");case 61:return p=parseFloat(this.state.DCP_CONTRIBUTION_AMOUNT),A=parseFloat(this.state.DCP_EMP_CONTRIBUTION_AMOUNT),f=0===p?0:(p+A)/p,m=this.props.model,e.next=67,this.props.submitAssetFunction(i,m);case 67:return e.next=69,this.props.submitAssetFunction(u,m);case 69:return e.next=71,this.props.submitAssetFunction(h,m);case 71:if(""===this.state.DCP_TRANSFER_TO){e.next=74;break}return e.next=74,this.props.submitAssetFunction(E,m);case 74:if(T={NAME:(d.value?X:Z)+this.state.NAME,FROM:this.state.DCP_INCOME_SOURCE,FROM_ABSOLUTE:!1,FROM_VALUE:this.state.DCP_CONTRIBUTION_AMOUNT,TO:n,TO_ABSOLUTE:!1,TO_VALUE:"".concat(f),DATE:this.state.START,STOP_DATE:this.state.DCP_STOP,RECURRENCE:"",CATEGORY:this.state.CATEGORY,TYPE:"auto"},!((c=this.props.checkTransactionFunction(T,this.props.model)).length>0)){e.next=88;break}return e.next=79,this.props.deleteAssetFunction(i.NAME);case 79:return e.next=81,this.props.deleteAssetFunction(u.NAME);case 81:return e.next=83,this.props.deleteAssetFunction(h.NAME);case 83:if(""===this.state.DCP_TRANSFER_TO){e.next=86;break}return e.next=86,this.props.deleteAssetFunction(E.NAME);case 86:return this.props.showAlert(c),e.abrupt("return");case 88:if(v={NAME:te+this.state.NAME,FROM:n,FROM_ABSOLUTE:!1,FROM_VALUE:"0.25",TO:r,TO_ABSOLUTE:!1,TO_VALUE:"1.0",DATE:this.state.DCP_CRYSTALLIZE,STOP_DATE:"",RECURRENCE:"",CATEGORY:this.state.CATEGORY,TYPE:"auto"},!((c=this.props.checkTransactionFunction(v,this.props.model)).length>0)){e.next=102;break}return e.next=93,this.props.deleteAssetFunction(i.NAME);case 93:return e.next=95,this.props.deleteAssetFunction(u.NAME);case 95:return e.next=97,this.props.deleteAssetFunction(h.NAME);case 97:if(""===this.state.DCP_TRANSFER_TO){e.next=100;break}return e.next=100,this.props.deleteAssetFunction(E.NAME);case 100:return this.props.showAlert(c),e.abrupt("return");case 102:if(g={NAME:q+this.state.NAME,FROM:n,FROM_ABSOLUTE:!1,FROM_VALUE:"1.0",TO:s,TO_ABSOLUTE:!1,TO_VALUE:"1.0",DATE:this.state.DCP_CRYSTALLIZE,STOP_DATE:"",RECURRENCE:"",CATEGORY:this.state.CATEGORY,TYPE:"auto"},!((c=this.props.checkTransactionFunction(g,this.props.model)).length>0)){e.next=116;break}return e.next=107,this.props.deleteAssetFunction(i.NAME);case 107:return e.next=109,this.props.deleteAssetFunction(u.NAME);case 109:return e.next=111,this.props.deleteAssetFunction(h.NAME);case 111:if(""===this.state.DCP_TRANSFER_TO){e.next=114;break}return e.next=114,this.props.deleteAssetFunction(E.NAME);case 114:return this.props.showAlert(c),e.abrupt("return");case 116:if(""===this.state.DCP_TRANSFER_TO){e.next=130;break}if(O={NAME:ne+this.state.NAME,FROM:s,FROM_ABSOLUTE:!1,FROM_VALUE:"1.0",TO:o,TO_ABSOLUTE:!1,TO_VALUE:"1.0",DATE:this.state.DCP_TRANSFER_DATE,STOP_DATE:"",RECURRENCE:"",CATEGORY:this.state.CATEGORY,TYPE:"auto"},!((c=this.props.checkTransactionFunction(O,this.props.model)).length>0)){e.next=130;break}return e.next=122,this.props.deleteAssetFunction(i.NAME);case 122:return e.next=124,this.props.deleteAssetFunction(u.NAME);case 124:return e.next=126,this.props.deleteAssetFunction(h.NAME);case 126:return e.next=128,this.props.deleteAssetFunction(E.NAME);case 128:return this.props.showAlert(c),e.abrupt("return");case 130:return e.next=132,this.props.submitTransactionFunction(T,this.props.model);case 132:return e.next=134,this.props.submitTransactionFunction(v,this.props.model);case 134:return e.next=136,this.props.submitTransactionFunction(g,this.props.model);case 136:if(!O){e.next=139;break}return e.next=139,this.props.submitTransactionFunction(O,this.props.model);case 139:this.props.showAlert("added assets and transactions"),this.setState(this.defaultState),this.resetSelect(this.incomeSourceSelectID),e.next=172;break;case 144:if(Ye(this.state.QUANTITY).checksOK){e.next=148;break}return this.props.showAlert("Quantity '".concat(this.state.QUANTITY,"' should empty or a whole number value")),e.abrupt("return");case 148:if(b=this.state.LIABILITY,N="",""!==b&&(N=b+z),""===(M=Gn(N))){e.next=155;break}return this.props.showAlert(M),e.abrupt("return");case 155:if(""===(R=this.state.PURCHASE_PRICE)&&(R="0"),(C=Pe(this.state.GROWS_WITH_INFLATION)).checksOK){e.next=161;break}return this.props.showAlert("Grows with CPI: '".concat(this.state.GROWS_WITH_INFLATION,"' should be a Y/N value")),e.abrupt("return");case 161:if(y={NAME:this.state.NAME,VALUE:this.state.VALUE,QUANTITY:this.state.QUANTITY,START:this.state.START,GROWTH:this.state.GROWTH,CPI_IMMUNE:!C.value,CAN_BE_NEGATIVE:!1,IS_A_DEBT:!1,CATEGORY:this.state.CATEGORY,PURCHASE_PRICE:R,LIABILITY:N},!((S=this.props.checkAssetFunction(y,this.props.model)).length>0)){e.next=167;break}this.props.showAlert(S),e.next=172;break;case 167:return e.next=169,this.props.submitAssetFunction(y,this.props.model);case 169:this.props.showAlert("added new asset"),this.setState(this.defaultState),this.resetSelect(this.incomeSourceSelectID);case 172:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=Object(T.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,this.props.deleteAssetFunction(this.state.NAME);case 3:if(!e.sent){e.next=8;break}this.props.showAlert("deleted asset"),this.setState(this.defaultState),e.next=9;break;case 8:this.props.showAlert("failed to delete ".concat(this.state.NAME));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"inputPension",value:function(e){e.preventDefault(),this.setState(Object(c.a)(Object(c.a)({},this.state),{},{inputting:"definedContributionsPension"}))}},{key:"inputAsset",value:function(e){e.preventDefault(),this.setState(Object(c.a)(Object(c.a)({},this.state),{},{inputting:"asset"}))}},{key:"inputRevalue",value:function(e){e.preventDefault(),this.setState(Object(c.a)(Object(c.a)({},this.state),{},{inputting:"revalue"}))}},{key:"resetSelect",value:function(e){var t=document.getElementById(e);null!==t&&(t.selectedIndex="0")}}]),a}(r.Component);function xs(e,t,a){var n=a.get(e);void 0===n?a.set(e,Object(c.a)({},t)):(n.assetVal+=t.assetVal,n.assetQ&&t.assetQ?n.assetQ+=t.assetQ:t.assetQ&&(n.assetQ=t.assetQ))}function Ps(e,t){return s.a.createElement(At,{deleteFunction:void 0,handleGridRowsUpdated:function(){return!1},rows:fa(Array.from(e.entries()).filter((function(e){return 0!==e[1].assetVal})).map((function(e){var t=e[1].assetQ?"".concat(e[1].assetQ):"";return{NAME:e[0],VALUE:"".concat(e[1].assetVal),QUANTITY:t,CATEGORY:"".concat(e[1].category)}})).sort((function(e,t){return Me(t.NAME,e.NAME)}))),columns:[Object(c.a)(Object(c.a)({},pa),{},{key:"NAME",name:"name",formatter:s.a.createElement(mt,{name:"name",value:"unset"}),editable:!1}),Object(c.a)(Object(c.a)({},pa),{},{key:"VALUE",name:"value",formatter:s.a.createElement(Et,{name:"value",value:"unset"}),editable:!1}),Object(c.a)(Object(c.a)({},pa),{},{key:"QUANTITY",name:"quantity",formatter:s.a.createElement(mt,{name:"quantity",value:"unset"}),editable:!1}),Object(c.a)(Object(c.a)({},pa),{},{key:"CATEGORY",name:"category",formatter:s.a.createElement(mt,{name:"name",value:"unset"}),editable:!1})],triggers:t.triggers})}function Vs(e,t){if(0!==t.size){for(var a=new Map,n=0,r=Array.from(t.entries());n<r.length;n++){var o=r[n];if(""===o[1].category)xs(o[0],o[1],a);else xs(o[1].category,o[1],a)}var i=hr(e);return s.a.createElement(s.a.Fragment,null,oa(Ps(t,e),"Asset values at ".concat(i.toDateString())),oa(Ps(a,e),"Asset values (categorised) at ".concat(i.toDateString())))}}var ks=function(e){Object(p.a)(a,e);var t=Object(A.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).defaultState=void 0,n.defaultState={NAME:"",VALUE:"",START:"",GROWTH:"",CATEGORY:"",PAYMENT:"",inputting:"debt"},n.state=n.defaultState,n.handleNameChange=n.handleNameChange.bind(Object(d.a)(n)),n.handleValueChange=n.handleValueChange.bind(Object(d.a)(n)),n.handleGrowthChange=n.handleGrowthChange.bind(Object(d.a)(n)),n.handlePaymentChange=n.handlePaymentChange.bind(Object(d.a)(n)),n.handleCategoryChange=n.handleCategoryChange.bind(Object(d.a)(n)),n.handleStartChange=n.handleStartChange.bind(Object(d.a)(n)),n.setStart=n.setStart.bind(Object(d.a)(n)),n.add=n.add.bind(Object(d.a)(n)),n.delete=n.delete.bind(Object(d.a)(n)),n.inputDebt=n.inputDebt.bind(Object(d.a)(n)),n.inputRevalue=n.inputRevalue.bind(Object(d.a)(n)),n.growthAndInflation=n.growthAndInflation.bind(Object(d.a)(n)),n.revalue=n.revalue.bind(Object(d.a)(n)),n}return Object(E.a)(a,[{key:"ValueAndCategory",value:function(){return"revalue"===this.state.inputting?s.a.createElement(g.a,null,s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Debt name",type:"text",name:"debtname",value:this.state.NAME,placeholder:"Enter name",onChange:this.handleNameChange})),s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Debt value",type:"text",name:"debtvalue",value:this.state.VALUE,placeholder:"Enter value",onChange:this.handleValueChange}))):s.a.createElement(g.a,null,s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Debt name",type:"text",name:"debtname",value:this.state.NAME,placeholder:"Enter name",onChange:this.handleNameChange})),s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Debt value",type:"text",name:"debtvalue",value:this.state.VALUE,placeholder:"Enter value",onChange:this.handleValueChange})),s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Category (optional)",type:"text",name:"debtcategory",value:this.state.CATEGORY,placeholder:"category",onChange:this.handleCategoryChange})))}},{key:"growthAndInflation",value:function(){if("revalue"!==this.state.inputting)return s.a.createElement(g.a,null,s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Annual interest rate (excluding inflation, e.g. 2 for 2% p.a.)",type:"text",name:"debtgrowth",value:this.state.GROWTH,placeholder:"Enter growth",onChange:this.handleGrowthChange})),s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Monthly repayment (optional)",type:"text",name:"debtpayoff",value:this.state.PAYMENT,placeholder:"Enter payment",onChange:this.handlePaymentChange})))}},{key:"revalue",value:function(){var e=Object(T.a)(l.a.mark((function e(t){var a,n,r,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),(a=Ge("-".concat(this.state.VALUE))).checksOK){e.next=5;break}return this.props.showAlert("Debt value ".concat(this.state.VALUE," should be a numerical or % value")),e.abrupt("return");case 5:if(n=Ze(this.state.START,this.props.model.triggers),!(void 0===n)){e.next=10;break}return this.props.showAlert("Value set date should be a date"),e.abrupt("return");case 10:for(r=1;Tr("".concat("Revalue"," ").concat(this.state.NAME," ").concat(r),this.props.model);)r+=1;return s={NAME:"".concat("Revalue"," ").concat(this.state.NAME," ").concat(r),FROM:"",FROM_ABSOLUTE:!1,FROM_VALUE:"0.0",TO:this.state.NAME,TO_ABSOLUTE:a.absolute,TO_VALUE:a.value,DATE:this.state.START,TYPE:"revalueDebt",RECURRENCE:"",STOP_DATE:"",CATEGORY:""},e.next=15,this.props.checkTransactionFunction(s,this.props.model);case 15:if(!((o=e.sent).length>0)){e.next=19;break}return this.props.showAlert(o),e.abrupt("return");case 19:return e.next=21,this.props.submitTransactionFunction(s,this.props.model);case 21:return this.props.showAlert("added new data"),this.setState(this.defaultState),e.abrupt("return");case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"goButtons",value:function(){return"debt"===this.state.inputting?Rt("Create new debt (over-writes any existing with the same name)",this.add,"addDebt","addDebt","primary"):"revalue"===this.state.inputting?Rt("Revalue this debt",this.revalue,"revalueDebt","revalueDebt","primary"):void 0}},{key:"render",value:function(){return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"btn-group ml-3",role:"group"},Rt("Add new debt mode",this.inputDebt,"inputDebt","inputDebt","debt"===this.state.inputting?"primary":"outline-secondary"),Rt("Revalue debt mode",this.inputRevalue,"revalueDebtInputs","revalueDebtInputs","revalue"===this.state.inputting?"primary":"outline-secondary")),s.a.createElement("form",{className:"container-fluid",onSubmit:this.add},this.ValueAndCategory(),s.a.createElement("div",{className:"container-fluid"},s.a.createElement(ss,{introLabel:"Date on which the ".concat("revalue"===this.state.inputting?"revaluation occurs":"debt starts"),model:this.props.model,showAlert:this.props.showAlert,setDateFunction:this.setStart,inputName:"start date",inputValue:this.state.START,onChangeHandler:this.handleStartChange,triggers:this.props.model.triggers,submitTriggerFunction:this.props.submitTriggerFunction})),this.growthAndInflation(),this.goButtons()))}},{key:"handleNameChange",value:function(e){var t=e.target.value;this.setState({NAME:t})}},{key:"handleGrowthChange",value:function(e){var t=e.target.value;this.setState({GROWTH:t})}},{key:"handlePaymentChange",value:function(e){var t=e.target.value;this.setState({PAYMENT:t})}},{key:"handleCategoryChange",value:function(e){var t=e.target.value;this.setState({CATEGORY:t})}},{key:"handleValueChange",value:function(e){var t=e.target.value;this.setState({VALUE:t})}},{key:"setStart",value:function(e){this.setState({START:e})}},{key:"handleStartChange",value:function(e){var t=e.target.value;this.setStart(t)}},{key:"add",value:function(){var e=Object(T.a)(l.a.mark((function e(t){var a,n,r,s,o,i,c,u=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),""!==this.state.NAME){e.next=4;break}return this.props.showAlert("Name should be not empty"),e.abrupt("return");case 4:if(!oc()){e.next=9;break}if(void 0===(a=this.props.model.assets.find((function(e){return e.NAME===u.state.NAME})))){e.next=9;break}return a.IS_A_DEBT?this.props.showAlert("There's already a debt called ".concat(this.state.NAME)):this.props.showAlert("There's already an asset called ".concat(this.state.NAME)),e.abrupt("return");case 9:if(!!Bn(this.state.VALUE)){e.next=13;break}return this.props.showAlert("Debt value ".concat(this.state.VALUE," should be a numerical value")),e.abrupt("return");case 13:if(n=Ze(this.state.START,this.props.model.triggers),!(void 0===n)){e.next=18;break}return this.props.showAlert("Start date '".concat(this.state.START,"' should be a date")),e.abrupt("return");case 18:if(!!Bn(this.state.GROWTH)){e.next=22;break}return this.props.showAlert("Growth value '".concat(this.state.GROWTH,"' should be a numerical value")),e.abrupt("return");case 22:if(""===this.state.PAYMENT){e.next=27;break}if(!!Bn(this.state.PAYMENT)){e.next=27;break}return this.props.showAlert("Payment value '".concat(this.state.PAYMENT,"' should be a numerical value")),e.abrupt("return");case 27:if(r={NAME:this.state.NAME,VALUE:"-".concat(parseFloat(this.state.VALUE)),QUANTITY:"",START:this.state.START,GROWTH:this.state.GROWTH,CPI_IMMUNE:!0,CAN_BE_NEGATIVE:!0,IS_A_DEBT:!0,CATEGORY:this.state.CATEGORY,PURCHASE_PRICE:"0.0",LIABILITY:""},!((s=this.props.checkAssetFunction(r,this.props.model)).length>0)){e.next=33;break}this.props.showAlert(s),e.next=56;break;case 33:return e.next=35,this.props.submitAssetFunction(r,this.props.model);case 35:if(""===this.state.PAYMENT){e.next=54;break}for(o=1;Tr("Payment to ".concat(this.state.NAME," ").concat(o),this.props.model);)o+=1;return i={NAME:"".concat(re,"Payment to ").concat(this.state.NAME," ").concat(o),CATEGORY:this.state.CATEGORY,FROM:"Cash",FROM_ABSOLUTE:!0,FROM_VALUE:this.state.PAYMENT,TO:this.state.NAME,TO_ABSOLUTE:!1,TO_VALUE:"1.0",DATE:this.state.START,STOP_DATE:"",RECURRENCE:"1m",TYPE:"payOffDebt"},e.next=41,this.props.checkTransactionFunction(i,this.props.model);case 41:if(!((c=e.sent).length>0)){e.next=48;break}return this.props.showAlert(c),e.next=46,this.props.deleteAssetFunction(r.NAME);case 46:e.next=52;break;case 48:return e.next=50,this.props.submitTransactionFunction(i,this.props.model);case 50:this.props.showAlert("added new debt and payment"),this.setState(this.defaultState);case 52:e.next=56;break;case 54:this.props.showAlert("added new debt"),this.setState(this.defaultState);case 56:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=Object(T.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,this.props.deleteAssetFunction(this.state.NAME);case 3:if(!e.sent){e.next=8;break}this.props.showAlert("deleted debt"),this.setState(this.defaultState),e.next=9;break;case 8:this.props.showAlert("failed to delete ".concat(this.state.NAME));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"inputDebt",value:function(e){e.preventDefault(),this.setState(Object(c.a)(Object(c.a)({},this.state),{},{inputting:"debt"}))}},{key:"inputRevalue",value:function(e){e.preventDefault(),this.setState(Object(c.a)(Object(c.a)({},this.state),{},{inputting:"revalue"}))}}]),a}(r.Component);function Fs(e,t,a){var n=a.get(e);void 0===n?a.set(e,Object(c.a)({},t)):n.debtVal+=t.debtVal}function Bs(e,t){return s.a.createElement(At,{deleteFunction:void 0,handleGridRowsUpdated:function(){return!1},rows:fa(Array.from(e.entries()).filter((function(e){return 0!==e[1].debtVal})).map((function(e){return{NAME:e[0],VALUE:"".concat(e[1].debtVal),CATEGORY:"".concat(e[1].category)}}))).sort((function(e,t){return Me(e.NAME,t.NAME)})),columns:[Object(c.a)(Object(c.a)({},pa),{},{key:"NAME",name:"name",formatter:s.a.createElement(mt,{name:"name",value:"unset"}),editable:!1}),Object(c.a)(Object(c.a)({},pa),{},{key:"VALUE",name:"value",formatter:s.a.createElement(Et,{name:"value",value:"unset"}),editable:!1}),Object(c.a)(Object(c.a)({},pa),{},{key:"CATEGORY",name:"category",formatter:s.a.createElement(mt,{name:"name",value:"unset"}),editable:!1})],triggers:t.triggers})}function js(e,t){if(0!==t.size){for(var a=new Map,n=0,r=Array.from(t.entries());n<r.length;n++){var o=r[n];if(""===o[1].category)Fs(o[0],o[1],a);else Fs(o[1].category,o[1],a)}var i=hr(e);return s.a.createElement(s.a.Fragment,null,oa(Bs(t,e),"Debt values at ".concat(i.toDateString())),oa(Bs(a,e),"Debt values (categorised) at ".concat(i.toDateString())))}}var Ys=a(61),Gs=a.n(Ys),Ws="https://desolate-refuge-81883.herokuapp.com/finkitty/",Hs=new(function(){function e(){Object(h.a)(this,e)}return Object(E.a)(e,[{key:"getModelNames",value:function(e){var t=new Headers;return t.append("Content-Type","application/x-www-form-urlencoded"),new Promise((function(a,n){var r={method:"GET",headers:t,redirect:"follow"},s="".concat(Ws,"models?userID=").concat(e);return fetch(s,r).then((function(e){return e.text()})).then((function(e){try{var t=JSON.parse(e);a(t)}catch(r){n("Query failed")}})).catch((function(e){console.log("error",e),n(e)}))}))}},{key:"loadModel",value:function(e,t){var a=new Headers;return a.append("Content-Type","application/x-www-form-urlencoded"),new Promise((function(n,r){var s={method:"GET",headers:a,redirect:"follow"};return fetch("".concat(Ws,"find?userID=").concat(e,"&modelName=").concat(t),s).then((function(e){return e.text()})).then((function(e){if(""!==e&&"Query failed"!==e)try{n(dr(e))}catch(t){r("no model found err = ".concat(t))}else r("no model found")})).catch((function(e){console.log("error",e),r(e)}))}))}},{key:"ensureModel",value:function(e,t){var a=new Headers;a.append("Content-Type","application/x-www-form-urlencoded");var n=new URLSearchParams;n.append("userID",e),n.append("modelName",t),n.append("model",JSON.stringify(kr));var r={method:"POST",headers:a,body:n,redirect:"follow"};return fetch("".concat(Ws,"create"),r).then((function(e){return e.text()})).then((function(e){0})).catch((function(e){return console.log("error",e)}))}},{key:"saveModel",value:function(e,t,a){var n=new Headers;n.append("Content-Type","application/x-www-form-urlencoded");var r=new URLSearchParams;r.append("userID",e),r.append("modelName",t);var s=Object(c.a)({},a);delete s.undoModel,delete s.redoModel,r.append("model",JSON.stringify(s));var o={method:"PUT",headers:n,body:r,redirect:"follow"};return fetch("".concat(Ws,"update"),o).then((function(e){console.log("update successful");var t=e.text();return console.log("response.text() = ".concat(t)),t})).then((function(e){console.log(e)})).catch((function(e){return console.log("error",e)}))}},{key:"deleteModel",value:function(e,t){var a=new Headers;a.append("Content-Type","application/x-www-form-urlencoded");var n=new URLSearchParams;n.append("userID",e),n.append("modelName",t);var r={method:"DELETE",headers:a,body:n,redirect:"follow"};return fetch("".concat(Ws,"delete"),r).then((function(e){return e.text()})).then((function(e){return console.log(e)})).catch((function(e){return console.log("error",e)}))}}]),e}());function Js(){return Hs}function Ks(e,t){return e.NAME!==t.NAME?"name ".concat(e.NAME):""}function Qs(e,t){var a=Ks(e,t);if(a.length>0)return a;var n=e,r=t;return n.DATE!==r.DATE?"".concat(e.NAME,": date ").concat(n.DATE," !== ").concat(r.DATE):""}function qs(e,t){var a=Ks(e,t);if(a.length>0)return a;var n=e,r=t;return n.START!==r.START?"".concat(e.NAME,": start date ").concat(n.START," !== ").concat(r.START):n.END!==r.END?"".concat(e.NAME,": end date ").concat(n.END," !== ").concat(r.END):n.VALUE!==r.VALUE?"".concat(e.NAME,": value ").concat(n.VALUE," !== ").concat(r.VALUE):n.VALUE_SET!==r.VALUE_SET?"".concat(e.NAME,": value set date ").concat(n.VALUE_SET," !== ").concat(r.VALUE_SET):n.GROWTH!==r.GROWTH?"".concat(e.NAME,": growth ").concat(n.GROWTH," !== ").concat(r.GROWTH):n.CPI_IMMUNE!==r.CPI_IMMUNE?"".concat(e.NAME,": cpi-immunity ").concat(n.CPI_IMMUNE," !== ").concat(r.CPI_IMMUNE):n.LIABILITY!==r.LIABILITY?"".concat(e.NAME,": liability ").concat(n.LIABILITY," !== ").concat(r.LIABILITY):n.CATEGORY!==r.CATEGORY?"".concat(e.NAME,": category ").concat(n.CATEGORY," !== ").concat(r.CATEGORY):""}function zs(e,t){var a=Ks(e,t);if(a.length>0)return a;var n=e,r=t;return n.START!==r.START?"".concat(e.NAME,": start date ").concat(n.START," !== ").concat(r.START):n.END!==r.END?"".concat(e.NAME,": end date ").concat(n.END," !== ").concat(r.END):n.VALUE!==r.VALUE?"".concat(e.NAME,": value ").concat(n.VALUE," !== ").concat(r.VALUE):n.VALUE_SET!==r.VALUE_SET?"".concat(e.NAME,": value set date ").concat(n.VALUE_SET," !== ").concat(r.VALUE_SET):n.GROWTH!==r.GROWTH?"".concat(e.NAME,": growth ").concat(n.GROWTH," !== ").concat(r.VALUE):n.CPI_IMMUNE!==r.CPI_IMMUNE?"".concat(e.NAME,": cpi-immunity ").concat(n.CPI_IMMUNE," !== ").concat(r.CPI_IMMUNE):n.RECURRENCE!==r.RECURRENCE?"".concat(e.NAME,": recurrence ").concat(n.RECURRENCE," !== ").concat(r.RECURRENCE):n.CATEGORY!==r.CATEGORY?"".concat(e.NAME,": category ").concat(n.CATEGORY," !== ").concat(r.CATEGORY):""}function Zs(e,t){var a=Ks(e,t);if(a.length>0)return a;var n=e,r=t;return n.START!==r.START?"".concat(e.NAME,": start date ").concat(n.START," !== ").concat(r.START):n.VALUE!==r.VALUE?"".concat(e.NAME,": value ").concat(n.VALUE," !== ").concat(r.START):n.QUANTITY!==r.QUANTITY?"".concat(e.NAME,": quantity ").concat(n.QUANTITY," !== ").concat(r.START):n.CAN_BE_NEGATIVE!==r.CAN_BE_NEGATIVE?"".concat(e.NAME,": negativity ").concat(n.CAN_BE_NEGATIVE," !== ").concat(r.CAN_BE_NEGATIVE):n.IS_A_DEBT!==r.IS_A_DEBT?"".concat(e.NAME,": is-debt ").concat(n.IS_A_DEBT," !== ").concat(r.IS_A_DEBT):n.GROWTH!==r.GROWTH?"".concat(e.NAME,": growth ").concat(n.GROWTH," !== ").concat(r.GROWTH):n.CPI_IMMUNE!==r.CPI_IMMUNE?"".concat(e.NAME,": cpi-immunity ").concat(n.CPI_IMMUNE," !== ").concat(r.CPI_IMMUNE):n.PURCHASE_PRICE!==r.PURCHASE_PRICE?"".concat(e.NAME,": purchase price ").concat(n.PURCHASE_PRICE," !== ").concat(r.PURCHASE_PRICE):n.CATEGORY!==r.CATEGORY?"".concat(e.NAME,": category ").concat(n.CATEGORY," !== ").concat(r.CATEGORY):""}function Xs(e,t){var a=Ks(e,t);if(a.length>0)return a;var n=e,r=t;return n.DATE!==r.DATE?"".concat(e.NAME,": date ").concat(n.DATE," !== ").concat(r.DATE):n.STOP_DATE!==r.STOP_DATE?"".concat(e.NAME,": end date ").concat(n.STOP_DATE," !== ").concat(r.STOP_DATE):n.TO!==r.TO?"".concat(e.NAME,": to ").concat(n.TO," !== ").concat(r.DATE):n.TO_VALUE!==r.TO_VALUE?"".concat(e.NAME,": to value ").concat(n.TO_VALUE," !== ").concat(r.TO_VALUE):n.FROM!==r.FROM?"".concat(e.NAME,": from ").concat(n.FROM," !== ").concat(r.FROM):n.FROM_ABSOLUTE!==r.FROM_ABSOLUTE?"".concat(e.NAME,": from absolute date ").concat(n.FROM_ABSOLUTE," !== ").concat(r.FROM_ABSOLUTE):n.FROM_VALUE!==r.FROM_VALUE?"".concat(e.NAME,": from value ").concat(n.FROM_VALUE," !== ").concat(r.FROM_VALUE):n.TO_ABSOLUTE!==r.TO_ABSOLUTE?"".concat(e.NAME,": to absolute ").concat(n.TO_ABSOLUTE," !== ").concat(r.TO_ABSOLUTE):n.TYPE!==r.TYPE?"".concat(e.NAME,": type ").concat(n.TYPE," !== ").concat(r.TYPE):n.RECURRENCE!==r.RECURRENCE?"".concat(e.NAME,": recurrence ").concat(n.RECURRENCE," !== ").concat(r.RECURRENCE):n.CATEGORY!==r.CATEGORY?"".concat(e.NAME,": category ").concat(n.CATEGORY," !== ").concat(r.CATEGORY):""}function $s(e,t){var a=Ks(e,t);if(a.length>0)return a;var n=e,r=t;return n.VALUE!==r.VALUE?"".concat(e.NAME,": value ").concat(n.VALUE," !== ").concat(n.NAME):n.HINT!==r.HINT?"".concat(e.NAME,": hint ").concat(n.HINT," !== ").concat(n.HINT):n.TYPE!==r.TYPE?"".concat(e.NAME,": type ").concat(n.TYPE," !== ").concat(n.TYPE):""}function eo(e,t,a,n,r,s){var o,i=[],c=[],u=Object(m.a)(e);try{var l=function(){var e=o.value;if(c.length>0&&n)return"break";var u=t.filter((function(t){return e.NAME===t.NAME}));if(0===u.length)c.push("".concat(e.NAME," in ").concat(r," but not in ").concat(s));else if(u.length>1)c.push("duplicated name ".concat(e.NAME," present in ").concat(s));else{var l=a(e,u[0],n);if(l.length>0){if(c.push(l),n)return"break"}else i.push(e.NAME)}};for(u.s();!(o=u.n()).done;){if("break"===l())break}}catch(h){u.e(h)}finally{u.f()}return c.length>0&&n||n&&0!==c.length||t.forEach((function(e){i.find((function(t){return t===e.NAME}))||c.push("".concat(e.NAME," is in ").concat(s," but not in ").concat(r))})),c}function to(e,t,a,n,r){if(void 0===e)return void 0===t?[]:["one model undefined, other defined"];if(void 0===t)return["one model defined, other undefined"];var s=eo(e.triggers,t.triggers,Qs,a,n,r);return s.length>0&&a||(s=s.concat(eo(e.incomes,t.incomes,qs,a,n,r))).length>0&&a||(s=s.concat(eo(e.expenses,t.expenses,zs,a,n,r))).length>0&&a||(s=s.concat(eo(e.assets,t.assets,Zs,a,n,r))).length>0&&a||(s=s.concat(eo(e.transactions,t.transactions,Xs,a,n,r))).length>0&&a||(s=s.concat(eo(e.settings,t.settings,$s,a,n,r))).length,s}var ao=new Map;function no(e){return ro.apply(this,arguments)}function ro(){return(ro=Object(T.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],e.prev=2,e.next=5,Js().getModelNames(t);case 5:a=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),alert("error contacting database ".concat(e.t0));case 11:return e.abrupt("return",a);case 13:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}function so(e,t){return oo.apply(this,arguments)}function oo(){return(oo=Object(T.a)(l.a.mark((function e(t,a){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,e.next=4,Js().loadModel(t,a);case 4:n=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),alert("Cannot load ".concat(a,"; err = ").concat(e.t0));case 10:return e.abrupt("return",n);case 12:case"end":return e.stop()}}),e,null,[[1,7]])})))).apply(this,arguments)}function io(){0}function co(e){return uo.apply(this,arguments)}function uo(){return(uo=Object(T.a)(l.a.mark((function e(t){var a,n,r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=function(){return(s=Object(T.a)(l.a.mark((function e(n){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,so(t,n);case 3:if(void 0===(r=e.sent)){e.next=10;break}0,a.push({modelName:n,model:r,status:{isDirty:!1}}),e.next=11;break;case 10:throw new Error("model name ".concat(n," from DB but no model present???"));case 11:return e.abrupt("return");case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)},r=function(e){return s.apply(this,arguments)},a=[],e.next=5,no(t);case 5:return n=e.sent,e.next=9,Promise.all(n.map((function(e){return r(e)})));case 9:return e.sent,ao.set(t,a),io(),e.abrupt("return",a);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function lo(e){return ho.apply(this,arguments)}function ho(){return(ho=Object(T.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=ao.get(t)){e.next=5;break}return e.next=4,co(t);case 4:a=e.sent;case 5:return e.abrupt("return",a.map((function(e){return e.modelName})));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Eo(e,t){return po.apply(this,arguments)}function po(){return(po=Object(T.a)(l.a.mark((function e(t,a){var n,r,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==ao.get(t)){e.next=4;break}return e.next=4,co(t);case 4:if(n=ao.get(t),r=void 0,n&&(r=n.find((function(e){return e.modelName===a}))),!r){e.next=24;break}0,e.next=21;break;case 13:if(void 0!==(s=e.sent)){e.next=18;break}throw new Error("DBValidation error: cache has clean model \n          but DB has no model for ".concat(a));case 18:if((o=to(s,r.model,!0,"this model","cached model"))===[]){e.next=21;break}throw new Error("DBValidation error: ".concat(o," for ").concat(a));case 21:return e.abrupt("return",r);case 24:return e.abrupt("return",void 0);case 26:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ao(e,t,a){return fo.apply(this,arguments)}function fo(){return(fo=Object(T.a)(l.a.mark((function e(t,a,n){var r,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(r=ao.get(t))||(r=[]),s={modelName:a,model:n,status:{isDirty:!0}},-1!==(o=r.findIndex((function(e){return e.modelName===a})))?r.splice(o,1,s):r.push(s);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function mo(e,t){return To.apply(this,arguments)}function To(){return(To=Object(T.a)(l.a.mark((function e(t,a){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=ao.get(t))||(n=[]),!n.find((function(e){return e.modelName===a}))){e.next=7;break}return e.abrupt("return");case 7:return n.push({modelName:a,model:kr,status:{isDirty:!0}}),io(),e.abrupt("return");case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function vo(e,t,a){return go.apply(this,arguments)}function go(){return(go=Object(T.a)(l.a.mark((function e(t,a,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Ao(t,a,n),e.abrupt("return",!0);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Oo(e,t){var a=e.findIndex((function(e){return e.NAME===t.NAME}));-1!==a&&e.splice(a,1),e.push(t)}function bo(e,t,a,n,r){return No.apply(this,arguments)}function No(){return(No=Object(T.a)(l.a.mark((function e(t,a,n,r,s){var o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(gr(r),Oo(a,t),!sc()){e.next=7;break}if(""===(o=tr(r))){e.next=7;break}return Or(r),e.abrupt("return",o);case 7:return e.next=9,vo(s,n,r);case 9:return e.abrupt("return","");case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Mo(e,t,a,n){return Ro.apply(this,arguments)}function Ro(){return(Ro=Object(T.a)(l.a.mark((function e(t,a,n,r){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",bo(t,n.expenses,a,n,r));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Co(e,t,a,n){return yo.apply(this,arguments)}function yo(){return(yo=Object(T.a)(l.a.mark((function e(t,a,n,r){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",bo(t,n.incomes,a,n,r));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function So(e,t,a,n){return Io.apply(this,arguments)}function Io(){return(Io=Object(T.a)(l.a.mark((function e(t,a,n,r){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",bo(t,n.triggers,a,n,r));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Uo(e,t,a,n){return wo.apply(this,arguments)}function wo(){return(wo=Object(T.a)(l.a.mark((function e(t,a,n,r){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",bo(t,n.assets,a,n,r));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Do(e,t,a,n){return _o.apply(this,arguments)}function _o(){return(_o=Object(T.a)(l.a.mark((function e(t,a,n,r){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",bo(t,n.transactions,a,n,r));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Lo(e,t,a){return xo.apply(this,arguments)}function xo(){return(xo=Object(T.a)(l.a.mark((function e(t,a,n){var r,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,vo(t,a,n);case 3:return(r=ao.get(t))&&(o=r.find((function(e){return e.modelName===a})))&&(s=o.status),Js().ensureModel(t,a),e.next=8,Js().saveModel(t,a,n);case 8:return s&&(s.isDirty=!1),e.abrupt("return",!0);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Po(e,t,a,n){return Vo.apply(this,arguments)}function Vo(){return(Vo=Object(T.a)(l.a.mark((function e(t,a,n,r){var s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0!==(s=n.settings.find((function(e){return e.NAME===t.NAME})))&&(""===t.HINT&&(t.HINT=s.HINT),""===t.TYPE&&(t.TYPE=s.TYPE)),e.abrupt("return",bo(t,n.settings,a,n,r));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ko(e,t,a,n){return Fo.apply(this,arguments)}function Fo(){return(Fo=Object(T.a)(l.a.mark((function e(t,a,n,r){var s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s="adjustable",(o=n.settings.filter((function(e){return e.NAME===t.NAME}))).length>0&&(s=o[0].TYPE),Po({NAME:t.NAME,VALUE:t.VALUE,HINT:t.HINT,TYPE:s},a,n,r);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Bo(e,t){return jo.apply(this,arguments)}function jo(){return(jo=Object(T.a)(l.a.mark((function e(t,a){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===(n=ao.get(t))?Oe("unexpected empty local cache - no models for ".concat(t,"??")):-1===(r=n.findIndex((function(e){return e.modelName===a})))?Oe("unexpected local cache - no model for ".concat(t," and ").concat(a,"??")):n.splice(r,1),e.next=5,Js().deleteModel(t,a);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Yo=function(e){Object(p.a)(a,e);var t=Object(A.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).defaultState=void 0,n.defaultState={NAME:"",VALUE:"",START:"",inputting:"setting"},n.state=n.defaultState,n.handleNameChange=n.handleNameChange.bind(Object(d.a)(n)),n.handleValueChange=n.handleValueChange.bind(Object(d.a)(n)),n.handleStartChange=n.handleStartChange.bind(Object(d.a)(n)),n.setStart=n.setStart.bind(Object(d.a)(n)),n.add=n.add.bind(Object(d.a)(n)),n.inputSetting=n.inputSetting.bind(Object(d.a)(n)),n.inputRevalue=n.inputRevalue.bind(Object(d.a)(n)),n.revalue=n.revalue.bind(Object(d.a)(n)),n}return Object(E.a)(a,[{key:"ValueAndCategory",value:function(){return this.state.inputting,s.a.createElement(g.a,null,s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Setting name",type:"text",name:"settingname",value:this.state.NAME,placeholder:"Enter name",onChange:this.handleNameChange})),s.a.createElement(v.a,null,s.a.createElement(yt,{title:"Setting value",type:"text",name:"settingvalue",value:this.state.VALUE,placeholder:"Enter value",onChange:this.handleValueChange})))}},{key:"revalue",value:function(){var e=Object(T.a)(l.a.mark((function e(t){var a,n,r,s,o,i,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),a=Ze(this.state.START,this.props.model.triggers),!(void 0===a)){e.next=6;break}return this.props.showAlert("Given date ".concat(this.state.START," should be a date")),e.abrupt("return");case 6:for(n=1;Tr("".concat("Revalue"," ").concat(this.state.NAME," ").concat(n),this.props.model);)n+=1;return r=!0,s=this.state.VALUE,(o=Ge(s)).checksOK&&!o.absolute&&(r=!1,s=o.value),i={NAME:"".concat("Revalue"," ").concat(this.state.NAME," ").concat(n),FROM:"",FROM_ABSOLUTE:!1,FROM_VALUE:"0.0",TO:this.state.NAME,TO_ABSOLUTE:r,TO_VALUE:s,DATE:this.state.START,TYPE:"revalueSetting",RECURRENCE:"",STOP_DATE:"",CATEGORY:""},e.next=15,this.props.checkTransactionFunction(i,this.props.model);case 15:if(!((c=e.sent).length>0)){e.next=19;break}return this.props.showAlert(c),e.abrupt("return");case 19:return e.next=21,this.props.submitTransactionFunction(i,this.props.model);case 21:return this.props.showAlert("added new data"),this.setState(this.defaultState),e.abrupt("return");case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"goButtons",value:function(){return"setting"===this.state.inputting?Rt("Create new setting (over-writes any existing with the same name)",this.add,"addSetting","addSetting","primary"):"revalue"===this.state.inputting?Rt("Revalue this setting",this.revalue,"revalueSetting","revalueSetting","primary"):void 0}},{key:"startDate",value:function(){if("revalue"===this.state.inputting)return s.a.createElement("div",{className:"container-fluid"},s.a.createElement(ss,{introLabel:"Date on which the revaluation occurs",model:this.props.model,showAlert:this.props.showAlert,setDateFunction:this.setStart,inputName:"start date",inputValue:this.state.START,onChangeHandler:this.handleStartChange,triggers:this.props.model.triggers,submitTriggerFunction:this.props.submitTriggerFunction}))}},{key:"render",value:function(){return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"btn-group ml-3",role:"group"},Rt("Add new setting mode",this.inputSetting,"inputSetting","inputSetting","setting"===this.state.inputting?"primary":"outline-secondary"),Rt("Revalue setting mode",this.inputRevalue,"revalueSettingInputs","revalueSettingInputs","revalue"===this.state.inputting?"primary":"outline-secondary")),s.a.createElement("form",{className:"container-fluid",onSubmit:this.add},this.ValueAndCategory(),this.startDate(),this.goButtons()))}},{key:"handleNameChange",value:function(e){var t=e.target.value;this.setState({NAME:t})}},{key:"handleValueChange",value:function(e){var t=e.target.value;this.setState({VALUE:t})}},{key:"setStart",value:function(e){this.setState({START:e})}},{key:"handleStartChange",value:function(e){var t=e.target.value;this.setStart(t)}},{key:"add",value:function(){var e=Object(T.a)(l.a.mark((function e(t){var a,n=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),""!==this.state.NAME){e.next=4;break}return this.props.showAlert("Name should be not empty"),e.abrupt("return");case 4:if(!oc()){e.next=10;break}if(void 0===this.props.model.settings.find((function(e){return e.NAME===n.state.NAME}))){e.next=10;break}return Oe("this.props.model.settings = ".concat(be(this.props.model.settings))),this.props.showAlert("There's already a setting called ".concat(this.state.NAME)),e.abrupt("return");case 10:return a={NAME:this.state.NAME,VALUE:this.state.VALUE,HINT:"",TYPE:"adjustable"},e.next=13,this.props.submitSettingFunction(a,this.props.model,this.props.viewSettings);case 13:this.props.showAlert("added new setting ".concat(this.state.NAME)),this.setState(this.defaultState);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"inputSetting",value:function(e){e.preventDefault(),this.setState(Object(c.a)(Object(c.a)({},this.state),{},{inputting:"setting"}))}},{key:"inputRevalue",value:function(e){e.preventDefault(),this.setState(Object(c.a)(Object(c.a)({},this.state),{},{inputting:"revalue"}))}}]),a}(r.Component),Go=function(e){Object(p.a)(a,e);var t=Object(A.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).defaultState=void 0,n.defaultState={JSON:""},n.state=n.defaultState,n.replace=n.replace.bind(Object(d.a)(n)),n.handleValueChange=n.handleValueChange.bind(Object(d.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(d.a)(n)),n}return Object(E.a)(a,[{key:"handleValueChange",value:function(e){var t=e.target.value;this.setState({JSON:t})}},{key:"handleSubmit",value:function(e){this.replace(e)}},{key:"render",value:function(){var e=this;return s.a.createElement("form",{className:"container-fluid",onSubmit:this.replace},s.a.createElement(yt,{type:"text",title:"input report:{sourceMatcher:regexp,sourceExcluder:regexp}|newModelName:{jsonModelData}",name:"replaceWithJSON",value:this.state.JSON,placeholder:"Enter text input here",onChange:this.handleValueChange,onSubmit:this.handleSubmit}),Rt("toggle evaluate on definition change",function(){var t=Object(T.a)(l.a.mark((function t(a){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.setState({JSON:"eval"});case 2:e.replace(a);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),"toggleEDC","toggleEDC","outline-secondary"),s.a.createElement("br",null),Rt("toggle jump to overview",function(){var t=Object(T.a)(l.a.mark((function t(a){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.setState({JSON:"overview"});case 2:e.replace(a);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),"toggleJTO","toggleJTO","outline-secondary"),s.a.createElement("br",null),Rt("toggle check before overwrite",function(){var t=Object(T.a)(l.a.mark((function t(a){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.setState({JSON:"overwrite"});case 2:e.replace(a);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),"toggleCBO","toggleCBO","outline-secondary"))}},{key:"replace",value:function(){var e=Object(T.a)(l.a.mark((function e(t){var a,n,r,s,o,i,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),a=this.props.modelName,"report:",n="overwrite",r="overview",s="eval",!(o=this.state.JSON.trim()).startsWith("report:")){e.next=11;break}return this.props.setReportKey(o.substring("report:".length)),this.setState({JSON:""}),e.abrupt("return");case 11:if(o!==n){e.next=15;break}return this.props.toggleCheckOverwrite(),this.setState({JSON:""}),e.abrupt("return");case 15:if(o!==s){e.next=19;break}return this.props.eval(),this.setState({JSON:""}),e.abrupt("return");case 19:if(o!==r){e.next=23;break}return this.props.toggleOverview(),this.setState({JSON:""}),e.abrupt("return");case 23:0!==(i=this.state.JSON.indexOf("{"))&&(a=o.substring(0,i),o=o.substring(i)),this.props.modelNames.find((function(e){return e===a}))&&this.props.doCheckOverwrite()&&!window.confirm("will replace ".concat(a," which already exists, you sure?"))||(c=dr(o),$i(this.props.userID,a,c,!1),this.props.showAlert("replaced data OK"),this.setState({JSON:""}));case 28:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),a}(r.Component),Wo=a(73),Ho=a.n(Wo),Jo=function(e){Object(p.a)(a,e);var t=Object(A.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).defaultState=void 0,n.defaultState={newName:""},n.state=n.defaultState,n.clonePropsModel=n.clonePropsModel.bind(Object(d.a)(n)),n.handleValueChange=n.handleValueChange.bind(Object(d.a)(n)),n.backupModel=n.backupModel.bind(Object(d.a)(n)),n}return Object(E.a)(a,[{key:"handleValueChange",value:function(e){var t=e.target.value;this.setState({newName:t})}},{key:"exampleButtonList",value:function(){var e=this,t=this.props.exampleModels.map((function(t){return Rt("Create ".concat(t.name," example"),Object(T.a)(l.a.mark((function a(){return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",e.copyModel(e.props.getExampleModel(t.model)));case 1:case"end":return a.stop()}}),a)}))),"btn-create-".concat(t.name,"-example"),"btn-create-".concat(t.name,"-example"),"outline-primary")}));return s.a.createElement("div",{role:"group"},t)}},{key:"render",value:function(){var e=this;return s.a.createElement("form",{className:"container-fluid",onSubmit:function(){var t=Object(T.a)(l.a.mark((function t(a){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a.preventDefault(),e.copyModel(kr);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},s.a.createElement(yt,{type:"text",title:"Create new model",name:"createModel",value:this.state.newName,placeholder:"Enter new model name here",onChange:this.handleValueChange}),Rt("New model",Object(T.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:0,e.copyModel(kr);case 2:case"end":return t.stop()}}),t)}))),"btn-createMinimalModel","btn-createMinimalModel","outline-primary"),Rt("Make backup of model",this.backupModel,"btn-backup","btn-backup","outline-primary"),Rt("Clone model",this.clonePropsModel,"btn-clone","btn-clone","outline-primary"),this.exampleButtonList())}},{key:"clonePropsModel",value:function(){var e=Object(T.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),this.copyModel(this.props.modelData);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"backupModel",value:function(){var e=Object(T.a)(l.a.mark((function e(t){var a,n,r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),a=new Date,n=this.props.currentModelName+"backup "+_t()(a,"yyyy-mm-dd HH:MM:ss"),window.confirm("Save a local text file for this model?")&&(r=JSON.stringify(this.props.modelData),s=new Blob([r],{type:"text/plain;charset=utf-8"}),Ho.a.saveAs(s,"".concat(n,".txt"))),e.next=6,this.props.saveModel(this.props.userID,this.props.currentModelName+"backup "+_t()(a,"yyyy-mm-dd HH:MM:ss"),this.props.modelData);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"copyModel",value:function(){var e=Object(T.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(a=this.state.newName).length){e.next=4;break}return this.props.showAlert("Please provide a new name for the model"),e.abrupt("return");case 4:return e.next=6,this.props.getModelNames(this.props.userID);case 6:if(e.t0=!e.sent.includes(a),e.t0){e.next=9;break}e.t0=window.confirm("will replace ".concat(a,", you sure?"));case 9:if(!e.t0){e.next=18;break}return Oe("go to clone model"),e.next=13,this.props.cloneModel(a,t);case 13:if(!e.sent){e.next=17;break}this.setState({newName:""}),e.next=18;break;case 17:Oe("failed to clone ok");case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),a}(r.Component),Ko=a(131),Qo=a(127),qo=a(126),zo="Simple",Zo="",Xo=!1;var $o,ei=new Map([[ie,{display:!0}],[me,{display:!1}],[ue,{display:!1}],[ce,{display:!1}],[he,{display:!1}],[Ee,{display:!1}],[Ae,{display:!1}],[de,{display:!1}],[le,{display:!1}],[fe,{display:!1}],[pe,{display:!1}]]),ti=[{name:"Simple",model:Mr},{name:"Defined Benefits Pension",model:Rr},{name:"Defined Contributions Pension",model:Cr},{name:"National Savings Income Bonds",model:'{"assets":[\n{"NAME":"NI","VALUE":"1000000","QUANTITY":"","START":"startDate","LIABILITY":"","GROWTH":"0","CPI_IMMUNE":false,"CAN_BE_NEGATIVE":false,"IS_A_DEBT":false,"PURCHASE_PRICE":"0","CATEGORY":""},\n{"NAME":"Cash","VALUE":"0","QUANTITY":"","START":"startDate","LIABILITY":"","GROWTH":"0","CPI_IMMUNE":true,"CAN_BE_NEGATIVE":true,"IS_A_DEBT":false,"PURCHASE_PRICE":"0","CATEGORY":""}],\n"incomes":[\n{"NAME":"NIinterest","CATEGORY":"","START":"startDate","END":"stopDate","VALUE":"0.001241NI","VALUE_SET":"startDate","GROWTH":"0","CPI_IMMUNE":true,"LIABILITY":"Joe(incomeTax)/Joe(NI)"}],\n"expenses":[\n{"NAME":"LivingCosts","CATEGORY":"","START":"startDate","END":"stopDate","VALUE":"900","VALUE_SET":"startDate","GROWTH":"5","CPI_IMMUNE":false,"RECURRENCE":"1m"}],\n"triggers":[\n{"NAME":"stopDate","DATE":"2040-01-01"},\n{"NAME":"startDate","DATE":"2020-01-01"}],\n"settings":[\n{"NAME":"Today\'s value focus date","VALUE":"","HINT":"Date to use for \'today\'s value\' tables (defaults to \'\' meaning today)","TYPE":"view"},\n{"NAME":"End of view range","VALUE":"1 Jan 2030","HINT":"Date at the end of range to be plotted","TYPE":"view"},\n{"NAME":"Date of birth","VALUE":"","HINT":"Date used for representing dates as ages","TYPE":"view"},\n{"NAME":"cpi","VALUE":"2.5","HINT":"Annual rate of inflation","TYPE":"const"},\n{"NAME":"Beginning of view range","VALUE":"1 Jan 2017","HINT":"Date at the start of range to be plotted","TYPE":"view"}],\n"transactions":[\n],"version":4}'}];function ai(e){return!!$o&&$o.state.viewState.setViewSetting(e.NAME,e.VALUE)}function ni(e){var t=ei.get(e);return void 0===t?(Oe("Error : unrecognised view ".concat(e)),!1):t.display}var ri=["4E81BC","C0504E","9CBB58","23BFAA","8064A1","4BACC5","F79647","7F6084","77A032","33558B"];function si(e){return function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:{r:30,g:30,b:100}}(ri[e%ri.length])}function oi(e,t){return{labels:e,datasets:t.map((function(e,t){var a=si(t);return{label:e.item.NAME,data:e.chartDataPoints.map((function(e){return Math.round(100*e.y)/100})),backgroundColor:"rgb(".concat(a.r,",").concat(a.g,",").concat(a.b,")"),barPercentage:1}})),displayLegend:!0}}function ii(){return Zo}function ci(e){return dr(e)}function ui(e){$o.setState({alertText:e})}function li(e){$o?(Oe("before toggle reactAppComponent.state.".concat(e," = ").concat($o.options[e])),$o.options[e]=!$o.options[e],Oe("after toggle state has ".concat(e," is ").concat($o.options[e]))):alert("error: data not ready to set ".concat(e," mode"))}function hi(){return Ei.apply(this,arguments)}function Ei(){return(Ei=Object(T.a)(l.a.mark((function e(){var t,a,n,r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,lo(ii());case 2:if(t=e.sent,a=void 0,0!==t.length&&("Simple"!==zo||void 0!==t.find((function(e){return"Simple"===e})))){e.next=25;break}if(!(t.length>0)){e.next=18;break}return zo=t.sort((function(e,t){return Me(e,t)}))[0],e.next=9,Eo(ii(),zo);case 9:if(void 0!==(n=e.sent)){e.next=14;break}return"problem with model data",ui("problem with model data"),e.abrupt("return",{model:a,modelNames:t});case 14:Xo=n.status.isDirty,a=n.model,e.next=23;break;case 18:return e.next=20,Promise.all(ti.map(function(){var e=Object(T.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,vo(ii(),t.name,ci(t.model));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 20:t=ti.map((function(e){return e.name})),a=ci(Mr),zo="Simple";case 23:e.next=39;break;case 25:return r=!0,e.prev=26,e.next=29,Eo(ii(),zo);case 29:(s=e.sent)&&(Xo=s.status.isDirty,a=s.model),e.next=37;break;case 33:e.prev=33,e.t0=e.catch(26),Oe("Cannot load ".concat(zo,", err = ").concat(e.t0,". Consider 'Force delete'?")),r=!1;case 37:if(r&&void 0!==a){e.next=39;break}return e.abrupt("return",{model:a,modelNames:t});case 39:return e.abrupt("return",{model:a,modelNames:t});case 40:case"end":return e.stop()}}),e,null,[[26,33]])})))).apply(this,arguments)}function di(){return!!$o&&$o.options.evalMode}function pi(e,t){var a="";e.assets.forEach((function(e){if(t.getShowItem(n.Asset,e.NAME)){var r=e.NAME;a=""===a?r:a+"|"+r}}));var r=function(t){var a="",n=e.settings.find((function(e){return e.NAME===t}));return void 0!==n&&(a=n.VALUE),a},s=new Date(r(C)),o=new Date(r(M));return function(t,n,r,i){if(!$o.state.reportDefiner)return!1;if(e.expenses.find((function(e){return e.NAME===i})))return!1;if(""===a)return!1;var c=$o.state.reportDefiner.sourceMatcher,u=$o.state.reportDefiner.sourceExcluder;if(!c&&!u)return!1;if(r<hr(e))return!1;if(r<s)return!1;if(r>o)return!1;if(t.startsWith("Purchase"))return!1;if(a){var l=RegExp(a);if(null===t.match(l))return!1}if(c)try{var h=RegExp(c);if(null===i.match(h))return!1}catch(d){return alert("error processing regexp"),!1}if(u)try{var E=RegExp(u);if(null!==i.match(E))return!1}catch(d){return alert("error processing regexp"),!1}return!0}}function Ai(e,t,a){return fi.apply(this,arguments)}function fi(){return(fi=Object(T.a)(l.a.mark((function e(t,a,n){var r,s,o,i,u,h,E,d,p,A,f,m,T,v,g,O,b,N,M,R,C,y;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=$o.state.viewState,i={evaluations:$o.state.evaluations,todaysAssetValues:$o.state.todaysAssetValues,todaysDebtValues:$o.state.todaysDebtValues,todaysIncomeValues:$o.state.todaysIncomeValues,todaysExpenseValues:$o.state.todaysExpenseValues,todaysSettingValues:$o.state.todaysSettingValues,reportData:$o.state.reportData},t){e.next=8;break}s=$o.state.modelNamesData,o=$o.state.modelData,e.next=25;break;case 8:return Oe("refresh the model - get the model and recalculate values"),e.next=11,hi();case 11:if(void 0!==(u=e.sent).model){e.next=14;break}return e.abrupt("return");case 14:o=u.model,s=u.modelNames,o.triggers.sort((function(e,t){return Me(t.NAME,e.NAME)})),o.expenses.sort((function(e,t){return Me(t.NAME,e.NAME)})),o.settings.sort((function(e,t){return Me(t.NAME,e.NAME)})),o.incomes.sort((function(e,t){return Me(t.NAME,e.NAME)})),o.transactions.sort((function(e,t){return Me(t.NAME,e.NAME)})),o.assets.sort((function(e,t){return Me(t.NAME,e.NAME)})),s.sort((function(e,t){return Me(e,t)})),t&&r.setModel(o),di()&&(h=function(){return!1},ni(fe)&&(h=pi(o,r)),i=kn(o,h));case 25:t||a?((E=as(o,r,i)).expensesData.sort((function(e,t){return Me(e.item.NAME,t.item.NAME)})),E.incomesData.sort((function(e,t){return Me(e.item.NAME,t.item.NAME)})),E.assetData.sort((function(e,t){return Me(e.item.NAME,t.item.NAME)})),E.taxData.sort((function(e,t){return Me(e.item.NAME,t.item.NAME)})),d=E.expensesData,p=E.incomesData,A=E.assetData,f=E.debtData,m=E.taxData,T=E.todaysAssetValues,v=E.todaysDebtValues,g=E.todaysIncomeValues,O=E.todaysExpenseValues,b=E.todaysSettingValues,N=oi(E.labels,d),M=oi(E.labels,p),R=oi(E.labels,A),C=oi(E.labels,f),y=oi(E.labels,m),void 0!==$o&&$o.setState({modelData:o,evaluations:i.evaluations,expensesChartData:N,incomesChartData:M,assetChartData:R,debtChartData:C,taxChartData:y,modelNamesData:s,todaysAssetValues:T,todaysDebtValues:v,todaysIncomeValues:g,todaysExpenseValues:O,todaysSettingValues:b,reportData:i.reportData},(function(){0}))):$o.setState(Object(c.a)({},$o.state));case 26:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function mi(e,t,a){return Ti.apply(this,arguments)}function Ti(){return(Ti=Object(T.a)(l.a.mark((function e(t,a,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=7;break}return Oe("go to refresh data - set as waiting...".concat((new Date).toLocaleTimeString())),e.next=4,$o.setState({isWaiting:!0},Object(T.a)(l.a.mark((function e(){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ai(t,a,n);case 2:return r=e.sent,Oe("finished refresh data - set as not waiting...".concat((new Date).toLocaleTimeString())),$o.setState({isWaiting:!1}),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)}))));case 4:return e.abrupt("return",e.sent);case 7:return e.next=9,Ai(t,a,n);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function vi(e){try{var t=JSON.parse(e);return $o.setState({reportDefiner:{sourceMatcher:t.sourceMatcher,sourceExcluder:t.sourceExcluder}}),mi(!0,!0,1),!0}catch(a){return alert("error processing JSON format"),!1}}function gi(e,t){return Oi.apply(this,arguments)}function Oi(){return(Oi=Object(T.a)(l.a.mark((function e(t,a){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Uo(t,zo,a,ii());case 2:if(""!==(n=e.sent)){e.next=9;break}return e.next=6,mi(!0,!0,2);case 6:return e.abrupt("return",e.sent);case 9:ui(n);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function bi(e,t){return Ni.apply(this,arguments)}function Ni(){return(Ni=Object(T.a)(l.a.mark((function e(t,a){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Mo(t,zo,a,ii());case 2:if(""!==(n=e.sent)){e.next=9;break}return e.next=6,mi(!0,!0,3);case 6:return e.abrupt("return",e.sent);case 9:ui(n);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Mi(e,t){return Ri.apply(this,arguments)}function Ri(){return(Ri=Object(T.a)(l.a.mark((function e(t,a){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Co(t,zo,a,ii());case 2:if(""!==(n=e.sent)){e.next=9;break}return e.next=6,mi(!0,!0,4);case 6:return e.abrupt("return",!0);case 9:return ui(n),e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ci(e,t){return yi.apply(this,arguments)}function yi(){return(yi=Object(T.a)(l.a.mark((function e(t,a){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Do(t,zo,a,ii());case 2:if(""!==(n=e.sent)){e.next=9;break}return e.next=6,mi(!0,!0,5);case 6:return e.abrupt("return",e.sent);case 9:ui(n);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Si(e,t){return Ii.apply(this,arguments)}function Ii(){return(Ii=Object(T.a)(l.a.mark((function e(t,a){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,So(t,zo,a,ii());case 2:if(""!==(n=e.sent)){e.next=9;break}return e.next=6,mi(!0,!0,6);case 6:return e.abrupt("return",e.sent);case 9:ui(n);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ui(){return(Ui=Object(T.a)(l.a.mark((function e(t,a){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!ai({NAME:t.NAME,VALUE:t.VALUE,TYPE:"view",HINT:""})){e.next=4;break}return e.next=3,mi(!1,!0,7);case 3:return e.abrupt("return",e.sent);case 4:return n=Object(c.a)(Object(c.a)({},t),{},{HINT:"",TYPE:""}),e.next=7,Po(n,zo,a,ii());case 7:if(""!==(r=e.sent)){e.next=14;break}return e.next=11,mi(!0,!0,8);case 11:return e.abrupt("return",e.sent);case 14:ui(r);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function wi(e,t,a){return Di.apply(this,arguments)}function Di(){return(Di=Object(T.a)(l.a.mark((function e(t,a,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.migrateViewSettingString(t.NAME,t.VALUE)){e.next=6;break}return e.next=3,mi(!1,!0,9);case 3:return e.abrupt("return",e.sent);case 6:return e.next=8,ko(t,zo,a,ii());case 8:return e.next=10,mi(!0,!0,10);case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _i(e,t){if(Oe("toggle called from ".concat(t)),void 0!==$o){var a,n=Object(m.a)(ei.keys());try{for(n.s();!(a=n.n()).done;){var r=a.value;if(r!==e){var s=ei.get(r);if(void 0===s)return void Oe("Error : unrecognised view ".concat(e));s.display=!1}}}catch(i){n.e(i)}finally{n.f()}var o=ei.get(e);if(void 0===o)return Oe("Error : unrecognised view ".concat(e)),!1;o.display=!0,e===fe?mi(!0,!0,11):mi(!1,!0,12)}}function Li(e){var t=tr(e);return""===t?"model check all good":t}function xi(e,t,a,n){return Pi.apply(this,arguments)}function Pi(){return(Pi=Object(T.a)(l.a.mark((function e(t,a,n,r){var s,o,i,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(gr(r),-1===(s=a.findIndex((function(e){return e.NAME===t})))){e.next=17;break}if(o=a[s],a.splice(s,1),""===(i=tr(r))){e.next=12;break}return c="edited  model fails checks :".concat(i,"', reverting"),$o.setState({alertText:c}),a.splice(s,0,o),Or(r),e.abrupt("return",!1);case 12:return e.next=14,vo(ii(),n,r);case 14:return e.next=16,mi(!0,!0,13);case 16:return e.abrupt("return",!0);case 17:return e.abrupt("return",!1);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Vi(e){return ki.apply(this,arguments)}function ki(){return(ki=Object(T.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",xi(t,$o.state.modelData.triggers,zo,$o.state.modelData));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Fi(e){return Bi.apply(this,arguments)}function Bi(){return(Bi=Object(T.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",xi(t,$o.state.modelData.assets,zo,$o.state.modelData));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ji(e){return Yi.apply(this,arguments)}function Yi(){return(Yi=Object(T.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",xi(t,$o.state.modelData.transactions,zo,$o.state.modelData));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Gi(e){return Wi.apply(this,arguments)}function Wi(){return(Wi=Object(T.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",xi(t,$o.state.modelData.expenses,zo,$o.state.modelData));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Hi(e){return Ji.apply(this,arguments)}function Ji(){return(Ji=Object(T.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",xi(t,$o.state.modelData.incomes,zo,$o.state.modelData));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ki(e){return Qi.apply(this,arguments)}function Qi(){return(Qi=Object(T.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",xi(t,$o.state.modelData.settings,zo,$o.state.modelData));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qi(e){return zi.apply(this,arguments)}function zi(){return(zi=Object(T.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(zo!==t){e.next=2;break}return e.abrupt("return",!0);case 2:if(!Xo){e.next=6;break}if(window.confirm("Continue without saving unsaved model ".concat(zo,"?"))){e.next=6;break}return e.abrupt("return",!1);case 6:return zo=t,e.next=9,mo(ii(),zo);case 9:return e.next=11,mi(!0,!0,14);case 11:return e.abrupt("return",!0);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Zi(){return!!$o&&$o.options.goToOverviewPage}function Xi(){return!!$o&&$o.options.checkOverwrite}function $i(e,t,a,n){return ec.apply(this,arguments)}function ec(){return(ec=Object(T.a)(l.a.mark((function e(t,a,n,r){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t&&(t=ii()),!(r&&Xo)){e.next=5;break}if(window.confirm("Continue without saving unsaved model ".concat(zo,"?"))){e.next=5;break}return e.abrupt("return",!1);case 5:return zo=a,e.next=8,vo(t,zo,n);case 8:return e.next=10,mi(!0,!0,15);case 10:return e.abrupt("return",!0);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function tc(e){var t=Object(r.useState)(!0),a=Object(f.a)(t,2),n=a[0],o=a[1],i="success";return e.message.startsWith("added new")||(i="warning"),s.a.createElement(s.a.Fragment,null,s.a.createElement(Ko.a,{show:n,variant:i},s.a.createElement("div",{id:"pageTitle",key:"pageTitle"},e.message),s.a.createElement(Nt.a,{onClick:function(){o(!1),e.dismissAction()},variant:"outline-".concat(i),id:"btn-clear-alert"},"OK")),!n&&s.a.createElement(Nt.a,{onClick:function(){return o(!0)}},"Show Alert"))}var ac=function(e){Object(p.a)(a,e);var t=Object(A.a)(a);function a(e){var n;Object(h.a)(this,a),(n=t.call(this,e)).options=void 0;var r=new Jr([{NAME:D,VALUE:_},{NAME:J,VALUE:"val"},{NAME:x,VALUE:k},{NAME:F,VALUE:"All"},{NAME:B,VALUE:"All"},{NAME:j,VALUE:"All"},{NAME:Y,VALUE:"All"},{NAME:G,VALUE:"All"},{NAME:W,VALUE:"All"},{NAME:H,VALUE:"Y"}]);return $o=Object(d.a)(n),n.state={modelData:wr,evaluations:[],viewState:r,expensesChartData:{labels:[],datasets:[],displayLegend:!0},incomesChartData:{labels:[],datasets:[],displayLegend:!0},assetChartData:{labels:[],datasets:[],displayLegend:!0},debtChartData:{labels:[],datasets:[],displayLegend:!0},taxChartData:{labels:[],datasets:[],displayLegend:!0},modelNamesData:[],todaysAssetValues:new Map,todaysDebtValues:new Map,todaysIncomeValues:new Map,todaysExpenseValues:new Map,todaysSettingValues:new Map,reportDefiner:{sourceMatcher:"Buy|Sell",sourceExcluder:""},reportData:[],alertText:"",isWaiting:!1},n.options={goToOverviewPage:!0,checkOverwrite:!0,evalMode:!0},mi(!0,!0,16),n}return Object(E.a)(a,[{key:"componentWillUnmount",value:function(){}},{key:"componentDidMount",value:function(){_i(ie,27),mi(!0,!0,25)}},{key:"navbarDiv",value:function(e){var t=this;return gs(e,(function(){var e=t.state.reportData.find((function(e){return"Estate final value"===e.name})),a="";return void 0!==e&&void 0!==e.newVal&&(a="Estate: ".concat(He(e.newVal))),s.a.createElement(s.a.Fragment,null,s.a.createElement(As.a.Toggle,{"aria-controls":"basic-navbar-nav"}),s.a.createElement(As.a.Collapse,{id:"basic-navbar-nav"},s.a.createElement(Qo.a,{className:"mr-auto"},s.a.createElement(qo.a,{inline:!0,onSubmit:function(e){return e.preventDefault(),!1}},s.a.createElement(v.a,null,s.a.createElement(g.a,null,t.statusButtonList()),s.a.createElement(g.a,null,t.viewButtonList())))),s.a.createElement(Qo.a,null,s.a.createElement(qo.a,{inline:!0,onSubmit:function(e){return e.preventDefault(),!1}},s.a.createElement(v.a,null,s.a.createElement("div",{className:"d-flex flex-row-reverse"},t.rhsTopButtonList(a)),s.a.createElement("div",{className:"d-flex flex-row-reverse"},t.rhsBottomButtonList()))))))}))}},{key:"render",value:function(){var e=this;try{var t=function(t){var a="",n=e.state.modelData.settings.find((function(e){return e.NAME===t}));return void 0!==n&&(a=n.VALUE),a},a=function(){return t(C)},r=function(){return t(M)},o=function(t,a){var n=e.state.modelData.settings.find((function(e){return e.NAME===t}));void 0!==n&&(n.VALUE=a,wi(n,e.state.modelData,e.state.viewState))},i=function(){var e=Object(T.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o(C,t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),u=function(){var e=Object(T.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o(M,t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Oe("report is length ".concat(this.state.reportData.length)),s.a.createElement(s.a.Fragment,null,this.navbarDiv(this.state.isWaiting),s.a.createElement(s.a.Fragment,null,this.homeDiv(),Ns(this.state.modelData,this.state.viewState,ui,this.state.assetChartData,this.state.debtChartData,this.state.expensesChartData,this.state.incomesChartData,this.state.taxChartData,a,i,r,u),this.settingsDiv(this.state.modelData,this.state.todaysSettingValues),function(e,t,a,n,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:void 0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:void 0;if(ni(ue))return s.a.createElement("div",{className:"ml-3"},oa(qt(e,t,n,Yt(0,e.settings),a,o,i,c,u),"Incomes data chart"),Is(e,r),ya(e,a),Na(e,a,se,"Income revaluations"),oa(s.a.createElement("div",{className:"addNewIncome"},s.a.createElement(Cs,{checkIncomeFunction:Kn,checkTransactionFunction:Xn,submitIncomeFunction:Mi,submitTransactionFunction:Ci,deleteFunction:Hi,submitTriggerFunction:Si,model:e,showAlert:a})),"Add an income, a defined-benefits pension, or revalue an income"))}(this.state.modelData,this.state.viewState,ui,this.state.incomesChartData,this.state.todaysIncomeValues,a,i,r,u),function(e,t,a,n,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:void 0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:void 0;if(ni(ce))return s.a.createElement("div",{className:"ml-3"},oa(Xt(e,t,n,Yt(0,e.settings),a,o,i,c,u),"Expenses data chart"),_s(e,r),Sa(e,a),Na(e,a,oe,"Expense revaluations"),oa(s.a.createElement("div",{className:"addNewExpense"},s.a.createElement(Us,{checkFunction:qn,submitFunction:bi,deleteFunction:Gi,submitTriggerFunction:Si,model:e,showAlert:a,checkTransactionFunction:Xn,submitTransactionFunction:Ci})),"Add or revalue an expense"))}(this.state.modelData,this.state.viewState,ui,this.state.expensesChartData,this.state.todaysExpenseValues,a,i,r,u),function(e,t,a,n,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:void 0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:void 0;if(ni(he))return s.a.createElement("div",{className:"ml-3"},oa(ta(e,t,n,!1,a,o,i,c,u),"Asset data chart"),Vs(e,r),Ra(e,a),oa(s.a.createElement("div",{className:"addNewAsset"},s.a.createElement(Ls,{checkAssetFunction:Hn,submitAssetFunction:gi,checkTransactionFunction:Xn,submitTransactionFunction:Ci,deleteAssetFunction:Fi,submitTriggerFunction:Si,model:e,showAlert:a})),"Add an asset, a defined-contributions pension, or revalue an asset"))}(this.state.modelData,this.state.viewState,ui,this.state.assetChartData,this.state.todaysAssetValues,a,i,r,u),function(e,t,a,n,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:void 0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:void 0;if(ni(Ee))return s.a.createElement("div",{className:"ml-3"},oa(ta(e,t,n,!0,a,o,i,c,u),"Debts data chart"),js(e,r),Ma(e,a),oa(s.a.createElement("div",{className:"addNewDebt"},s.a.createElement(ks,{checkAssetFunction:Hn,submitAssetFunction:gi,checkTransactionFunction:Xn,submitTransactionFunction:Ci,deleteAssetFunction:Fi,submitTriggerFunction:Si,model:e,showAlert:a})),"Add or revalue a debt"))}(this.state.modelData,this.state.viewState,ui,this.state.debtChartData,this.state.todaysDebtValues,a,i,r,u),this.transactionsDiv(),ra(this.state.modelData,this.state.viewState,this.state.taxChartData),this.triggersDiv(),function(e,t,a,r){if(ni(fe)){var o=fa(r.filter((function(e){return"Estate final value"!==e.name})).map((function(e){var t=function(e){return e?He(e):""},a=function(e){return e?"".concat(e):""};return{DATE:e.date,NAME:e.name,CHANGE:t(e.change),OLD_VALUE:t(e.oldVal),NEW_VALUE:t(e.newVal),QCHANGE:a(e.qchange),QOLD_VALUE:a(e.qoldVal),QNEW_VALUE:a(e.qnewVal),SOURCE:e.source}}))),i=n.Asset,u=e.assets.filter((function(e){return!1===e.IS_A_DEBT}));return s.a.createElement("div",{className:"ml-3"},Bt(u,t,i,!0),s.a.createElement(sa,{reportMatcher:a,setReportKey:vi}),s.a.createElement(At,{deleteFunction:void 0,handleGridRowsUpdated:function(){return!1},rows:o,columns:[Object(c.a)(Object(c.a)({},pa),{},{key:"DATE",name:"date",formatter:s.a.createElement(gt,{name:"date",model:e,value:"unset",showTime:!1})}),Object(c.a)(Object(c.a)({},pa),{},{key:"NAME",name:"name",formatter:s.a.createElement(mt,{name:"name",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"CHANGE",name:"change",formatter:s.a.createElement(Et,{name:"change",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"OLD_VALUE",name:"old value",formatter:s.a.createElement(Et,{name:"old value",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"NEW_VALUE",name:"new value",formatter:s.a.createElement(Et,{name:"new value",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"QCHANGE",name:"quantity change",formatter:s.a.createElement(mt,{name:"quantity change",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"QOLD_VALUE",name:"old quantity",formatter:s.a.createElement(mt,{name:"old quantity",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"QNEW_VALUE",name:"new quantity",formatter:s.a.createElement(mt,{name:"new quantity",value:"unset"})}),Object(c.a)(Object(c.a)({},pa),{},{key:"SOURCE",name:"source",formatter:s.a.createElement(mt,{name:"source",value:"unset"})})],triggers:e.triggers}))}}(this.state.modelData,this.state.viewState,this.state.reportDefiner,this.state.reportData)))}catch(E){var h=E;return this.internalErrorDiv(h)}}},{key:"internalErrorDiv",value:function(e){return s.a.createElement(s.a.Fragment,null,this.navbarDiv(!1),s.a.createElement("h1",null,"Oops! something has gone wrong with FinKitty. Sad FinKitty apologises."),e.message)}},{key:"modelList",value:function(e,t,a){if(0===e.length)return s.a.createElement("div",{role:"group"},s.a.createElement("img",{src:vs.a,alt:"FinKitty wait symbol"}),"Loading models...");var n=e.map((function(e){return Rt(e,(function(a){a.persist(),t(e)}),e,"btn-".concat(a,"-").concat(e),"del"!==a&&zo===e?"primary":"outline-primary")}));return s.a.createElement("div",{className:"ml-3"},"Select an existing model",s.a.createElement("br",null),n)}},{key:"modelListForSelect",value:function(e){return this.modelList(e,function(){var e=Object(T.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,qi(t);case 2:if(!e.sent){e.next=6;break}if(!Zi()){e.next=6;break}return e.next=6,_i(me,999);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),"overview")}},{key:"getNewName",value:function(){var e={gotNameOK:!1,newName:""},t=prompt("Provide a name for your model");if(null===t)return e;""===t&&(t="myModel");var a=RegExp("[a-zA-Z0-9_\\-\\. ]+");if(""!==t.replace(a,"")){return $o.setState({alertText:"Model names can only contain a-z, A-Z, 0-9, _, - and . characters"}),e}return this.state.modelNamesData.find((function(e){return e===t}))?(ui("There's already a model with that name"),e):(e.gotNameOK=!0,e.newName=t,e)}},{key:"deleteModel",value:function(){var e=Object(T.a)(l.a.mark((function e(t){var a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.confirm("delete all data in model ".concat(t," - you sure?"))){e.next=16;break}return a=this.state.modelNamesData,e.next=4,Bo(ii(),t);case 4:if(-1!==(n=a.findIndex((function(e){return e===t})))?a.splice(n,1):Oe("error, deleted ".concat(t," found in ").concat(a)),0!==a.length){e.next=13;break}return ui("no data left: recreating example model"),zo="Simple",e.next=11,vo(ii(),zo,dr(Mr));case 11:e.next=14;break;case 13:zo=a[0];case 14:return e.next=16,mi(!0,!0,17);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"diffModel",value:function(){var e=Object(T.a)(l.a.mark((function e(t){var a,n,r,s,o,i,c,u;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(a=window.prompt("diff ".concat(t," against which model?"),""))){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,Eo(ii(),a);case 5:if(void 0!==(n=e.sent)){e.next=10;break}return ui("Can't load a model named ".concat(a)),e.abrupt("return");case 10:if(r=n.model){e.next=14;break}return window.alert("Can't load a model named ".concat(a)),e.abrupt("return");case 14:if(0===(s=to(this.state.modelData,r,!1,t,a)).length)window.alert("models are the same");else{o="",i=Object(m.a)(s);try{for(i.s();!(c=i.n()).done;)u=c.value,o+=u+"\n"}catch(l){i.e(l)}finally{i.f()}window.alert(o)}case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"cloneModel",value:function(){var e=Object(T.a)(l.a.mark((function e(t,a){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=JSON.stringify(a),e.next=3,qi(t);case 3:if(!e.sent){e.next=19;break}return r=dr(n),e.next=8,$i(void 0,zo,r,!1);case 8:if(!e.sent){e.next=16;break}if(!Zi()){e.next=13;break}return e.next=13,_i(me,999);case 13:return e.abrupt("return",!0);case 16:return e.abrupt("return",!1);case 17:e.next=20;break;case 19:return e.abrupt("return",!1);case 20:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"homeScreenButtons",value:function(){var e=this;return s.a.createElement(s.a.Fragment,null,s.a.createElement(Jo,{userID:Zo,currentModelName:zo,modelData:this.state.modelData,saveModel:function(){var e=Object(T.a)(l.a.mark((function e(t,a,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Lo(t,a,n);case 2:mi(!0,!0,18);case 3:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),showAlert:ui,cloneModel:this.cloneModel,exampleModels:ti,getExampleModel:ci,getModelNames:lo}),s.a.createElement("br",null),s.a.createElement("div",{className:"btn-group ml-3",role:"group"},Rt("Delete model",Object(T.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.deleteModel(zo);case 1:case"end":return t.stop()}}),t)}))),"btn-delete","btn-delete","outline-secondary"),Rt("Diff model",Object(T.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.diffModel(zo);case 1:case"end":return t.stop()}}),t)}))),"btn-diff","btn-diff","outline-secondary")),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("div",{className:"ml-3"},"Developer tools:",s.a.createElement("br",null),Rt("Check model",Object(T.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Li($o.state.modelData),$o.setState({alertText:t});case 2:case"end":return e.stop()}}),e)}))),"btn-check","btn-check","outline-secondary"),s.a.createElement("br",null),Rt("Copy model as JSON to clipboard",(function(){var t=JSON.stringify(e.state.modelData);navigator.clipboard.writeText(t).then((function(){ui("model as JSON on clipboard")}),(function(e){console.error("Async: Could not copy text: ",e),ui("sorry, something went wrong, no copy on clipboard - in console instead"),Oe("-------- start of model --------"),Oe(t),Oe("-------- end of model --------")}))}),"btn-log","btn-log","outline-secondary"),Rt("Test encrypted JSON",(function(){var e=prompt("Enter encrypted JSON");if(null!==e){var t=prompt("Enter secret key");if(null!==t)try{var a=Gs.a.AES.decrypt(e,t).toString(Gs.a.enc.Utf8);if(Oe("deciphered text ".concat(a)),void 0===a)ui("could not decode this data");else{var n=Li(dr(a));$o.setState({alertText:n})}}catch(r){ui("could not decode this data")}}}),"btn-JSON-encrypt-replace","btn-JSON-encrypt-replace","outline-secondary")),s.a.createElement(Go,{modelName:zo,modelNames:this.state.modelNamesData,userID:Zo,showAlert:ui,setReportKey:vi,toggleCheckOverwrite:function(){return li("checkOverwrite")},toggleOverview:function(){return li("goToOverviewPage")},doCheckOverwrite:Xi,eval:function(){return li("evalMode")}}))}},{key:"homeDiv",value:function(){var e=this;if(ni(ie))return s.a.createElement("div",{className:"ml-3"},s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-sm mb-4"},s.a.createElement("div",{className:"ml-3"},Rt("Create a new model",Object(T.a)(l.a.mark((function t(){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((a=e.getNewName()).gotNameOK){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,qi(a.newName);case 5:if(!t.sent){t.next=9;break}if(!Zi()){t.next=9;break}return t.next=9,_i(me,999);case 9:case"end":return t.stop()}}),t)}))),"startNewModel","startNewModel","outline-secondary")),s.a.createElement("br",null),this.modelListForSelect(this.state.modelNamesData),s.a.createElement("br",null),this.state.modelNamesData.length>0?this.homeScreenButtons():""),s.a.createElement("div",{className:"col-md mb-4"},ps())))}},{key:"todaysSettingsTable",value:function(e,t){if(0!==t.size){var a=hr(e),n=fa(Array.from(t).map((function(e){var t=Object(f.a)(e,2),a=t[0],n=t[1];return{NAME:a,VALUE:"".concat(n.settingVal)}})).sort((function(e,t){return Me(t.NAME,e.NAME)})));return oa(s.a.createElement(At,{deleteFunction:void 0,handleGridRowsUpdated:function(){return!1},rows:n,columns:[Object(c.a)(Object(c.a)({},pa),{},{key:"NAME",name:"name",formatter:s.a.createElement(mt,{name:"name",value:"unset"}),editable:!1}),Object(c.a)(Object(c.a)({},pa),{},{key:"VALUE",name:"value",formatter:s.a.createElement(Tt,{name:"value",value:"unset"}),editable:!1})],triggers:e.triggers}),"Settings values at ".concat(a.toDateString()))}}},{key:"settingsDiv",value:function(e,t){if(ni(pe))return s.a.createElement("div",{className:"ml-3"},s.a.createElement("fieldset",null,Da(this.state.modelData,this.state.viewState,ui),this.todaysSettingsTable(e,t),s.a.createElement("p",null),oa(s.a.createElement("div",{className:"addNewSetting"},s.a.createElement(Yo,{submitSettingFunction:wi,checkTransactionFunction:Xn,submitTransactionFunction:Ci,submitTriggerFunction:Si,model:this.state.modelData,viewSettings:this.state.viewState,showAlert:ui})),"Add setting")))}},{key:"triggersDiv",value:function(){if(ni(de))return s.a.createElement("div",{className:"ml-3"},Ca(this.state.modelData,ui),s.a.createElement("p",null),oa(s.a.createElement("div",{className:"addNewTrigger"},s.a.createElement(ns,{checkFunction:$n,submitFunction:Si,deleteFunction:Vi,model:this.state.modelData,showAlert:ui})),"Add an important date"))}},{key:"transactionsDiv",value:function(){if(ni(le))return s.a.createElement("div",{className:"ml-3"},Na(this.state.modelData,ui,"custom","Custom transactions"),Na(this.state.modelData,ui,"auto","Auto-generated transactions"),Na(this.state.modelData,ui,"bondInvest","Investments into bonds"),Na(this.state.modelData,ui,"bondMature","Maturities of bonds"),s.a.createElement("p",null),s.a.createElement("div",{className:"addNewTransaction"},s.a.createElement("h4",null," Add a transaction "),s.a.createElement(is,{checkFunction:Xn,submitFunction:Ci,deleteFunction:ji,submitTriggerFunction:Si,model:this.state.modelData,showAlert:ui})))}},{key:"rhsTopButtonList",value:function(e){var t=this,a=[];return a.push(Rt("Log out",(function(e){e.persist(),t.props.logOutAction()}),"Log out","btn-LogOut","outline-secondary")),""!==e&&a.push(Rt(e,(function(){}),"estateText","btn-estateText","outline-secondary")),a}},{key:"rhsBottomButtonList",value:function(){var e=[];return e.push(this.makeUndoButton()),e.push(this.makeRedoButton()),e.push(this.makeSaveButton()),e}},{key:"viewButtonList",value:function(){for(var e=[],t=ei.keys(),a=t.next(),n=function(){var n=a.value;if(n===ie)return a=t.next(),"continue";var r=ei.get(n);if(void 0===r)return Oe("Error : unrecognised view ".concat(n)),a=t.next(),"continue";var s=r.display;e.push(Rt(n.lc,(function(e){e.persist(),_i(n,26)}),n.lc,"btn-".concat(n.lc),s?"secondary":"outline-secondary")),a=t.next()};!a.done;)n();return e}},{key:"statusButtonList",value:function(){var e=[];return e=e.concat(this.makeHelpText(this.state.alertText))}},{key:"makeUndoButton",value:function(){for(var e=this,t=0,a=this.state.modelData.undoModel;void 0!==a&&t<100;)a=a.undoModel,t+=1;var n="Undo";t>0&&(n="Undo(".concat(t,")"));var r="";if(void 0!==this.state.modelData.undoModel){var o=to(this.state.modelData,this.state.modelData.undoModel,!0,"current model","previous model");o.length>0&&(r=o[0])}var i=Rt(n,function(){var t=Object(T.a)(l.a.mark((function t(a){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.persist(),t.next=3,Or(e.state.modelData);case 3:if(!t.sent){t.next=7;break}return t.next=6,vo(Zo,zo,e.state.modelData);case 6:mi(!0,!0,19);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),"btn-undo-model","btn-undo-model",void 0!==this.state.modelData.undoModel?"secondary":"outline-secondary");return""===r?i:s.a.createElement(lt.a,{key:"undoOverlay",overlay:function(e){return s.a.createElement(ht.a,Object.assign({},e,{id:"undoTooltip"}),r)},placement:"bottom"},s.a.createElement("div",null,i))}},{key:"makeRedoButton",value:function(){for(var e=this,t=0,a=this.state.modelData.redoModel;void 0!==a&&t<100;)a=a.redoModel,t+=1;var n="Redo";t>0&&(n="Redo(".concat(t,")"));var r="";if(void 0!==this.state.modelData.redoModel){var o=to(this.state.modelData.redoModel,this.state.modelData,!0,"redo model","current model");o.length>0&&(r=o[0])}var i=Rt(n,function(){var t=Object(T.a)(l.a.mark((function t(a){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.persist(),t.next=3,br(e.state.modelData);case 3:if(!t.sent){t.next=7;break}return t.next=6,vo(Zo,zo,e.state.modelData);case 6:mi(!0,!0,20);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),"btn-redo-model","btn-redo-model",void 0!==this.state.modelData.redoModel?"secondary":"outline-secondary");return""===r?i:s.a.createElement(lt.a,{key:"redoOverlay",overlay:function(e){return s.a.createElement(ht.a,Object.assign({},e,{id:"redoTooltip"}),r)},placement:"bottom"},s.a.createElement("div",null,i))}},{key:"makeSaveButton",value:function(){var e=this;return Rt("Save model",function(){var t=Object(T.a)(l.a.mark((function t(a){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.persist(),t.next=3,Lo(Zo,zo,e.state.modelData);case 3:mi(!0,!0,21);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),"btn-save-model","btn-save-model",Xo?"secondary":"outline-secondary")}},{key:"makeHelpText",value:function(e){var t=this,a=[],n=e;return""===n?(n="".concat(zo),a.push(s.a.createElement("h4",{className:"text",id:"pageTitle",key:"pageTitle"},n))):a.push(s.a.createElement(tc,{message:e,dismissAction:function(){t.setState({alertText:""})}})),a}}]),a}(r.Component);function nc(e,t,a){return rc.apply(this,arguments)}function rc(){return(rc=Object(T.a)(l.a.mark((function e(t,a,n){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==(r=Nr(t,a,n))){e.next=7;break}return e.next=4,vo(ii(),zo,t);case 4:mi(!0,!0,22),e.next=8;break;case 7:ui(r);case 8:return e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function sc(){return Xi()}function oc(){var e=Xi();return Oe("check overwrite = ".concat(e)),e}var ic=function(){var e=Object(r.useContext)(jr),t=e.isLoading,a=e.user,n=e.loginWithRedirect,o=e.loginForTesting,i=e.logout;return t||a?!t&&a?(Zo=a.sub,s.a.createElement(ac,{logOutAction:function(){return"TestUserID"===Zo&&Oe("logout ".concat(Zo)),i({returnTo:window.location.origin+"/FinKitty"})},user:a})):(Zo="",null):(Zo="",function(e,t){return s.a.createElement(s.a.Fragment,null,gs(!1,(function(){return s.a.createElement("h3",null,"An app for financial kitty forecasting")})),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-sm mb-4"},s.a.createElement("div",{className:"alert alert-block"},s.a.createElement("h2",null,"Get started")," To begin using this app, log in or use a shared playpen",s.a.createElement("br",null),Rt("Login or create an account",e,"buttonLogin","buttonLogin","outline-secondary"),Rt("Shared playpen (no login)",t,"buttonTestLogin","buttonTestLogin","outline-secondary")),s.a.createElement("div",{className:"alert alert-block"},s.a.createElement("strong",null,"How it works")," Build one or more models. Each tracks the financial progress of one possible world, based on information you provide for that model, about expenses, incomes, assets and transactions. You can log out and come back another time and your models will still be available for you to explore. For each model, an overview page can be printed to PDF as a take-away customisable report, which can include all the data you have provided to build up the model."),s.a.createElement("div",{className:"alert alert-block"},s.a.createElement("strong",null,"Data security")," Access to the app is controlled by user authentication. Web communication uses secure HTTPS protocols and model data is encypted using industry-standard algorithms before it is stored in a database on the cloud. You can extract all your data in readable JSON text format if you choose to delete your data from this system. For the moment, the database and server are build without additional levels of health checks and full resilience. If you need guaranteed access to your data, a backup download of the JSON data and a record of the PDF overview are advised."),s.a.createElement("div",{className:"alert alert-block"},s.a.createElement("strong",null,"Modeling tax")," Income tax is calculated according to UK tax regulations as at December 2019. Capital Gains tax is implemented as a somewhat simplified version of the real thing in UK as at December 2019. Whilst FinKitty accounts for tax relief on pension contributions it does not cover any tax penalties incurred for breaching the Annual Pension Allowance. For most people, this allowance is \xa340,000pa, but it is reduced for high earners: always seek independent financial advice. Assuming ongoing development, future versions of the app will calculate incomes and gains to be taxed according to the rules applicable at the time the income or gain was made."),s.a.createElement("div",{className:"alert alert-block"},s.a.createElement("strong",null,"Modeling assumptions")," In addition to the data you enter for modeling incomes, expenses, assets and transactions, you can provide a value for CPI to influence how values change over time. Future tax regime is assumed to be the latest known one. Any irregular losses such as stock market crashes or unexpected gains and windfalls can be input as part of a model but unless they are added, the future is assumed to progress smoothly (and unrealistically) in a predictable and continuous fashion."),s.a.createElement("div",{className:"alert alert-block"},s.a.createElement("strong",null,"Small print!")," This web app should not be used to make important financial decisions without also getting independent advice from a qualified\xa0",s.a.createElement("a",{href:"https://www.fca.org.uk/consumers/finding-adviser"},"\xa0independent financial advisor"," ")," ","to validate financial plans.")),s.a.createElement("div",{className:"col-md mb-4"},ps())))}(n,o))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(s.a.createElement(Yr,null,s.a.createElement(ic,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},54:function(e,t,a){e.exports=a.p+"static/media/catWait.87e7c7f7.gif"},69:function(e,t,a){e.exports=a.p+"static/media/sampleAssetGraph.405ff0cd.png"},70:function(e,t,a){e.exports=a.p+"static/media/sampleExpenseGraph.5581786d.png"},71:function(e,t,a){e.exports=a.p+"static/media/sampleTaxGraph.c9aa7cfc.png"},72:function(e,t,a){e.exports=a.p+"static/media/cat.50c12de4.png"},75:function(e,t,a){e.exports=a(118)},80:function(e,t,a){}},[[75,1,2]]]);
//# sourceMappingURL=main.f977a306.chunk.js.map